# Создание пакета в формате RPM

В данном разделе приведена процедура создания пакета программного обеспечения в формате RPM на локальном ПК или с использованием платформы сборки Open Build Service (OBS). Подробнее см. [Инструкции по созданию пакетов ПО] (https://gitee.com/openeuler/community/blob/master/en/contributors/packaging.md).

\[\[toc]]

## Описание процесса

### Принципы компоновки

При создании пакета RPM необходимо скомпилировать исходный код. Скомпилированные конфигурационные файлы и командные файлы в двоичном формате должны быть правильно размещены. Пакеты RPM необходимо должным образом протестировать. Для выполнения этих операций требуется рабочая среда. Утилита rpmbuild использует набор стандартных рабочих сред.

```
$ rpmdev-setuptree
```

Для установки инструментов сборки rpmdevtools используется команда **rpmdev-setuptree**. После выполнения данной команды создается папка **rpmbuild** в каталоге **/root** (или в каталоге **/home/**_имя пользователя_ для пользователей, не имеющих полномочий root). Структура каталога выглядит следующим образом:

```
$ tree rpmbuild
rpmbuild
├── BUILD
├── RPMS
├── SOURCES
├── SPECS
└── SRPMS
```

Содержание каталога:

<a name="en-us_topic_0184337290_table1268115913017"></a>



| **Содержимое**     | **Макрокод** | **Наименование**                              | **Функция**                                                  |
| ------------------ | ------------ | --------------------------------------------- | ------------------------------------------------------------ |
| ~/rpmbuild/BUILD   | %_builddir   | Каталог сборки.                               | В подкаталог данного каталога компилируется распакованный пакет с исходным кодом. |
| ~/rpmbuild/RPMS    | %_rpmdir     | Стандартный каталог хранения пакета RPM.      | В этом каталоге хранится сгенерированный бинарный пакет RPM. |
| ~/rpmbuild/SOURCES | %_sourcedir  | Каталог хранения исходного кода.              | В этом каталоге хранятся пакет исходного кода (например, пакет .tar) и все патчи. |
| ~/rpmbuild/SPECS   | %_specdir    | Каталог хранения файла spec.                  | В этом каталоге хранится конфигурационный файл пакета RPM (.spec). |
| ~/rpmbuild/SRPMS   | %_srcrpmdir  | Каталог хранения пакета RPM с исходным кодом. | В этом каталоге хранится пакет RPM исходного кода (SRPM).    |

В каталоге **~/rpmbuild/SPECS** содержится конфигурационный файл пакета RPM, который представляет собой структуру пакета RPM. Этот файл указывает команде **rpmbuild**, как скомпоновать пакет RPM. В столбце **Macro Code** содержатся соответствующие каталоги в файле .spec, который подобен макросу или глобальной переменной в языке программирования.

### Процедура компоновки

Процедура компоновки выглядит следующим образом:

1. Поместите исходный код в каталог **%\_sourcedir**.
2. Скомпилируйте исходный код в каталоге **%\_builddir**. Исходный код обычно сжимается, поэтому сначала его необходимо распаковать.
3. Установите пакет RPM. Процесс установки аналогичен предварительной сборке программного пакета. Скопируйте содержимое (например, файлы в двоичном формате, конфигурационные файлы и man-файлы), которые должны быть включены в программный пакет, в каталог **%\_buildrootdir,** и после установки скомпонуйте содержимое согласно фактической структуре каталога. Например, если команды в двоичном коде хранятся в каталоге **/usr/bin**, скопируйте структуру каталога в **%\_buildrootdir**.
4. Выполните необходимые настройки — подготовку перед установкой и очистку после установки. Настройки вносятся в файл SPEC и служат инструкциями по компоновке для команды **rpmbuild**.
5. Убедитесь, что программное обеспечение функционирует нормально.
6. Созданный пакет RPM хранится в каталоге **%\_rpmdir**, а пакет с исходным кодом — в **%\_srpmdir**.

Описание каждой фазы в файле SPEC:



| **Этап** | **Каталог для чтения** | **Каталог для записи данных** | **Операция**                                                 |
| -------- | ---------------------- | ----------------------------- | ------------------------------------------------------------ |
| %prep    | %_sourcedir            | %_builddir                    | Считайте исходный код и патч из каталога **%_sourcedir**. Затем распакуйте исходный код в подкаталоге **%_builddir** и примените все патчи. |
| %build   | %_builddir             | %_builddir                    | Скомпилируйте файлы в каталоге сборки **%_builddir**. Выполните команду аналогично **./configure && make**. |
| %install | %_builddir             | %_buildrootdir                | Считайте файлы из каталога сборки **%_builddir** и установите их в каталог **%_buildrootdir**. Эти файлы генерируются после установки RPM. |
| %check   | %_builddir             | %_builddir                    | Убедитесь, что программное обеспечение функционирует нормально. Выполните команду аналогично **make test**. |
| bin      | %_buildrootdir         | %_rpmdir                      | Считайте файлы из каталога окончательной установки **%_buildrootdir**, чтобы создать пакеты RPM в каталоге **%_rpmdir**. В этом каталоге в разных подкаталогах хранятся пакеты RPM, предназначенные для разных архитектур. В каталоге **noarch** хранятся пакеты RPM, применимые ко всем архитектурам. Данные файлы RPM представляют собой пакеты RPM, которые устанавливаются непосредственно пользователями. |
| src      | %_sourcedir            | %_srcrpmdir                   | Создайте пакет исходного кода RPM (кратко SRPM, с расширением файла .src.rpm) и сохраните его в каталоге **%_srcrpmdir**. Пакет SRPM обычно используется для проверки и обновления пакетов программного обеспечения. |



### Параметры команды создания пакета

Для компоновки пакета программного обеспечения используется команда **rpmbuild**. Данная команда выполняет сборку пакетов, компонуя файлы .spec, .tar и файлы с исходным кодом.

Формат команды **rpmbuild:** rpmbuild \[_параметр_...].

В [Табл. 1](#table1342946175212) приведены общие параметры команды **rpmbuild**.

**Табл. 1** Параметры команды создания пакета



| **Параметр**                        | **Описание**                                                 |
| ----------------------------------- | ------------------------------------------------------------ |
| -bp *файл spec*                     | Запуск сборки, начиная с этапа предварительной подготовки **%prep** *файла spec* (распаковка пакета исходного кода и установка патча). |
| -bc *файл spec*                     | Запуск сборки, начиная с этапа компоновки **%build** *файла spec*. |
| -bi *файл spec*                     | Запуск сборки, начиная с этапа установки**%install** *файла spec*. |
| -bl *файл spec*                     | Запуск проверки, начиная с этапа **%file** *файла spec*.     |
| -ba *файл spec*                     | Сборка пакета исходного кода и бинарного пакета с использованием *файла spec*. |
| -bb *файл spec*                     | Сборка бинарного пакета с использованием *файла spec*.       |
| -bs *файл spec*                     | Сборка пакета исходного кода с использованием файла *specfile*. |
| -rp *файл исходного кода*           | Запуск сборки, начиная с этапа предварительной подготовки **%prep** *файла исходного кода* (распаковка пакета исходного кода и установка патча). |
| -rc *sourcefile*                    | Запуск сборки, начиная с этапа компоновки **%build** *файла исходного кода*. |
| -ri *файл исходного кода*           | Запуск сборки, начиная с этапа установки **%install** *файла исходного кода*. |
| -rl *файл исходного кода*           | Запуск сборки, начиная с этапа **%file** *файла исходного кода*. |
| -ra *файл исходного кода*           | Сборка пакета исходного кода и бинарного пакета с использованием *файла исходного кода*. |
| -rb *файл исходного кода*           | Сборка бинарного пакета с использованием *файла исходного кода*. |
| -rs *файл исходного кода*           | Сборка пакета исходного кода с использованием *файла исходного кода*. |
| -tp *файл tar*                      | Запуск сборки, начиная с этапа предварительной подготовки **%prep** *файла tar* (распаковка пакета исходного кода и установка патча). |
| -tc *файл tar*                      | Запуск сборки, начиная с этапа компоновки **%build** *файла tar*. |
| -ti *файл tar*                      | Запуск сборки, начиная с этапа установки **%install** *файла tar*. |
| -ta *файл tar*                      | Сборка пакета исходного кода и бинарного пакета с использованием *файла tar*. |
| -tb *файл tar*                      | Сборка бинарного пакета с использованием *файла tar*.        |
| -ts *файл tar*                      | Сборка пакета исходного кода с использованием *файла tar*.   |
| \-\-buildroot=*КАТАЛОГ*             | *КАТАЛОГ* используется во время сборки и служит для замены каталога по умолчанию **/root**. |
| \-\-clean                           | Удаление файлов из каталога **BUILD**.                       |
| \-\-nobuild                         | Шаги сборки не выполняются. Параметр используется для тестирования файла .spec. |
| \-\-noclean                         | С данным параметром пропускается этап **%clean** файла .spec (даже при его наличии). |
| \-\-nocheck                         | С данным параметром пропускается этап **% check** файла .spec (даже при его наличии). |
| \-\-dbpath *КАТАЛОГ*                | База данных **КАТАЛОГ** используется вместо каталога по умолчанию **/var/lib/rpm**. |
| \-\-root *КАТАЛОГ*                  | С данным параметром настраивается наивысший уровень *КАТАЛОГА*. Значение по умолчанию **/** задает наивысший уровень. |
| \-\-rebuild *файл исходного кода*   | С данным параметром устанавливается указанный *файл исходного кода* из пакета исходного кода, т.е. запускаются операции подготовки, компиляции и установки пакета исходного кода. |
| \-\-recompile *файл исходного кода* | Создается новый бинарный пакет на основе **\-\-recompile**. После завершения сборки каталог сборки, исходный код и файл .spec удаляются. Результат удаления такой же, как и в случае с **\-\-clean**. |
| -?,  \-\-help                       | Отображается подробная информация справочной помощи.         |
| \-\-version                         | Отображается подробная информация о версии.                  |



## Локальное создание пакета RPM

В данном разделе приведен пример локального создания пакета RPM.

### Создание рабочей среды

#### Необходимые условия

Разработчик должен обладать полномочиями пользователя root и настроить источник репозитория для openEuler.

#### Процедура

Для установки инструментов сборки rpmdevtools, в том числе используя команду **rpm-build** и соответствующие зависимости (например, make и gdb), можно воспользоваться инструментом DNF. Выполните следующую команду:

```
# dnf install rpmdevtools*
```

### Создание пакета RPM «Hello World»

Процесс сборки пакета приводится на примере проекта «GNU Hello World». Пакет содержит наиболее распространенные периферийные компоненты, связанные со Свободным и открытым программным обеспечением (Free and Open Source Software; FOSS), включая среды конфигурирования, компиляции и установки, документы и информацию по интернационализации (i18n).

#### Получение исходного кода

Выполните следующую команду, чтобы загрузить исходный код официального примера:

```
$ cd ~/rpmbuild/SOURCES
$ wget http://ftp.gnu.org/gnu/hello/hello-2.10.tar.gz
```

#### Получение SPEC-файла

Выполните следующую команду, чтобы создать файл .spec в каталоге **~/rpmbuild/SPECS**:

```
$ cd ~/rpmbuild/SPECS
$ vi hello.spec 
```

Запишите в файл соответствующее содержимое и сохраните его. Далее приведен пример содержимого файла. Измените соответствующие поля по фактической ситуации.

```
Name:     hello
Version:  2.10
Release:  1%{?dist}
Summary:  The "Hello World" program from GNU
Summary(zh_CN): GNU Hello World program
License:  GPLv3+
URL:      http://ftp.gnu.org/gnu/hello
Source0:  http://ftp.gnu.org/gnu/hello/%{name}-%{version}.tar.gz

BuildRequires:  gettext
Requires(post): info
Requires(preun): info

%description
The "Hello World" program, done with all bells and whistles of a proper FOSS
project, including configuration, build, internationalization, help files, etc.

%description -l zh_CN
The Hello World program contains all parts required by the FOSS project, including configuration, build, i18n, and help files.

%prep
%setup -q

%build
%configure
make %{?_smp_mflags}

%install
make install DESTDIR=%{buildroot}
%find_lang %{name}
rm -f %{buildroot}/%{_infodir}/dir

%post
/sbin/install-info %{_infodir}/%{name}.info %{_infodir}/dir || :

%preun
if [ $1 = 0 ] ; then
/sbin/install-info --delete %{_infodir}/%{name}.info %{_infodir}/dir || :
fi

%files -f %{name}.lang
%doc AUTHORS ChangeLog NEWS README THANKS TODO
%license COPYING
%{_mandir}/man1/hello.1.*
%{_infodir}/hello.info.*
%{_bindir}/hello

%changelog
* Thu Dec 26 2019 Your Name <youremail@xxx.xxx> - 2.10-1
- Update to 2.10
* Sat Dec 3 2016 Your Name <youremail@xxx.xxx> - 2.9-1
- Update to 2.9
```

- Тег **Name** означает название программного обеспечения, тег **Version** — номер версии, а тег **Release** — номер выпуска.
- Тег **Summary** содержит краткое описание. Первая буква тега должна быть заглавной, иначе инструмент проверки сборки (rpmlint) будет генерировать сообщения об ошибке.
- Тег **License** содержит версию протокола программного пакета. За проверку статуса лицензии на программное обеспечение отвечает разработчик. Это можно сделать путем проверки исходного кода или файла лицензии либо пообщавшись с автором.
- Тег **Group** используется для классификации пакетов программного обеспечения с помощью **/usr/share/doc/rpm-/GROUPS**. В настоящее время этот тег удален. Однако в шаблоне VIM этот тег еще присутствует. Его можно удалить. Добавление этого тега не отразится на системе. Тег **%changelog** содержит журнал изменений, сделанных в каждом выпуске, в частности описание патчей устранения ошибок в защите и уязвимостей, имеющихся в предыдущем выпуске. Во избежание генерирования сообщений об ошибке инструментом rpmlint, тег **%changelog** должен содержать строку версии.
- Если используется несколько строк, например %changelog или %description, команду следует начать со следующей строки и завершить пустой строкой.
- Некоторые ненужные строки (например, BuildRequires и Requires) можно отметить знаком номера (#), который ставится в начале строки.
- Значения по умолчанию **%prep**, **%build**, **%install** и **%file** следует оставить.

#### Создание пакета в формате RPM

Чтобы скомпоновать исходный код, файлы в двоичном формате и пакеты программного обеспечения, содержащие отладочную информацию, выполните следующую команду в каталоге, где находится файл .spec:

```
$ rpmbuild -ba hello.spec 
```

Проверьте результат выполнения следующей командой:

```
$ tree ~/rpmbuild/*RPMS

/home/testUser/rpmbuild/RPMS
└── aarch64
    ├── hello-2.10-1.aarch64.rpm
    ├── hello-debuginfo-2.10-1.aarch64.rpm
    └── hello-debugsource-2.10-1.aarch64.rpm
/home/testUser/rpmbuild/SRPMS
└── hello-2.10-1.src.rpm
```

## Создание пакета RPM с помощью платформы сборки OBS

В данном разделе описана процедура сборки пакета программного обеспечения в формате RPM с использованием платформы OBS на веб-странице или с помощью OSC. Доступны два метода создания:

- Изменение существующего пакета программного обеспечения: необходимо изменить исходный код существующего пакета программного обеспечения и встроить измененный исходный код в пакет RPM.
- Добавление пакета программного обеспечения: новый исходный файл программного обеспечения разрабатывается с нуля, а созданный файл с исходным кодом используется для компоновки пакета RPM.

### Общее представление о платформе сборки OBS

OBS — это общий компилятор, основанный на дистрибутиве openSUSE. Он используется для встраивания пакетов исходного кода в пакеты программного обеспечения или образы Linux. В OBS применяется распределенный режим автоматической компиляции. Данный инструмент поддерживает компиляцию образов и установочных пакетов дистрибутивов ОС Linux (например, openEuler, SUSE и Debian) на разных архитектурных платформах (таких как х86 и АРМ64).

OBS состоит из препроцессорного (frontend) и постпроцессорного (backend) компиляторов. Постпроцессорный компилятор выполняет все основные функции. Препроцессорный компилятор предоставляет веб-приложения и API-интерфейсы для взаимодействия с постпроцессорным компонентом. Кроме того, на платформе OBS доступен клиентский инструмент OSC для работы с командной строкой через API, который создается в независимом репозитории.

OBS создает проект, используя пакет программного. В проекте можно указать базовые функции управления полномочиями, соответствующие репозитории и объекты сборки (ОС и архитектура). Проект может содержать несколько подпроектов. Каждый подпроект можно сконфигурировать отдельно для выполнения одной определенной задачи.

### Создание пакета программного обеспечения в формате RPM в режиме онлайн

В данном разделе приведена процедура создания пакета программного обеспечения в формате RPM в режиме онлайн на платформе сборки Open Build Service (OBS).

#### Сборка на основе существующего пакета программного обеспечения

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:
> 
> - При первом использовании OBS необходимо зарегистрировать отдельный аккаунт на веб-странице OBS.
> - Используя данный метод, необходимо скопировать измененный код и зафиксировать изменения в каталоге хранения кода перед выполнением следующих операций. Каталог хранения кода указывается в файле **\_service**.

Для изменения исходного кода существующего программного обеспечения и встраивания файла с измененным исходным кодом в пакет RPM на веб-клиенте OBS выполните следующие шаги:

1. Зарегистрируйтесь на OBS-платформе [https://build.openeuler.org/](https://build.openeuler.org/).

2. Нажмите **All Projects**. Откроется страница **All Projects**.

3. Нажмите на проект, который необходимо изменить. Откроется страница с подробной информацией о проекте. Выберите, например, **openEuler:Mainline**.

4. На странице подробной информации о проекте найдите пакет программного обеспечения, который необходимо изменить, и нажмите на его имя. Откроется страница с подробной информацией о пакете программного обеспечения.

5. Выберите **Branch package**. В появившемся диалоговом окне нажмите **Accept**, см. [Рис. 1](#fig77646143214).
   
   **Рис. 1** Страница **Branch Confirmation**  
![](./figures/branch-confirmation-page.png "branch-confirmation-page")

6. Щелкните файл **\_service**, чтобы перейти на страницу редактирования, измените содержимое файла и нажмите **Save**. Пример содержимого файла **\_service**: *UserCodeURL* — это путь к коду пользователя, а *UserCommitID* — номер версии с зафиксированными изменениями или ветка.
   
   ```
   <services>
       <service name="tar_scm_kernel">
           <param name="scm">git</param>
           <param name="url">userCodeURL</param>
   	<param name="revision">userCommitID</param>
       </service>
       <service name="recompress">
   	<param name="compression">bz2</param>
   	<param name="file">*.tar</param>
        </service>
   </services>
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Нажмите кнопку **Save**, чтобы сохранить файл **_service**. OBS загружает исходный код с указанного URL-адреса в каталог хранения программных файлов соответствующего проекта OBS на основе описания, содержащегося в файле **\_service,** и заменяет исходный файл. В вышеуказанном примере это каталог **kernel** проекта **openEuler:Mainline**.

7. После копирования и замены файлов OBS автоматически начинает сборку пакета программного обеспечения в формате RPM. Дождитесь завершения сборки и проверьте состояние сборки в строке состояния, расположенной справа.
   
   - **succeeded**: сборка прошла успешно. Нажмите **succeeded**, чтобы посмотреть журналы сборки, см. [Рис. 2](#fig10319114217337).
     
     **Рис. 2** Страница **Succeeded**  
![](./figures/succeeded-page.png "succeeded-page")
   
   - **failed**: сбой процесса сборки. Проверьте журнал ошибок, нажав **failed**, найдите ошибку и повторите сборку.
   
   - **unresolvable**: сборка не выполнена. Возможная причина в отсутствии зависимости.
   
   - **disabled**: процесс сборки закрыт вручную или поставлен в очередь.
   
   - **excluded**: сборка запрещена. Возможная причина заключается в отсутствии файла .spec или запрете компиляции целевой архитектуры в файле .spec.

#### Добавление пакета программного обеспечения

Для добавления нового пакета программного обеспечения на web-странице платформы OBS выполните следующие шаги:

1. Войдите в консоль платформы OBS.

2. Выберите проект согласно зависимости нового пакета. Для этого щелкните **All Projects** и выберите соответствующий проект, например **openEuler:Mainline**.

3. В проекте выберите пакет программного обеспечения. Откроется страница с подробной информацией о пакете программного обеспечения.

4. Выберите **Branch package**. На открывшейся странице подтверждения нажмите кнопку **Accept**.

5. Чтобы удалить пакет ПО в новом подпроекте, щелкните **Delete package**, см. [Рис. 3](#fig18306181103615).
   
   **Рис. 3** Удаление пакета ПО из подпроекта  
![](./figures/deleting-a-software-package-from-a-subproject.png "deleting-a-software-package-from-a-subproject")
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
При создании проекта с помощью существующего программного обеспечения наследуется такая зависимость, как среда. Поэтому необходимо удалить эти файлы.

6. Выберите **Create Package**. На открывшейся странице введите имя, заголовок и описание пакета программного обеспечения, а затем нажмите **Create**, чтобы создать пакет программного обеспечения, см. [Рис. 4](#fig6762111693811) и [Рис. 5](#fig18351153518389).
   
   **Рис. 4** Страница **Create Package**   
![](./figures/create-package-page.png "create-package-page")
   
   **Рис. 5** Создание пакета программного обеспечения  
![](./figures/creating-a-software-package.png "creating-a-software-package")

7. Нажмите **Add file**, чтобы выгрузить файл .spec и компилируемый файл (указанный в файле .spec), см. [Рис. 6](#fig1475845284011).
   
   **Рис. 6** Страница **Add file**   
![](./figures/add-file-page.png "add-file-page")

8. После выгрузки файла OBS автоматически начинает сборку пакета программного обеспечения в формате RPM. Дождитесь завершения сборки и проверьте состояние сборки в строке состояния, расположенной справа.
   
   - **succeeded**: сборка прошла успешно. Нажмите **succeeded**, чтобы посмотреть журналы сборки.
   - **failed**: сбой процесса сборки. Проверьте журнал ошибок, нажав **failed**, найдите ошибку и повторите сборку.
   - **unresolvable**: сборка не выполнена. Возможная причина в отсутствии зависимости.
   - **disabled**: процесс сборки закрыт вручную или поставлен в очередь.
   - **excluded**: сборка запрещена. Возможная причина заключается в отсутствии файла .spec или запрете компиляции целевой архитектуры в файле .spec.

#### Получение пакета программного обеспечения

После сборки пакета программного обеспечения в формате RPM необходимо получить пакет на веб-странице, выполнив следующие операции:

1. Войдите в консоль платформы OBS.

2. Нажмите **All Projects** и найдите проект, соответствующий целевому пакету программного обеспечения, например **openEuler:Mainline**.

3. В проекте щелкните имя данного пакета. Откроется страница с подробной информацией о пакете программного обеспечения. В вышеуказанном примере это страница **kernel**.

4. Выберите вкладку **Repositories**. На открывшейся странице управления репозиторием программного обеспечения включите функцию загрузки пакета ПО, щелкнув **Enable** в **Publish Flag** (статус ![](./figures/en-us_image_0229243704.png) изменится на ![](./figures/en-us_image_0229243702.png)), см. [Рис. 7](#fig17480830144217).
   
   **Рис. 7** Страница **Repositories**  
![](./figures/repositories-page.png "repositories-page")

5. Щелкните имя проекта в столбце **Repository**. На открывшейся странице загрузки пакета программного обеспечения в формате RPM загрузите пакет, нажав **Download** справа от пакета, см. [Рис. 8](#fig12152145615438).
   
   **Рис. 8** Страница загрузки пакета программного обеспечения в формате RPM  
![](./figures/rpm-software-package-download-page.png "rpm-software-package-download-page")

### Создание пакета программного обеспечения с помощью OSC

В данном разделе описывается метод создания проекта и сборки пакета программного обеспечения в формате RPM с использованием инструмента OSC для работы в командной строке, имеющегося на платформе OBS.

#### Установка и настройка OSC

##### Необходимые условия

Разработчик должен обладать полномочиями пользователя root и настроить источник репозитория для openEuler.

##### Процедура

1. Установите инструмент OSC для работы с командной строкой и его зависимость в качестве пользователя **root**.
   
   ```
   # dnf install osc build
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Процесс компиляции пакетов программного обеспечения в формате RPM зависит от сборки.

2. Сконфигурируйте OSC.
   
   1. Выполните следующую команду, чтобы открыть файл **~/.oscrc**:
      
      ```
      $ vi ~/.oscrc
      ```
   
   2. Добавьте в **~/.oscrc** поля **user** и **pass**. _userName_ и _passWord_ — это имя пользователя и пароль соответственно учетной записи, зарегистрированной на веб-странице платформы OBS ([https://build.openeuler.org/](https://build.openeuler.org/)).
      
      ```
      [general]
      apiurl = https://build.openeuler.org/
      [https://build.openeuler.org/]
      user=userName
      pass=passWord
      ```

#### Сборка на основе существующего пакета программного обеспечения

**Создание проекта**

1. Скопировав существующий проект, можно создать собственный подпроект. Например, чтобы скопировать пакет программного обеспечения **zlib** проекта **openEuler:Mainline** в новую ветвь, выполните следующую команду:
   
   ```
   $ osc branch openEuler:Mainline zlib
   ```
   
   Если на экран выводится нижеприведенная информация, значит, для пользователя **testUser** создана новая ветвь проекта **home:testUser:branches:openEuler:Mainline**.
   
   ```
   A working copy of the branched package can be checked out with:
   osc co home:testUser:branches:openEuler:Mainline/zlib
   ```

2. Загрузите конфигурационный файл (например, **\_service**) пакета программного обеспечения, который необходимо изменить, в локальный каталог. В вышеприведенной команде *testUser* означает имя пользователя учетной записи, указанной в конфигурационном файле **~/.oscrc**. Измените значение в соответствии с фактическими требованиями.
   
   ```
   $ osc co home:testUser:branches:openEuler:Mainline/zlib
   ```
   
   На экране появится информация, подобная следующей:
   
   ```
   A    home:testUser:branches:openEuler:Mainline
   A    home:testUser:branches:openEuler:Mainline/zlib
   A    home:testUser:branches:openEuler:Mainline/zlib/_service
   ```

3. Перейдите в локальный каталог подпроектов и синхронизируйте код пакета программного обеспечения на удаленном конце с кодом на локальном хосте.
   
   ```
   $ cd home:testUser:branches:openEuler:Mainline/zlib
   $ osc up -S
   ```
   
   На экране появится информация, подобная следующей:
   
   ```
   A    _service:tar_scm_kernel_repo:0001-Neon-Optimized-hash-chain-rebase.patch
   A    _service:tar_scm_kernel_repo:0002-Porting-optimized-longest_match.patch
   A    _service:tar_scm_kernel_repo:0003-arm64-specific-build-patch.patch
   A    _service:tar_scm_kernel_repo:zlib-1.2.11-optimized-s390.patch
   A    _service:tar_scm_kernel_repo:zlib-1.2.11.tar.xz
   A    _service:tar_scm_kernel_repo:zlib-1.2.5-minizip-fixuncrypt.patch
   A    _service:tar_scm_kernel_repo:zlib.spec
   ```

**Создание пакета в формате RPM**

1. Переименуйте файл с исходным кодом и добавьте переименованный файл во временное хранилище OBS.
   
   ```
   $ rm -f _service;for file in `ls | grep -v .osc`;do new_file=${file##*:};mv $file $new_file;done
   $ osc addremove *
   ```

2. Измените исходный код и файл .spec, а затем обновите файл следующей командой.
   
   ```
   $ osc up
   ```

3. Синхронизируйте все изменения, внесенные в соответствующий пакет программного обеспечения, с сервером OBS. Пример выполнения команды (информация после параметра **-m** указывает на запись об отправке):
   
   ```
   $ osc ci -m "commit log"
   ```

4. Чтобы получить имя репозитория и архитектуру текущего проекта, выполните следующую команду:
   
   ```
   $ osc repos home:testUser:branches:openEuler:Mainline
   ```

5. После фиксации изменений OBS автоматически компилирует пакет программного обеспечения. Для просмотра журналов компиляции соответствующего репозитория выполните следующую команду. В данной команде *standard\_aarch64* — это имя репозитория, а _aarch64_ — архитектура, содержащиеся в выходных данных команды.
   
   ```
   $ osc buildlog standard_aarch64  aarch64
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Просмотреть журналы сборки можно также, открыв созданный проект на веб-клиенте.

#### Добавление пакета программного обеспечения

Чтобы добавить новый пакет программного обеспечения с помощью инструмента OSC платформы OBS, выполните следующие шаги:

**Создание проекта**

1. Создайте проект согласно зависимости нового пакета программного обеспечения и требуемого проекта. Например, чтобы создать проект на основе **zlib** проекта **openEuler:Mainline**, выполните следующую команду (**zlib** — это любой пакет программного обеспечения в проекте):
   
   ```
   $ osc branch openEuler:Mainline zlib
   ```

2. Удалите ненужные пакеты, добавленные во время создания проекта. Например, для удаления пакета **zlib** выполняется команда:
   
   ```
   $ cd home:testUser:branches:openEuler:Mainline
   $ osc rm zlib
   $ osc commit -m "commit log"
   ```

3. В своем проекте создайте пакет программного обеспечения. Например, для добавления пакета **my-first-obs-package** выполняется команда:
   
   ```
   $ mkdir my-first-obs-package 
   $ cd my-first-obs-package
   ```

**Создание пакета в формате RPM**

1. Добавьте подготовленный файл с исходным кодом и файл .spec в каталог пакета программного обеспечения.

2. Измените исходный код и файл .spec, выгрузите все файлы соответствующего пакета программного обеспечения на сервер OBS. Пример выполнения команды (информация после параметра **-m** указывает на запись о вводе в действие):
   
   ```
   $ cd home:testUser:branches:openEuler:Mainline
   $ osc add my-first-obs-package
   $ osc ci -m "commit log"
   ```

3. Чтобы получить имя репозитория и архитектуру текущего проекта, выполните следующую команду:
   
   ```
   $ osc repos home:testUser:branches:openEuler:Mainline
   ```

4. После фиксации изменений OBS автоматически компилирует пакет программного обеспечения. Для просмотра журналов компиляции соответствующего репозитория выполните следующую команду. В данной команде _standard\_aarch64_ — это имя репозитория, а _aarch64_ — архитектура, содержащиеся в выходных данных команды.
   
   ```
   $ cd home:testUser:branches:openEuler:Mainline/my-first-obs-package
   $ osc buildlog standard_aarch64  aarch64
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Просмотреть журналы сборки можно также, открыв созданный проект на веб-клиенте.

#### Получение пакета программного обеспечения

После сборки пакета программного обеспечения в формате RPM необходимо получить пакет с помощью OSC, выполнив следующие операции:

```
$ osc getbinaries home:testUser:branches:openEuler:Mainline my-first-obs-package standard_aarch64 aarch64
```

Далее приведено описание параметров команды. Измените значения параметров в соответствии с фактической ситуацией.

- _home:testUser:branches:openEuler:Mainline_: имя проекта, которому принадлежит пакет программного обеспечения.
- _my-first-obs-package_: имя пакета программного обеспечения.
- _standard\_aarch64_: имя репозитория.
- _aarch64_: имя архитектуры репозитория.

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Пакет программного обеспечения, собранный с помощью инструмента OSC, можно также получить на веб-странице. Для получения подробной информации обратитесь к разделу [Получение пакета программного обеспечения](#obtaining-the-software-package).