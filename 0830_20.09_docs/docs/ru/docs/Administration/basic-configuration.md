# Базовая конфигурация

\[\[toc]]

## Настройка языка системы

Настройки языка системы хранятся в файле /etc/locale.conf, и их можно изменить командой localectl. Эти настройки считывает демон systemd во время загрузки системы.

### Отображение текущего языка системы

Чтобы отобразить текущий язык системы, выполните следующую команду:

```
$ localectl status
```

Пример командного вывода:

```
$ localectl status
   System Locale: LANG=zh_CN.UTF-8
       VC Keymap: cn
      X11 Layout: cn
```

### Список доступных языков

Чтобы отобразить доступные языки, выполните следующую команду:

```
$ localectl list-locales
```

В качестве проверки выведите все доступные варианты китайского языка следующей командой:

```
$ localectl list-locales | grep zh
zh_CN.UTF-8
```

### Установка языка

Чтобы установить языковую среду, выполните следующую команду как пользователь **root**. В данной команде *locale* означает язык, который необходимо установить. Выполните команду **localectl list-locales**, чтобы получить доступные значения. Измените значение в соответствии с требованиями площадки.

```
# localectl set-locale LANG=locale
```

Например, если планируется использовать упрощенный китайский (Simplified Chinese), выполните следующую команду как пользователь **root**:

```
# localectl set-locale LANG=zh_CN.UTF-8
```

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:

> После изменения войдите снова или выполните команду `source /etc/locale.conf` как пользователь **root** для обновления конфигурационного файла, чтобы изменение вступило в силу:

## Настройка раскладки клавиатуры

Настройки раскладки клавиатуры хранятся в файле /etc/locale.conf, и их можно изменить командой localectl. Эти настройки считывает демон systemd во время ранней загрузки системы.

### Отображение текущих настроек

Чтобы отобразить текущие настройки раскладки клавиатуры, выполните следующую команду:

```
$ localectl status
```

Пример командного вывода:

```
$ localectl status
   System Locale: LANG=zh_CN.UTF-8
       VC Keymap: cn
      X11 Layout: cn
```

### Вывод доступных значений раскладки клавиатуры

Чтобы вывести все доступные значения раскладки клавиатуры, которые можно установить в ОС openEuler, выполните следующую команду:

```
$ localectl list-keymaps
```

Например, командный вывод китайской раскладки клавиатуры выглядит следующим образом:

```
$ localectl list-keymaps | grep cn
cn
```

### Настройка раскладки клавиатуры

Чтобы установить раскладку клавиатуры, выполните следующую команду как пользователь **root**. В данной команде *map* означает раскладку клавиатуры, которую необходимо установить. Выполните команду **localectl list-keymaps**, чтобы получить доступные значения. Измените значение в соответствии с требованиями площадки.

```
$ localectl set-keymap map
```

Данная раскладка будет одновременно применена к графическим пользовательским интерфейсам.

Далее проверив статус, убедитесь, что настройки применены:

```
$ localectl status
   System Locale: LANG=zh_CN.UTF-8
       VC Keymap: cn
      X11 Layout: us
```

## Установка даты и времени

В данном разделе описывается процедура установки даты, времени и часового пояса системы с помощью команд timedatectl, date и hwclock.

### Использование команды timedatectl

#### Отображение текущей даты и времени

Чтобы отобразить текущую дату и время, выполните следующую команду:

```
$ timedatectl
```

Пример командного вывода:

```
$ timedatectl
               Local time: Mon 2019-09-30 04:05:00 EDT
           Universal time: Mon 2019-09-30 08:05:00 UTC
                 RTC time: Mon 2019-09-30 08:05:00
                Time zone: America/New_York (EDT, -0400)
System clock synchronized: no
              NTP service: inactive
          RTC in local TZ: no
```

#### Синхронизация системных часов с удаленным сервером

Системные часы можно автоматически синхронизировать с удаленным сервером с помощью протокола сетевого времени (Network Time Protocol; NTP). Выполните следующую команду как пользователь **root**, чтобы включить или отключить NTP. Параметр *boolean* принимает значения **yes** (NTP включен) или **no** (NTP выключен) для автоматической синхронизации системных часов. Измените значение в соответствии с требованиями площадки.

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Если удаленный сервер NTP включен для автоматической синхронизации системных часов, вручную изменить дату и время нельзя. Если необходимо вручную изменить дату или время, убедитесь, что автоматическая синхронизация системных часов с помощью NTP отключена. Служба NTP отключается командой **timedatectl set-ntp no**.

```
# timedatectl set-ntp boolean
```

Пример команды включения автоматической удаленной синхронизации системных часов:

```
# timedatectl set-ntp yes
```

#### Изменение текущей даты

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Перед изменением даты убедитесь, что автоматическая синхронизация системы NTP отключена.

Чтобы изменить текущую дату, выполните следующую команду как пользователь **root**: В команде *YYYY* означает год, *MM* — месяц, а *DD* — день. Измените их в соответствии с требованиями площадки.

```
# timedatectl set-time YYYY-MM-DD
```

Например, для установки в качестве текущей даты 14 августа 2019 года выполните следующую команду как пользователь **root**:

```
# timedatectl set-time '2019-08-14'
```

#### Изменение текущего времени

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Перед изменением времени убедитесь, что автоматическая синхронизация системы NTP отключена.

Чтобы изменить текущее время, выполните следующую команду как пользователь **root**. В команде *HH* означает часы, *MM* — минуты, а *SS* — секунды. Измените их в соответствии с требованиями площадки.

```
# timedatectl set-time HH:MM:SS
```

Например, чтобы установить текущее время 15:57:24, необходимо выполнить следующую команду:

```
# timedatectl set-time 15:57:24
```

#### Изменение часового пояса

Чтобы отобразить список доступных часовых поясов, выполните следующую команду:

```
$ timedatectl list-timezones
```

Чтобы изменить текущий часовой пояс, выполните следующую команду как пользователь **root**. В данной команде *_time\_zone_* означает часовой пояс, который необходимо установить. Измените значение в соответствии с требованиями площадки.

```
# timedatectl set-timezone time_zone
```

Допустим, вы находитесь в Азии и вам необходимо определить, какой часовой пояс ближе всего к вашему текущему местоположению. Это можно проверить это с помощью следующей команды, которая выведет все доступные часовые поясы в Азии:

```
# timedatectl list-timezones | grep Asia
Asia/Aden
Asia/Almaty
Asia/Amman
Asia/Anadyr
Asia/Aqtau
Asia/Aqtobe
Asia/Ashgabat
Asia/Baghdad
Asia/Bahrain
......

Asia/Seoul
Asia/Shanghai
Asia/Singapore
Asia/Srednekolymsk
Asia/Taipei
Asia/Tashkent
Asia/Tbilisi
Asia/Tehran
Asia/Thimphu
Asia/Tokyo
```

Пример установки часового пояса Asia/Shanghai:

```
# timedatectl set-timezone Asia/Shanghai
```

### Использование команды date

#### Отображение текущей даты и времени

Чтобы отобразить текущую дату и время, выполните следующую команду:

```
$ date
```

По умолчанию команда **date** отображает местное время. Чтобы отобразить время в формате Всемирного координированного времени (Coordinated Universal Time; UTC), выполните команду с параметром --utc или -u:

```
$ date --utc
```

Также можно настроить формат отображаемой информации, добавив параметр +"формат" в командной строке:

```
$ date +"format"
```

**Табл. 1** Параметры формата

| **Параметр команды** | **Описание**                                                 |
| -------------------- | ------------------------------------------------------------ |
| %H                   | Часы в формате ЧЧ (например, 17)                             |
| %M                   | Минуты в формате ММ (например, 37)                           |
| %S                   | Секунды в формате СС (например, 25)                          |
| %d                   | День месяца в формате ДД (например, 15)                      |
| %m                   | Месяц в формате ММ (например, 07)                            |
| %Y                   | Год в формате ГГГГ (например, 2019)                          |
| %Z                   | Сокращение часового пояса (например, CEST)                   |
| %F                   | Полная дата в формате ГГГГ-ММ-ДД (например, 2019-07-15). Этот параметр равен %Y-%m-%d. |
| %T                   | Полное время в формате ЧЧ:ММ:СС (например, 18:30:25). Этот параметр равен %H:%M:%S. |



Примеры команд с результатами выполнения:
- Отображение текущей даты и времени:
  
  ```
  $ date 
  Sat Aug  17 17:26:34 CST 2019
  ```

- Отображение текущей даты и времени в формате UTC:
  
  ```
  $ date --utc
  Sat Aug  17 09:26:18 UTC 2019
  ```

- Настройка вывода команды date:
  
  ```
  $ date +"%Y-%m-%d %H:%M"
  2019-08-17 17:24
  ```

#### Изменение текущего времени

Чтобы изменить текущее время, выполните команду date с параметром --set или -s как пользователь root. Как пользователь **root** выполните следующую команду. В команде *HH* означает часы, *MM* — минуты, а *SS* — секунды. Измените их в соответствии с требованиями площадки.

```
# date --set HH:MM:SS
```

По умолчанию команда **date** отображает местное время. Чтобы настроить время системы в формате UTC, выполните команду с параметром --utc или -u:

```
# date --set HH:MM:SS --utc
```

Например, для установки текущего времени 23:26:00 выполните следующую команду как пользователь **root**:

```
# date --set 23:26:00
```

#### Изменение текущей даты

Чтобы изменить текущую дату, выполните команду с параметром --set или -s. Как пользователь **root** выполните следующую команду. В команде *YYYY* означает год, *MM* — месяц, а *DD* — день. Измените их в соответствии с требованиями площадки.

```
# date --set YYYY-MM-DD
```

Например, для установки в качестве текущей даты 2 ноября 2019 года выполните следующую команду как пользователь **root**:

```
# date --set 2019-11-02
```

### Использование команды hwclock

Команда hwclock используется для установки часов реального времени (Real Time Clock; RTC).

#### Часы реального времени и системные часы

В ОС Linux используются следующие типы часов:

- Системные часы: часы текущего ядра Linux.
- Аппаратные часы реального времени: аппаратные часы материнской платы с питанием от батареи. Эти часы можно настроить с помощью параметра **Standard BIOS Feature** в системе BIOS.

Во время запуска операционная система Linux считывает значение часов RTC и устанавливает системное время часов на основе этого значения.

#### Отображение текущей даты и времени

Чтобы отобразить текущую дату и время RTC, выполните следующую команду в качестве пользователя **root**:

```
# hwclock
```

Пример командного вывода:

```
# hwclock
2019-08-26 10:18:42.528948+08:00
```

#### Установка даты и времени

Чтобы изменить текущую дату и время текущего оборудования, выполните следующую команду как пользователь **root**. В данной команде *dd* означает день, *mm* — месяц, *yyyy* — год, *HH* — часы, *MM* — минуты. Измените их в соответствии с требованиями площадки.

```
# hwclock --set --date "dd mm yyyy HH:MM"
```

Например, чтобы установить текущее время 21:17 и дату 21 октября 2019 года, необходимо выполнить следующую команду:

```
# hwclock --set --date "21 Oct 2019 21:17" --utc
```

## Настройка kdump

В этом разделе описывается процедура настройки памяти, резервируемой под службу kdump, и изменения параметров в конфигурационном файле kdump.

### Настройка памяти, резервируемой под службу kdump

#### Форматы параметров памяти, резервируемой под службу kdump

Память, резервируемую под службу kdump, необходимо добавить к аргументам загрузки в конфигурационном файле **/boot/efi/EFI/openEuler/grub.cfg**. Память, резервируемая под службу kdump, добавлена в выпущенную версию openEuler по умолчанию и при необходимости ее настройки можно изменить. Добавив или изменив аргументы загрузки bootargs, перезапустите систему, чтобы настройки вступили в силу. Для памяти, резервируемой под службу kdump, используются следующие аргументы загрузки:

| Аргумент загрузки (Bootarg)          | Описание                                                     | Значение по умолчанию                                     | Примечания                                                   |
| ------------------------------------ | ------------------------------------------------------------ | --------------------------------------------------------- | ------------------------------------------------------------ |
| crashkernel=x                        | Если размер физической памяти меньше 4 ГБ, службе kdump выделяется память объемом х. | Значение по умолчанию — 512 MB для x86.                   | Настройка этого параметра необходима только в том случае, если память меньше 4 ГБ. Убедитесь, что доступной для непрерывного использования памяти достаточно. |
| crashkernel=x@y                      | Данный параметр резервирует объем памяти x в начальном адресе y для службы kdump. | Не используется                                           | Убедитесь, что объем памяти x в начальном адресе y не выделен для других модулей. |
| crashkernel=x,high                   | Если размер физической памяти меньше 4 ГБ, выделяется память объемом 256 МБ. Если размер физической памяти больше 4 ГБ, службе kdump выделяется память объемом х. | Значение по умолчанию — 1024M,high для архитектуры ARM64. | Убедитесь, что размер доступного непрерывного пространства физической памяти превышает или равен 256 МБ, если размер памяти меньше 4 ГБ, и превышает или равен х, если размер памяти больше 4 ГБ. Фактический размер зарезервированной памяти равен 256 МБ + x. |
| crashkernel=x,low crashkernel=y,high | Данный параметр резервирует для службы kdump объем пространства x, если размер физической меньше 4 ГБ, и объем пространства y, если размер физической больше 4 ГБ. | Не используется                                           | Убедитесь, что размер доступного непрерывного пространства физической памяти превышает или равен x, если размер физической памяти меньше 4 ГБ, и превышает или равен y, если размер физической памяти больше 4 ГБ. |

### Рекомендуемый размер выделяемой памяти

| Рекомендуемое решение | Зарезервированный параметр | Описание                                                     |
| --------------------- | -------------------------- | ------------------------------------------------------------ |
| Общее решение         | crashkernel=2048M,high     | Если размер физической памяти меньше 4 ГБ, службе kdump выделяется пространство объемом 256 МБ. Если размер физической памяти больше 4 ГБ, службе kdump выделяется пространство объемом 2048 МБ. Общий объем 256 + 2048 МБ. |
| Экономичное решение   | crashkernel=1024M,high     | Если размер физической памяти меньше 4 ГБ, службе kdump выделяется пространство объемом 256 МБ. Если размер физической памяти больше 4 ГБ, службе kdump выделяется пространство объемом 1024 МБ. Общий объем 256 + 1024 МБ. Не рекомендуется выгружать файлы kdump по сети в случае, если размер памяти системы меньше 512 ГБ. В сценариях с использованием виртуальных машин объем резервируемой памяти можно уменьшить. Рекомендуется установить параметру crashkernel значение 512М или 256M,high. |
> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:
> 
> Если файлы kdump не выгружаются по сети, необходимо настроить файловую систему kdump без упаковки сетевых драйверов. Загрузка сетевого драйвера занимает большой объем памяти. В результате, памяти, зарезервированной для kdump, может быть недостаточно, и служба kdump не сможет запуститься. Поэтому рекомендуется отключить сетевые драйверы.

### Отключение сетевых драйверов

В конфигурационном файле **/etc/kdump.conf** службы kdump параметры dracut могут использоваться для индивидуальной настройки модуля драйверов. Сетевой драйвер можно включить в список индивидуально настроенных драйверов, чтобы предотвратить загрузку драйвера файловой системой kdump. Изменив конфигурационный файл, перезапустите службу kdump, чтобы изменение вступило в силу. Установите параметры dracut следующим образом:

`dracut_args --omit-drivers "mdio-gpi usb_8dev et1011c rt2x00usb bcm-phy-lib mac80211_hwsim rtl8723be rndis_host hns3_cae amd vrf rtl8192cu mt76x02-lib int51x1 ppp_deflate team_mode_loadbalance smsc911x aweth bonding mwifiex_usb hnae dnet rt2x00pci vaser_pci hdlc_ppp marvell rtl8xxxu mlxsw_i2c ath9k_htc rtl8150 smc91x cortina at803x rockchip cxgb4 spi_ks8995 mt76x2u smsc9420 mdio-cavium bnxt_en ch9200 dummy macsec ice mt7601u rtl8188ee ixgbevf net1080 liquidio_vf be2net mlxsw_switchx2 gl620a xilinx_gmii2rgmii ppp_generic rtl8192de sja1000_platform ath10k_core cc770_platform realte igb c_can_platform c_can ethoc dm9601 smsc95xx lg-vl600 ifb enic ath9 mdio-octeon ppp_mppe ath10k_pci cc770 team_mode_activebackup marvell10g hinic rt2x00lib mlx4_en iavf broadcom igc c_can_pci alx rtl8192se rtl8723ae microchip lan78xx atl1c rtl8192c-common almia ax88179_178a qed netxen_nic brcmsmac rt2800usb e1000 qla3xxx mdio-bitbang qsemi mdio-mscc-miim plx_pci ipvlan r8152 cx82310_eth slhc mt76x02-usb ems_pci xen-netfront usbnet pppoe mlxsw_minimal mlxsw_spectrum cdc_ncm rt2800lib rtl_usb hnae3 ath9k_common ath9k_hw catc mt76 hns_enet_drv ppp_async huawei_cdc_ncm i40e rtl8192ce dl2 qmi_wwan mii peak_usb plusb can-dev slcan amd-xgbe team_mode_roundrobin ste10Xp thunder_xcv pptp thunder_bgx ixgbe davicom icplus tap tun smsc75xx smsc dlci hns_dsaf mlxsw_core rt2800mmi softing uPD60620 vaser_usb dp83867 brcmfmac mwifiex_pcie mlx4_core micrel team macvlan bnx2 virtio_net rtl_pci zaurus hns_mdi libcxgb hv_netvsc nicvf mt76x0u teranetics mlxfw cdc_eem qcom-emac pppox mt76-usb sierra_net i40evf bcm87xx mwifiex pegasus rt2x00mmi sja1000 ena hclgevf cnic cxgb4vf ppp_synctty iwlmvm team_mode_broadcast vxlan vsockmon hdlc_cisc rtl8723-common bsd_comp fakelb dp83822 dp83tc811 cicada fm10 8139t sfc hs geneve hclge xgene-enet-v2 cdc_mbim hdlc asix netdevsim rt2800pci team_mode_random lxt ems_usb mlxsw_pci sr9700 mdio-thunder mlxsw_switchib macvtap atlantic cdc_ether mcs7830 nicpf mdi peak_pci atl1e cdc_subset ipvtap btcoexist mt76x0-common veth slip iwldvm bcm7xxx vitesse netconsole epic100 myri10ge r8169 qede microchip_t1 liquidi bnx2x brcmutil mwifiex_sdi mlx5_core rtlwifi vmxnet3 nlmon hns3 hdlc_raw esd_usb2 atl2 mt76x2-common iwlwifi mdio-bcm-unimac national ath rtwpci rtw88 nfp rtl8821ae fjes thunderbolt-net 8139cp atl1 mscc vcan dp83848 dp83640 hdlc_fr e1000e ipheth net_failover aquantia rtl8192ee igbvf rocker intel-xway tg3" --omit "ramdisk network ifcfg qemu-net" --install "chmod" --nofscks`