# Управление ресурсами контейнера

- [Управление ресурсами контейнера](#container-resource-management)
  - [Общий доступ к ресурсам](#sharing-resources)
  - [Ограничение ресурсов процессора, занимаемых работающим контейнером](#restricting-cpu-resources-of-a-running-container)
  - [Ограничение ресурсов памяти, занимаемых работающим контейнером](#restricting-the-memory-usage-of-a-running-container)
  - [Ограничение ресурсов модуля ввода-вывода, занимаемых работающим контейнером](#restricting-i-o-resources-of-a-running-container)
  - [Ограничение пространства памяти файловой системы, занимаемой контейнером](#restricting-the-rootfs-storage-space-of-a-container)
  - [Ограничение количества файловых дескрипторов в контейнере](#restricting-the-number-of-file-handles-in-a-container)
  - [Ограничение количества процессов или потоков, которые могут быть созданы в контейнере](#restricting-the-number-of-processes-or-threads-that-can-be-created-in-a-container)
  - [Настройка значения ulimit в контейнере](#configuring-the-ulimit-value-in-a-container)

## Общий доступ к ресурсам

### Описание

Контейнеры или контейнеры и хосты могут обмениваться друг с другом информацией о пространстве имен, в том числе данными PID, информацией о сети, IPC и UTS.

### Использование

При выполнении команды **isula create/run** можно настроить параметры пространства имен для совместного использования ресурсов. Для получения подробной информации см. таблицу с описанием параметров.

### Параметры

При выполнении команды **lcrc create/run** можно указать следующие параметры:

| Параметр | Описание                                                     | Диапазон значений                                            | Обязательный |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --pid    | Пространство имен PID, которое будет использоваться совместно. | **[none, host, container:]**: **none** означает, что пространство имен не является общим.  <br />**host** означает, что пространство имен общее с хостом.  <br />**container:** означает, что пространство имен общее с контейнером. | Нет          |
| --net    | Пространство имен сети, которое будет использоваться совместно. | **[none, host, container:]**: **none** означает, что пространство имен не является общим.  <br />**host** означает, что пространство имен общее с хостом.  <br />**container:** означает, что пространство имен общее с контейнером. | Нет          |
| --ipc    | Пространство имен IPC, которое будет использоваться совместно. | **[none, host, container:]**: **none** означает, что пространство имен не является общим.  <br />**host** означает, что пространство имен общее с хостом.  <br />**container:** означает, что пространство имен общее с контейнером. | Нет          |
| --uts    | Пространство имен UTS, которое будет использоваться совместно. | **[none, host, container:]**: **none** означает, что пространство имен не является общим.  <br />**host** означает, что пространство имен общее с хостом.  <br />**container:** означает, что пространство имен общее с контейнером. | Нет          |

### Пример

Если двум контейнерам требуется одно и то же пространство имен PID, добавьте **--pid container:\<containerID>** во время работы контейнера. Пример:

```
isula run -tid --name test_pid busybox sh
isula run -tid --name test --pid container:test_pid busybox sh
```

## Ограничение ресурсов процессора, занимаемых работающим контейнером

### Описание

Настройкой соответствующих параметров можно ограничить использование контейнером ресурсов процессора.

### Использование

При выполнении команды **isula create/run** можно настроить параметры процессора, которые ограничат использование его ресурсов контейнером. Подробную информацию о параметрах и значениях см. в следующей таблице.

### Параметры

При выполнении команды **isula create/run** можно указать следующие параметры:

| **Параметр**  | Описание                                                     | Диапазон значений                                            | Обязательный |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --cpu-period  | Ограничение периода CFS процессора в контейнере.             | 64-разрядное целое число                                     | Нет          |
| --cpu-quota   | Ограничение по квоте CFS процессора.                         | 64-разрядное целое число                                     | Нет          |
| --cpu-shares  | Ограничение по времени занятия ресурсов процессора (относительный вес). | 64-разрядное целое число                                     | Нет          |
| --cpuset-cpus | Ограничение по узлам процессора.                             | Строка символов. Значение — количество процессоров, которые необходимо сконфигурировать. Диапазон принимаемых значений — от 0 до 3 или 0 и 1. | Нет          |
| --cpuset-mems | Ограничение по узлам памяти, занимаемым cpuset в контейнере. | Строка символов. Значение — количество процессоров, которые необходимо сконфигурировать. Диапазон принимаемых значений — от 0 до 3 или 0 и 1. | Нет          |

### Пример

В следующем примере команда ограничивает использование контейнером ресурсов определенного процессора. Это осуществляется добавлением параметра **--cpuset-cpus number** во время работы контейнера. Пример:

```
isula run -tid --cpuset-cpus 0,2-3 busybox sh
```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
Проверка успешности настройки выполняется запросом информации. См. раздел «Запрос информации об одном контейнере».

## Ограничение ресурсов памяти, занимаемых работающим контейнером

### Описание

Настройкой соответствующих параметров можно ограничить использование контейнером ресурсов памяти.

### Использование

При выполнении команды **isula create/run** можно настроить параметры памяти, которые ограничат использование ее ресурсов контейнером. Подробную информацию о параметрах и значениях см. в следующей таблице.

### Параметры

При выполнении команды **isula create/run** можно указать следующие параметры:

| Параметр             | Описание                                                     | **Диапазон значений**                                        | Обязательный |
| -------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --memory             | Верхнее предельное значение ресурсов памяти, занимаемых контейнером. | 64-разрядное целое число. Значением является неотрицательное число. Значение **0** означает, что ограничение не настроено. Единицей измерения может быть байт, КБ, МБ, ГБ, ТБ или ПБ. | Нет          |
| --memory-reservation | Мягкое ограничение верхнего предельного значения ресурсов памяти, занимаемых контейнером. | 64-разрядное целое число. Значением является неотрицательное число. Значение **0** означает, что ограничение не настроено. Единицей измерения может быть байт, КБ, МБ, ГБ, ТБ или ПБ. | Нет          |
| --memory-swap        | Верхнее предельное значение размера раздела подкачки, занимаемого контейнером. | 64-разрядное целое число. Значением может быть **-1** или неотрицательное число. Значение **-1** указывает на отсутствие ограничений ресурсов, **0** означает, что ограничение не настроено. Единицей измерения может быть байт, КБ, МБ, ГБ, ТБ или ПБ. | Нет          |
| --kernel-memory      | Верхнее предельное значение размера памяти ядра, занимаемого контейнером. | 64-разрядное целое число. Значением является неотрицательное число. Значение **0** означает, что ограничение не настроено. Единицей измерения может быть байт, КБ, МБ, ГБ, ТБ или ПБ. | Нет          |

### Пример

В данном примере для установки верхнего предельного значения размера памяти, занимаемой контейнером, добавляется параметр **--memory \<number>\[\<unit>]** во время работы контейнера. Пример:

```
isula run -tid --memory 1G busybox sh
```

## Ограничение ресурсов модуля ввода-вывода, занимаемых работающим контейнером

### Описание

Установкой соответствующих параметров можно ограничить скорость выполнения операций чтения и записи для устройств в контейнере.

### Использование

При выполнении команды **isula create/run** можно настроить параметры **--device-read-bps/--device-write-bps \<device-path>:\<number>\[\<unit>]**, которые ограничат скорость выполнения операций чтения и записи для устройств в контейнере.

### Параметры

При выполнении команды **isula create/run** настройте параметры **--device-read/write-bps**.

| **Параметр**                         | Описание                                                     | Диапазон значений                                            | Обязательный |
| ------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --device-read-bps/--device-write-bps | Ограничение скорости выполнения операций чтения и записи для устройств в контейнере. | 64-разрядное целое число. Значением является положительное число. Значение 0 означает, что ограничение не настроено. Единицей измерения может быть байт, КБ, МБ, ГБ, ТБ или ПБ. | Нет          |

### Пример

В данном примере ограничивается скорость выполнения операций чтения и записи для устройств в контейнере путем добавления параметров **--device-write-bps/--device-read-bps \<device-path>:\<number>\[\<unit>]** во время работы контейнера. Например, чтобы ограничить скорость чтения устройства **/dev/sda** в контейнере **busybox** до 1 Мбит/с, выполните следующую команду:

```
isula run -tid --device-write /dev/sda:1mb busybox sh
```

Чтобы ограничить скорость записи, выполните следующую команду:

```
isula run -tid read-bps /dev/sda:1mb busybox sh
```

## Ограничение пространства памяти файловой системы, занимаемой контейнером

### Описание

Если в файловой системе EXT4 используется диск хранения overlay2, можно установить квоту на использование файловой системы одним контейнером. Например, для контейнера А устанавливается квота размером 5 ГБ, а для контейнера В — 10 ГБ.

Этот механизм реализуется функцией квоты проекта файловой системы EXT4. Если ядро поддерживает эту функцию, установите идентификатор проекта каталога с помощью syscalll SYS\_IOCTL, а затем, используя syscalll SYS\_QUOTACTL, установите жесткие и мягкие ограничения для соответствующего идентификатора проекта.

### Использование

1. Подготовьте среду.
   
   Убедитесь, что файловая система поддерживает атрибуты **Project ID** и **Project Quota**, используется ядро 4.19 или более поздней версии, а версия пакета служебных утилит e2fsprogs — 1.43.4-2 или более поздняя.

2. Перед монтированием наложенной файловой системы (overlayfs) в контейнер, задайте идентификаторы проекта для вышестоящих и рабочих каталогов различных контейнеров и задайте параметры наследования. После того, как overlayfs будет смонтирована в контейнер, идентификатор проекта и наследованные атрибуты изменить будет нельзя.

3. Установите квоту как для привилегированного пользователя вне контейнера.

4. Добавьте следующую конфигурацию в демон:
   
   ```
   -s overlay2 --storage-opt overlay2.override_kernel_check=true
   ```

5. Демон поддерживает следующие варианты установления ограничений по умолчанию для контейнеров:
   
   **--storage-opt overlay2.basesize=128M**: предельное значение по умолчанию. Если при выполнении команды **isula run** также указывается параметр **--storeage-opt size**, его значение вступает в силу. Если во время процесса демона или при выполнении команды **isula run** размер не указывается, значит, ограничений на размер нет.

6. Включите атрибуты **Project ID** и **Project Quota** файловой системы.
   
   - Отформатируйте и смонтируйте файловую систему.
     
     ```
     # mkfs.ext4 -O quota,project /dev/sdb
     # mount -o prjquota /dev/sdb /var/lib/isulad
     ```

### Параметры

При выполнении команды **create/run** настройте параметр **--storage-opt.**

| Параметр                         | Описание                                                     | **Диапазон значений**                                        | Обязательный |
| -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --storage-opt size=${rootfsSize} | Ограничение размера пространства для хранения корневой файловой системы (rootfs) контейнера. | Размер, анализируемый параметром **rootfsSize,** является положительным 64-разрядным целым числом, выраженным в байтах. Также ему можно установить значение **([kKmMgGtTpP])?[iI]?[bB]?$**. | Нет          |

### Пример

В команде **isula run/create** установите квоту, используя существующий параметр **--storage-opt size=**_value_. Значение является положительным числом с единицей измерения **\[kKmMgGtTpP]?\[iI]?\[bB]?**. Если значение не включает единицу измерения, по умолчанию используются байты.

```
$ [root@localhost ~]# isula run -ti --storage-opt size=10M busybox
/ # df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                  10.0M     48.0K     10.0M   0% /
none                     64.0M         0     64.0M   0% /dev
none                     10.0M         0     10.0M   0% /sys/fs/cgroup
tmpfs                    64.0M         0     64.0M   0% /dev
shm                      64.0M         0     64.0M   0% /dev/shm
/dev/mapper/vg--data-ext41
                          9.8G     51.5M      9.2G   1% /etc/hostname
/dev/mapper/vg--data-ext41
                          9.8G     51.5M      9.2G   1% /etc/resolv.conf
/dev/mapper/vg--data-ext41
                          9.8G     51.5M      9.2G   1% /etc/hosts
tmpfs                     3.9G         0      3.9G   0% /proc/acpi
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                    64.0M         0     64.0M   0% /proc/sched_debug
tmpfs                     3.9G         0      3.9G   0% /proc/scsi
tmpfs                    64.0M         0     64.0M   0% /proc/fdthreshold
tmpfs                    64.0M         0     64.0M   0% /proc/fdenable
tmpfs                     3.9G         0      3.9G   0% /sys/firmware
/ # 
/ # dd if=/dev/zero of=/home/img bs=1M count=12 && sync
dm-4: write failed, project block limit reached.
10+0 records in
9+0 records out
10432512 bytes (9.9MB) copied, 0.011782 seconds, 844.4MB/s
/ # df -h | grep overlay
overlay                  10.0M     10.0M         0 100% /
/ # 
```

### Ограничения

1. Квота применяется только к слою rw.
   
   Квота overlay2 устанавливается для слоя rw контейнера. Размер образа не включается.

2. Ядро поддерживает и активирует эту функцию.
   
   Ядро должно поддерживать функцию квоты проекта EXT4. При выполнении команды **mkfs** добавьте квоту **-O quota,project**. При монтировании файловой системы добавьте **-o prjquota**. Если какое-либо из предыдущих условий не будет выполнено, то при использовании **--storage-opt size=**_value_ будет передана ошибка.
   
   ```
   $ [root@localhost ~]# isula run -it --storage-opt size=10Mb busybox df -h
   Error response from daemon: Failed to prepare rootfs with error: time="2019-04-09T05:13:52-04:00" level=fatal msg="error creating read-
   write layer with ID "a4c0e55e82c55e4ee4b0f4ee07f80cc2261cf31b2c2dfd628fa1fb00db97270f": --storage-opt is supported only for overlay over
   xfs or ext4 with 'pquota' mount option"
   ```

3. Принцип ограничений, накладываемых квотой:
   
   1. Если квота больше размера раздела, в котором находится пользователь iSulad с правами **root**, квота для файловой системы, отображаемая при выполнении команды **df** в контейнере, равна размеру раздела, в котором находится пользователь iSulad с правами **root**, а не размеру указанной квоты.
   2. **--storage-opt size=0** означает, что размер не ограничен, и значение не должно быть меньше 4096. Точность указания размера составляет один байт. Если указанная точность содержит байты с десятичным знаком, цифры после запятой игнорируются. Например, установка размера квоты **0,1** означает, что ограничений нет. (Значение ограничено точностью числа с плавающей запятой, хранящегося на компьютере. То есть **0,99999999999999999999999999999999999** равно 1. Количество девяток после запятой может отличаться у разных компьютеров. Таким образом, **4095,99999999999999999999999999999999999** равно **4096**.) Обратите внимание, что выполняемая команда **isula inspect** отображает первоначальный формат командной строки. Если значение содержит байты с десятичным знаком, необходимо игнорировать цифры после запятой.
   3. Если квота слишком мала, например, **--speicherage-opt size=4k**, возможен сбой запуска контейнера, поскольку при запуске создаются определенные файлы.
   4. Параметр **-o prjquota** добавляется в корневой раздел iSulad во время его последнего запуска. Если данный параметр не добавляется во время запуска, настройка контейнера с квотой, созданной во время последнего запуска, не вступает в силу.
   5. Диапазон значений квоты демона **--storage-opt overlay2.basesize** такой же, как и у **--storage-opt size**.

4. Если параметру **storage-opt** установлено значение 4 КБ, процесс запуска облегченного контейнера будет отличаться от запуска Docker.
   
   К примеру, для запуска контейнера используется размер **storage-opt size=4k** и образ **rnd-dockerhub.huawei.com/official/ubuntu-arm64:latest**.
   
   В этом случае, контейнер Docker не запускается.
   
   ```
   [root@localhost ~]# docker run -itd --storage-opt size=4k rnd-dockerhub.huawei.com/official/ubuntu-arm64:latest
   docker: Error response from daemon: symlink /proc/mounts /var/lib/docker/overlay2/e6e12701db1a488636c881b44109a807e187b8db51a50015db34a131294fcf70-init/merged/etc/mtab: disk quota exceeded.
   See 'docker run --help'.
   ```
   
   Облегченный контейнер запускается корректно, ошибки не передаются.
   
   ```
   [root@localhost ~]# isula run -itd --storage-opt size=4k rnd-dockerhub.huawei.com/official/ubuntu-arm64:latest
   636480b1fc2cf8ac895f46e77d86439fe2b359a1ff78486ae81c18d089bbd728
   [root@localhost ~]# isula ps
   STATUS  PID   IMAGE                                                 COMMAND   EXIT_CODE RESTART_COUNT STARTAT       FINISHAT RUNTIME ID           NAMES                                                            
   running 17609 rnd-dockerhub.huawei.com/official/ubuntu-arm64:latest /bin/bash 0         0             2 seconds ago -        lcr     636480b1fc2c 636480b1fc2cf8ac895f46e77d86439fe2b359a1ff78486ae81c18d089bbd728 
   ```
   
   Если при запуске контейнера необходимо создать файл в каталоге **rootfs** контейнера, при этом, размер образа превышает 4 КБ, и установлена квота размером 4 КБ, произойдет ошибка при создании файла.
   
   Если контейнер запускается посредством Docker, он создает больше точек монтирования, чем iSulad, чтобы подключить некоторые каталоги на хосте к контейнеру, например **/proc/mounts** и **/dev/shm**. Если эти файлы не существуют в образе, произойдет ошибка при создании, поэтому контейнер не будет запущен.
   
   Если во время запуска облегченный контейнер использует конфигурацию по умолчанию, точек монтирования будет немного. Облегченный контейнер создается только в условиях, когда такие каталоги, как **/proc** или **/sys**, не существуют. Образ **rnd-dockerhub.huawei.com/official/ubuntu-arm64:latest** в тестовом примере содержит каталоги **/proc** и **/sys**. Поэтому во время запуска контейнера не генерируются новые файлы или каталоги. В результате во время запуска облегченного контейнера ошибки не передаются. В качестве проверки образ заменяется образом **rnd-dockerhub.huawei.com/official/busybox-aarch64:latest**, в результате при попытке запуска облегченного контейнера передается ошибка, что связано с отсутствием каталога **/proc** в данном образе.
   
   ```
   [root@localhost ~]# isula run -itd --storage-opt size=4k rnd-dockerhub.huawei.com/official/busybox-aarch64:latest
   8e893ab483310350b8caa3b29eca7cd3c94eae55b48bfc82b350b30b17a0aaf4
   Error response from daemon: Start container error: runtime error: 8e893ab483310350b8caa3b29eca7cd3c94eae55b48bfc82b350b30b17a0aaf4:tools/lxc_start.c:main:404 starting container process caused "Failed to setup lxc,
   please check the config file."
   ```

5. Другие моменты, связанные с использованием квоты:
   
   Используя iSulad с функцией квоты для переключения дисков данных убедитесь, что переключаемые диски данных смонтированы с помощью параметра **prjquota**, при этом режим монтирования каталога **/var/lib/isulad/storage/overlay2** совпадает с режимом монтирования каталога **/var/lib/isulad**.
   
   > ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
Перед переключением диска данных убедитесь, что точка монтирования **/var/lib/isulad/storage/overlay2** отключена.

## Ограничение количества файловых дескрипторов в контейнере

### Описание

Настройкой параметров можно ограничить количество файловых дескрипторов, которые можно открыть в контейнере.

### Использование

Ограничение количества файловых дескрипторов, которые можно открыть в контейнере, настраивается при выполнении команды **isula create/run** установкой параметра **--files-limit**.

### Параметры

Установите параметр **--files-limit** при выполнении команды **isula create/run**.

| Параметр      | **Описание**                                                 | Диапазон значений                                            | Обязательный |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------ |
| --files-limit | Ограничение количества файловых дескрипторов, которые можно открыть в контейнере. | 64-разрядное число. Значением может быть 0 или отрицательное число, но не может быть больше 2 в степени 63 минус 1. Значение 0 и отрицательное число указывают на отсутствие ограничений. При создании контейнера временно открываются определенные файловые дескрипторы. Поэтому значение не должно быть слишком маленьким. В противном случае в контейнере не будет ограничений по файлам. Значение меньше количества открытых дескрипторов делает невозможным запись файла cgroup. Рекомендуется, чтобы это значение было больше 30. | Нет          |

### Пример

При запуске контейнера добавьте параметр **--files-limit n**. Например:

```
isula run -ti --files-limit 1024 busybox bash
```

### Ограничения

1. Если параметру **--files-limit** установить маленькое значение, например 1, контейнер не сможет запуститься.
   
   ```
   [root@localhost ~]# isula run -itd --files-limit 1 rnd-dockerhub.huawei.com/official/busybox-aarch64
   004858d9f9ef429b624f3d20f8ba12acfbc8a15bb121c4036de4e5745932eff4
   Error response from daemon: Start container error: Container is not running:004858d9f9ef429b624f3d20f8ba12acfbc8a15bb121c4036de4e5745932eff4
   ```
   
   Docker будет успешно запущен, значение **files.limit cgroup** — **max**.
   
   ```
   [root@localhost ~]# docker run -itd --files-limit 1 rnd-dockerhub.huawei.com/official/busybox-aarch64
   ef9694bf4d8e803a1c7de5c17f5d829db409e41a530a245edc2e5367708dbbab
   [root@localhost ~]# docker exec -it ef96 cat /sys/fs/cgroup/files/files.limit
   max
   ```
   
   Основная причина заключается в разных принципах запуска процессов lxc и runc. После создания контрольной группы cgroup процессом lxc устанавливается значение file.limit, а затем PID процесса контейнера вносится в файл cgroup.procs группы. В этом случае процесс открывает несколько дескрипторов. В результате передается ошибка, и контейнер не запускается. После создания cgroup с помощью команды **runc** PID процесса контейнера вносится в файл cgroup.procs контрольной группы, а затем устанавливается значение file.limit. Поскольку процесс в cgroup открывает несколько файловых дескрипторов, значение file.limit не вступает в силу, ядро не передает никаких ошибок, и контейнер успешно запускается.

## Ограничение количества процессов или потоков, которые могут быть созданы в контейнере

### Описание

Настройкой параметров можно ограничить количество процессов, которые можно создать в контейнере.

### Использование

Ограничьте количество процессов или потоков, которые могут быть созданы в контейнере, с помощью параметра **--pids-limit** при создании или запуске контейнера.

### Параметры

При выполнении команды **create/run** настройте параметр **--pids-limit**.

| **Параметр** | Описание                                                     | Диапазон значений                                            | **Обязательный ** |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ----------------- |
| --pids-limit | Ограничение количества процессов или потоков, которые можно создать в контейнере. | 64-разрядное число. Значением может быть 0 или отрицательное число, но не может быть больше 2 в степени 63 минус 1. Значение 0 и отрицательное число указывают на отсутствие ограничений. | Нет               |

### Пример

При запуске контейнера добавьте параметр **--pids-limit n**. Например:

```
isula run -ti --pids-limit 1024 busybox bash
```

### Ограничения

При создании контейнера временно создаются определенные процессы. Поэтому значение не должно быть слишком маленьким. В противном случае контейнер не сможет запуститься. Рекомендуется, чтобы это значение было больше 10.

## Настройка значения ulimit в контейнере

### Описание

С помощью определенных параметров можно управлять ресурсами выполняемых программ.

### Использование

Чтобы управлять ресурсами выполняемых в контейнере программ, установите параметр **--ulimit** при создании или запуске контейнера или сконфигурируйте его на демоне.

### Параметры

Параметр ulimit настраивается одним из следующих методов:

1. Для управления ресурсами выполняемых программ оболочки настройте параметр **--ulimit \<type>=\<soft>\[:\<hard>]** при выполнении команды **isula create/run**.
   
   | **Параметр** | **Описание**                                         | **Диапазон значений**                                        | Обязательный |
   | ------------ | ---------------------------------------------------- | ------------------------------------------------------------ | ------------ |
   | --ulimit     | Ограничение ресурсов выполняемой программы оболочки. | 64-разрядное число. Значение мягкого ограничения должно быть меньше или равно значению жесткого ограничения. Если указывается только мягкое ограничение, значение жесткого ограничения равно значению мягкого ограничения. Некоторые типы ресурсов не поддерживают отрицательные значения. Для получения подробной информации см. следующую таблицу. | Нет          |
   
2. Используйте параметры или конфигурационные файлы демона.
   
   Для получения подробной информации см. описание параметра --default-ulimits в разделе [Режим развертывания](#deployment-mode.md#EN-US_TOPIC_0184808043).
   
   --ulimit может ограничить следующие типы ресурсов:
  
    <a name="en-us_topic_0183316275_table107744812507"></a>
    <table><thead align="left"><tr id="en-us_topic_0183316275_row1277419815508"><th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.1"><p id="en-us_topic_0183316275_p2774681505"><a name="en-us_topic_0183316275_p2774681505"></a><a name="en-us_topic_0183316275_p2774681505"></a><strong id="en-us_topic_0183316275_b1777458105010"><a name="en-us_topic_0183316275_b1777458105010"></a><a name="en-us_topic_0183316275_b1777458105010"></a>Тип</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.2"><p id="en-us_topic_0183316275_p6774168185013"><a name="en-us_topic_0183316275_p6774168185013"></a><a name="en-us_topic_0183316275_p6774168185013"></a><strong id="en-us_topic_0183316275_b157749817506"><a name="en-us_topic_0183316275_b157749817506"></a><a name="en-us_topic_0183316275_b157749817506"></a>Описание</strong></p>
    </th>
    <th class="cellrowborder" valign="top" width="33.33333333333333%" id="mcps1.1.4.1.3"><p id="en-us_topic_0183316275_p10774983500"><a name="en-us_topic_0183316275_p10774983500"></a><a name="en-us_topic_0183316275_p10774983500"></a>Диапазон значений</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="en-us_topic_0183316275_row677516855018"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p177518155011"><a name="en-us_topic_0183316275_p177518155011"></a><a name="en-us_topic_0183316275_p177518155011"></a>core</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p1977548165019"><a name="en-us_topic_0183316275_p1977548165019"></a><a name="en-us_topic_0183316275_p1977548165019"></a>Ограничение размера базового файла (КБ)</p>
    </td>
    <td class="cellrowborder" rowspan="14" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><p id="en-us_topic_0183316275_p1577516855011"><a name="en-us_topic_0183316275_p1577516855011"></a><a name="en-us_topic_0183316275_p1577516855011"></a>64-разрядное целое число, без единиц измерения. Значением может быть 0 или отрицательное число. Значение -1 указывает на отсутствие ограничений. Другие отрицательные значения принудительно преобразуются в большое положительное целое число.</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row38865448572"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p128837446571"><a name="en-us_topic_0183316275_p128837446571"></a><a name="en-us_topic_0183316275_p128837446571"></a>cpu</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p24819486261"><a name="en-us_topic_0183316275_p24819486261"></a><a name="en-us_topic_0183316275_p24819486261"></a>Максимальное время процессора (MIN)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row18167105285716"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p7165205217570"><a name="en-us_topic_0183316275_p7165205217570"></a><a name="en-us_topic_0183316275_p7165205217570"></a>data</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p216335710265"><a name="en-us_topic_0183316275_p216335710265"></a><a name="en-us_topic_0183316275_p216335710265"></a>Максимальный размер данных (КБ)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row58218531574"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p68201953145714"><a name="en-us_topic_0183316275_p68201953145714"></a><a name="en-us_topic_0183316275_p68201953145714"></a>fsize</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p1541711817270"><a name="en-us_topic_0183316275_p1541711817270"></a><a name="en-us_topic_0183316275_p1541711817270"></a>Максимальный размер файлов (КБ)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row13444185518573"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p244205517578"><a name="en-us_topic_0183316275_p244205517578"></a><a name="en-us_topic_0183316275_p244205517578"></a>locks</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p6620718182710"><a name="en-us_topic_0183316275_p6620718182710"></a><a name="en-us_topic_0183316275_p6620718182710"></a>Максимальное количество файловых блокировок, доступные пользователю</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row4246175712575"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p1324485745719"><a name="en-us_topic_0183316275_p1324485745719"></a><a name="en-us_topic_0183316275_p1324485745719"></a>memlock</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p224415785717"><a name="en-us_topic_0183316275_p224415785717"></a><a name="en-us_topic_0183316275_p224415785717"></a>Максимальное адресное пространство памяти с блокировкой страниц (КБ)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row3759820162420"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p177551620192416"><a name="en-us_topic_0183316275_p177551620192416"></a><a name="en-us_topic_0183316275_p177551620192416"></a>msgqueue</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p0755220122413"><a name="en-us_topic_0183316275_p0755220122413"></a><a name="en-us_topic_0183316275_p0755220122413"></a>Максимальный размер памяти, используемой для очередей сообщений POSIX (в байтах)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row584929152411"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p7811329152419"><a name="en-us_topic_0183316275_p7811329152419"></a><a name="en-us_topic_0183316275_p7811329152419"></a>nice</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p151801412182815"><a name="en-us_topic_0183316275_p151801412182815"></a><a name="en-us_topic_0183316275_p151801412182815"></a>Приоритет nice</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row2387203192415"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p015081417259"><a name="en-us_topic_0183316275_p015081417259"></a><a name="en-us_topic_0183316275_p015081417259"></a>nproc</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p1454164112283"><a name="en-us_topic_0183316275_p1454164112283"></a><a name="en-us_topic_0183316275_p1454164112283"></a>Максимальное количество процессов</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row510363316245"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p1210193311244"><a name="en-us_topic_0183316275_p1210193311244"></a><a name="en-us_topic_0183316275_p1210193311244"></a>rss</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p1330124872810"><a name="en-us_topic_0183316275_p1330124872810"></a><a name="en-us_topic_0183316275_p1330124872810"></a>Максимальный размер страниц памяти, выделенных процессу операционной системой и в настоящее время находящихся в ОЗУ (КБ)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row10182634162415"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p71806346245"><a name="en-us_topic_0183316275_p71806346245"></a><a name="en-us_topic_0183316275_p71806346245"></a>rtprio</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p8180153492410"><a name="en-us_topic_0183316275_p8180153492410"></a><a name="en-us_topic_0183316275_p8180153492410"></a>Максимальный приоритет процесса realtime</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row731643517244"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p331311358242"><a name="en-us_topic_0183316275_p331311358242"></a><a name="en-us_topic_0183316275_p331311358242"></a>rttime</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p375422114613"><a name="en-us_topic_0183316275_p375422114613"></a><a name="en-us_topic_0183316275_p375422114613"></a>Таймаут процесса realtime</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row189151636172412"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p791383610241"><a name="en-us_topic_0183316275_p791383610241"></a><a name="en-us_topic_0183316275_p791383610241"></a>sigpending</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p12730126203111"><a name="en-us_topic_0183316275_p12730126203111"></a><a name="en-us_topic_0183316275_p12730126203111"></a>Максимальное количество отложенных сигналов</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row163861238152414"><td class="cellrowborder" valign="top" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p23846383242"><a name="en-us_topic_0183316275_p23846383242"></a><a name="en-us_topic_0183316275_p23846383242"></a>stack</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p19713835143120"><a name="en-us_topic_0183316275_p19713835143120"></a><a name="en-us_topic_0183316275_p19713835143120"></a>Максимальный размер стека (КБ)</p>
    </td>
    </tr>
    <tr id="en-us_topic_0183316275_row144841516818"><td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.1 "><p id="en-us_topic_0183316275_p47292201381"><a name="en-us_topic_0183316275_p47292201381"></a><a name="en-us_topic_0183316275_p47292201381"></a>nofile</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.2 "><p id="en-us_topic_0183316275_p972982017813"><a name="en-us_topic_0183316275_p972982017813"></a><a name="en-us_topic_0183316275_p972982017813"></a>Максимальное количество открытых файловых дескрипторов</p>
    </td>
    <td class="cellrowborder" valign="top" width="33.33333333333333%" headers="mcps1.1.4.1.3 "><p id="en-us_topic_0183316275_p77290204817"><a name="en-us_topic_0183316275_p77290204817"></a><a name="en-us_topic_0183316275_p77290204817"></a>64-разрядное целое число, без единиц измерения. Значение не может быть отрицательным числом. Любое отрицательное значение принудительно преобразуется в большое положительное число. Кроме того, во время настройки выводится сообщение «Operation not permitted» (Операция не разрешена).</p>
    </td>
    </tr>
    </tbody>


### Пример

При создании или запуске контейнера добавьте **--ulimit \<type>=\<soft>\[:\<hard>]**. Пример:

```
isula create/run -tid --ulimit nofile=1024:2048 busybox sh
```

### Ограничения

Параметр ulimit нельзя конфигурировать в файлах **daemon.json** и **/etc/sysconfig/iSulad** (или в командной строке iSulad). В противном случае при запуске iSulad передается ошибка.