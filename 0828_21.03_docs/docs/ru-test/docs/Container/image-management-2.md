# Управление образами

- [Управление образами](#image-management-2)
  - [build](#build)
  - [history](#history)
  - [images](#images)
  - [import](#import)
  - [load](#load)
  - [login](#login)
  - [logout](#logout)
  - [pull](#pull)
  - [push](#push)
  - [rmi](#rmi)
  - [save](#save)
  - [search](#search)
  - [tag](#tag)

  

## build

Синтаксис: **docker build \[**_options_**]** _path_ **\|** _URL_ **\| -**

Функция: создание образа с использованием Dockerfile, расположенного по указанному пути.

Описание параметров: стандартные параметры приведены в следующей таблице. Информацию о других параметрах см. в разделе команды **docker help build**.

**Табл. 1** Описание параметров

| Параметр          | **Описание**                                                 |
| ----------------- | ------------------------------------------------------------ |
| --force-rm=false  | Удаление контейнеров, сгенерированных в процессе компоновки, даже если компоновка не была успешной. |
| --no-cache=false  | Создание образа без использования кэша.                      |
| -q, --quiet=false | Предотвращение генерирования избыточной информации во время компоновки. |
| --rm=true         | Удаление контейнера, сгенерированного в процессе компоновки после успешного завершения компоновки. |
| -t, --tag=""      | Имя тега образа, сгенерированное во время создания образа.   |
| --build-arg=[]    | Настройка параметров компоновки.                             |
| -label=[]         | Параметры, связанные с образом. Описание каждого параметра совпадает с описанием параметров команды **create**. |
| --isolation       | Метод изоляции контейнера.                                   |
| --pull            | Получение последнего образа во время компоновки.             |

**Команда Dockerfile**

Dockerfile используется для описания метода создания образа и автоматической компоновки контейнера. Формат всех команд **Dockerfile**: _instruction_ _arguments_.

  

**Команда FROM**

Синтаксис: **FROM** _image_ или **FROM** _image_:_tag_

Функция: задание базового образа. Это первая команда для всех файлов Dockerfile. Если тег базового образа не указан, используется имя тега по умолчанию **latest**.

  

**Команда RUN**

Синтаксис: **RUN** _command_ (например, **run in a shell - \`/bin/sh -c\`**) или

**RUN \[**_executable_, _param1_, _param2_ ...  **]**  (в формате команды **exec**)

Функция: выполнение любой команды в образе, указанном командой FROM с последующей фиксацией результата. Образ с зафиксированным результатом можно использовать в последующих командах. Команда **RUN** эквивалентна:

**docker run** _image_ _command_

**docker commit** _container\_id_

  

**Примечания**

Для вывода комментария используется знак номера (#).

  

**Команда MAINTAINER**

Синтаксис: **MAINTAINER** _name_

Функция: задание имени и контактной информации сотрудника по техобслуживанию.

  

**Команда ENRYPOINT**

Синтаксис: **ENTRYPOINT cmd **_param1 param2..._  или **ENTRYPOINT \[**_"cmd", "param1", "param2"..._**]**

Функция: конфигурирование команды, которую необходимо выполнить во время запуска контейнера.

  

**Команда USER**

Синтаксис: **USER** _name_

Функция: задание текущего пользователя системы кэширования в оперативной памяти (memcached).

  

**Команда EXPOSE**

Синтаксис: **EXPOSE **_port_** \[**_port_**...]**

Функция: включение одного и более портов для образов.

  

**Команда ENV**

Синтаксис: **ENV**\_ key value\_

Функция: настройка переменных среды. После настройки переменных среды можно использовать команды **RUN**.

  

**Команда ADD**

Синтаксис: **ADD**\_ src dst\_

Функция: копирование файла из каталога *src* в каталог *dest* контейнера. *src* задает относительный путь к исходному каталогу, который необходимо создать. Это может быть путь к файлу или каталогу либо удаленный URL файла. *dest* задает абсолютный путь контейнера.

  

**Команда VOLUME**

Синтаксис: **VOLUME \["**_mountpoint_**"]**

Функция: создание точки монтирования для совместного использования каталога.

  

**Команда WORKDIR**

Синтаксис: **workdir** _path_

Функция: выполнение команд **RUN, CMD** и **ENRYPOINT** для установки текущего рабочего пути. Текущий рабочий путь можно установить несколько раз. Если текущий рабочий путь является относительным путем, он относится к команде **WORKDIR**.

  

**Команда CMD**

Синтаксис: **CMD \[**_"executable","param1","param2"_**]** (Данная команда аналогична команде **exec** и предпочтительна.)

**CMD \["**_param1_**","**_param2_**"]** (Данные параметры являются параметрами по умолчанию команды **ENTRYPOINT**.)

**CMD** _command_ _param1_ _param2_  (Данная команда аналогична команде **shell**.)

Функция: Dockerfile может содержать только одну команду **CMD**. Если существует несколько команд **CMD**, вступает в силу только последняя.

  

**Команды ONBUILD**

Синтаксис: **ONBUILD \[**_other commands_**]**

Функция: после этой команды выполняются другие команды, например **RUN** и **COPY**. Эта команда не выполняется во время создания образа, а выполняется только тогда, когда текущий образ используется в качестве базового для создания образа следующего уровня.

Ниже приведен полный пример команды Dockerfile, которая создает образ с установленной службой sshd.

<table><tbody><tr id="en-us_topic_0183243738_en-us_topic_0155237683_en-us_topic_0076221025_en-us_topic_0043209539_row58396974"><td class="cellrowborder" valign="top" width="100%"><pre class="screen" id="en-us_topic_0183243738_en-us_topic_0155237683_en-us_topic_0076221025_en-us_topic_0043209539_screen13353554311"><a name="en-us_topic_0183243738_en-us_topic_0155237683_en-us_topic_0076221025_en-us_topic_0043209539_screen13353554311"></a><a name="en-us_topic_0183243738_en-us_topic_0155237683_en-us_topic_0076221025_en-us_topic_0043209539_screen13353554311"></a>FROM busybox
ENV  http_proxy http://192.168.0.226:3128
ENV  https_proxy https://192.168.0.226:3128
RUN apt-get update &amp;&amp; apt-get install -y openssh-server
RUN mkdir -p /var/run/sshd
EXPOSE 22
ENTRYPOINT /usr/sbin/sshd -D</pre>
</td>
</tr>
</tbody>
</table>
Пример.

1. Создание образа с использованием Dockerfile:
   
   ```
   $ sudo docker build -t busybox:latest
   ```

2. Просмотр сгенерированного образа:
   
   ```
   docker images | grep busybox
   ```

## history

Синтаксис: **docker history \[**_options_**]** _image_

Функция: отображение истории изменений образа.

Описание параметров:

-H, --human=true

**--no-trunc=false**: не удаляет вывод.

**-q** и **--quiet=false**: отображение только идентификаторов.

Пример.

```
$ sudo docker history busybox:test
IMAGE               CREATED             CREATED BY          SIZE                COMMENT
be4672959e8b        15 minutes ago      bash                23B
21970dfada48        4 weeks ago                             128MB               Imported from -
```

  

## images

Синтаксис: **docker images \[**_options_**] \[**_name_**]**

Функция: вывод списка существующих образов. Промежуточный образ не отображается, если параметр не сконфигурирован.

Описание параметров:

**-a** и **--all=false**: отображение всех образов.

**-f** и **--filter=\[]**: задание значения фильтрации, например, **dangling=true**.

**--no-trunc=false**: вывод не удаляется.

**-q** и **--quiet=false**: отображение только идентификаторов.

Пример.

```
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
busybox             latest              e02e811dd08f        2 years ago         1.09MB
```

  

## import

Синтаксис: **docker import URL\|- \[**_repository_**\[**_:tag_**]]**

Функция: импорт пакета .tar, который содержит корневую файловую систему (rootfs) в качестве образа. Этот параметр соответствует команде **docker export**.

Описание параметров: --.

Пример.

В следующем примере выполняется команда, генерирующая новый образ для **busybox.tar**, который экспортируется с помощью команды **docker export**:

```
$ sudo docker import busybox.tar busybox:test
sha256:a79d8ae1240388fd3f6c49697733c8bac4d87283920defc51fb0fe4469e30a4f
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
busybox             test                a79d8ae12403        2 seconds ago       1.3MB
```

  

## load

Синтаксис: **docker load \[**_options_**]**

Функция: повторная загрузка образа из пакета .tar, полученного командой **docker save**. Этот параметр соответствует команде **docker save**.

Описание параметров:

Доступны два параметра **-i** и **--input=""**.

Пример.

```
$ sudo docker load -i busybox.tar
Loaded image ID: sha256:e02e811dd08fd49e7f6032625495118e63f597eb150403d02e3238af1df240ba
$ sudo docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
busybox             latest              e02e811dd08f        2 years ago         1.09MB
```

## login

Синтаксис: **docker login \[**_options_**] \[**_server_**]**

Функция: вход на сервер хранения образов. Если сервер не указан, система по умолчанию выполняет вход в **https://index.docker.io/v1/**.

Описание параметров:

**-e** и **--email=""**: адрес электронной почты.

**-p** и **--password=""**: пароль.

**-u** и **--username=""**: имя пользователя.

Пример.

```
$ sudo docker login
```

## logout

Синтаксис: **docker logout \[**_server_**]**

Функция: выход с сервера хранения образов. Если сервер не указан, система по умолчанию выполняет выход с **https://index.docker.io/v1/**.

Описание параметров: --.

Пример.

```
$ sudo docker logout
```

## pull

Синтаксис: **docker pull \[**_options_**]** _name_**\[**_:tag_**]**

Функция: извлечение образа из официального или частного реестра.

Описание параметров:

**-a** и **--all-tags=false**: загрузка всех образов из реестра. (Реестр может иметь несколько тегов. Например, реестр busybox может иметь такие теги, как **busybox:14.04**, **busybox:13.10**, **busybox:latest**. Если используется параметр **-a**, извлекаются все образы с тегами.)

Пример.

1. Выполните следующую команду, чтобы получить образ Nginx из официального реестра:
   
   ```
   $ sudo docker pull nginx
   Using default tag: latest
   latest: Pulling from official/nginx
   94ed0c431eb5: Pull complete
   9406c100a1c3: Pull complete
   aa74daafd50c: Pull complete
   Digest: sha256:788fa27763db6d69ad3444e8ba72f947df9e7e163bad7c1f5614f8fd27a311c3
   Status: Downloaded newer image for nginx:latest
   ```
   
   Во время извлечения образа система проверяет существование уровня зависимостей. Если он есть, используется данный локальный уровень.

2. Извлечение образа из реестра.
   
   Выполните следующую команду, чтобы извлечь образ Fedora из частного реестра, например с частного реестра, имеющего адрес **192.168.1.110:5000**:
   
   ```
   $ sudo docker pull 192.168.1.110:5000/fedora
   ```

## push

Синтаксис: **docker push** _name_**\[**_:tag_**]**

Функция: помещение образа в реестр.

Описание параметров: --.

Пример.

1. Выполните следующую команду, чтобы поместить образ в частный реестр хранения образов с адресом 192.168.1.110:5000.

2. Отметьте тегом помещаемый образ. (Команда **docker tag** приведена в следующем разделе.) В этом примере образом, помещаемым в реестр, является busybox:sshd.
   
   ```
   $ sudo docker tag ubuntu:sshd 192.168.1.110:5000/busybox:sshd
   ```

3. Выполните следующую команду, чтобы поместить отмеченный тегом образ в частный реестр хранения образов:
   
   ```
   $ sudo docker push 192.168.1.110:5000/busybox:sshd
   ```
   
   Во время помещения образа в реестр система проверяет наличие уровня зависимостей в данном реестре. Если он есть, данный шаг пропускается.

## rmi

Синтаксис: **docker rmi \[**_options_**] **\_image \_**\[**_image..._**]**

Функция: удаление одного и более образов. Если образ имеет несколько тегов в библиотеке образов, то при удалении образа выполняется только операция снятия тегов. Если образ имеет только один тег, последовательно удаляются уровни зависимостей.

Описание параметров:

**-f** и **--force=false**: принудительное удаление образа.

**--no-prune=false**: родительские образы без тегов не удаляются.

Пример.

```
$ sudo docker rmi 192.168.1.110:5000/busybox:sshd
```

## save

Синтаксис: **docker save \[**_options_**] **\_image \_**\[**_image..._**]**

Функция: сохранение образа в пакет TAR. Вывод по умолчанию — **STDOUT**.

Описание параметров:

**-o** и **--output=""**: сохранение образа в файл, а не в **STDOUT**.

Пример.

```
$ sudo docker save -o nginx.tar nginx:latest
$ ls
nginx.tar
```

## search

Синтаксис: **docker search** _options_ _TERM_

Функция: поиск определенного образа в реестре.

Описание параметров:

**--automated=false**: отображение автоматически созданного образа.

**--no-trunc=false**: вывод не удаляется.

**-s** и **--stars=0**: отображение только тех образов, которые имеют уровень звезды не ниже указанного.

Пример.

1. Выполните следующую команду для поиска Nginx в официальной библиотеке образов:
   
   ```
   $ sudo docker search nginx
   NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
   nginx                             Official build of Nginx.                        11873               [OK]
   jwilder/nginx-proxy               Automated Nginx reverse proxy for docker con...   1645                                    [OK]
   richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of...   739                                     [OK]
   linuxserver/nginx                 An Nginx container, brought to you by LinuxS...   74
   bitnami/nginx                     Bitnami nginx Docker Image                      70                                      [OK]
   tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp...   51                                      [OK]
   ```
   
     

2. Выполните следующую команду для поиска busybox в частной библиотеке образов. Во время поиска необходимо добавить адрес частной библиотеки образов.
   
   ```
   $ sudo docker search 192.168.1.110:5000/busybox
   ```

## tag

Синтаксис: **docker tag \[**_options_**] **_image_**\[**_:tag_**] \[**_registry host/_**]\[**_username/_**]**_name_**\[**_:tag_**]**

Функция: отметка образа тегом определенного реестра.

Описание параметров:

**-f** или **--force=false**: принудительная замена исходного образа в случае существования такого же имени тега.

Пример.

```
$ sudo docker tag busybox:latest busybox:test
```