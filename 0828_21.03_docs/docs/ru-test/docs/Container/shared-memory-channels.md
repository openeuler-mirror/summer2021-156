# Каналы общей памяти

- [Каналы общей памяти](#shared-memory-channels)

## Описание функционала

Системные контейнеры обеспечивают связь между процессами контейнера и хоста через общую память. Общее пространство памяти tmpfs настраивается параметром **--host-channel** во время создания контейнера, после чего хост и контейнер могут взаимодействовать друг с другом.

## Описание параметров

| Команда          | Параметр       | Описание значений                                            |
| ---------------- | -------------- | ------------------------------------------------------------ |
| isula create/run | --host-channel | ·  Переменная строкового типа. Формат следующий: **<host path&gt;:&lt;container path&gt;:&lt;rw/ro&gt;:&lt;size limit>**<br />·  Описание параметра:<br /><**host path**>: абсолютный путь, по которому смонтировано пространство tmpfs на хосте.<br />**< container path>**: абсолютный путь, по которому смонтировано пространство tmpfs в контейнере. <br />**<rw/ro>**: разрешения на файловую систему смонтированную в контейнере. Значением может быть только **rw** (чтение и запись) или **ro**  (только чтение). Значение по умолчанию — **rw**.<br />**&lt;size limit>**: максимальный размер монтируемого пространства tmpfs. Минимальное значение равно одной физической странице в 4 КБ, максимальное значение равно половине общего объема физической памяти в системе. Значение по умолчанию — **64MB**. |

## Ограничения

- Жизненный цикл пространства памяти tmpfs, смонтированного на хосте, начинается с запуска контейнера и завершается его удалением. После удаления контейнера и освобождения данного занятого пространства оно удаляется.
- Во время удаления контейнера удаляется путь, по которому пространство tmpfs смонтировано на хосте. Поэтому существующий каталог на хосте не может использоваться в качестве пути монтирования.
- Чтобы обеспечить связь с контейнерами тех процессов, которые запущены на хосте пользователями, не имеющими прав **root**, разрешением монтируемого на хосте пространства памяти tmpfs должно быть 1777.

## Пример

Укажите параметр **--host-channel** при создании контейнера.

```
[root@localhost ~]# isula run --rm -it --host-channel /testdir:/testdir:rw:32M --system-container --external-rootfs /root/myrootfs none init 
root@3b947668eb54:/# dd if=/dev/zero of=/testdir/test.file bs=1024 count=64K 
dd: error writing '/testdir/test.file': No space left on device 
32769+0 records in 
32768+0 records out 
33554432 bytes (34 MB, 32 MiB) copied, 0.0766899 s, 438 MB/s
```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:
> 
> - Если для ограничения размера используется параметр **--host-channel,** размер файла ограничивается размером памяти в контейнере. (При достижении занимаемой памятью верхнего предельного значения может возникнуть ошибка OOM.)
> - Если пользователь создает общий файл на хосте, размер файла не ограничивается размером памяти в контейнере.
> - Если необходимо создать общий файл в контейнере, и соответствующей службе требуется большой размер памяти, можно убрать ограничение, добавив значение **--host-channel** к первоначальному предельному размеру памяти контейнера.