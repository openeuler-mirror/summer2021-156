# Инструменты усиления безопасности

- [Инструменты усиления безопасности](#security-hardening-tools)
  - [Процедура усиления мер безопасности](#security-hardening-procedure)
  - [Вступление в силу параметров усиления безопасности](#hardening-items-taking-effect)

## Процедура усиления мер безопасности

### Обзор

Чтобы инструмент усиления безопасности настроил политику усиления на основе файла **usr-security.conf**, необходимо внести изменения в данный файл. В этом разделе приведены правила изменения файла **usr-security.conf**. Подробнее о настраиваемых параметрах усиления безопасности см. в разделе [Руководство по усилению мер безопасности](#security-hardening-guide.md).

### Меры предосторожности

- Изменив параметры, перезапустите службу усиления безопасности, чтобы изменение вступило в силу. Подробнее о способе перезапуска службы см. в разделе [Вступление в силу параметров усиления безопасности](#hardening-items-taking-effect.md).
- При изменении параметров усиления безопасности изменения требуется внести только в файл **/etc/openEuler\_security/usr-security.conf**. Не рекомендуется изменять файл **/etc/openEuler\_security/security.conf**. Файл **security.conf** содержит основные базовые процедуры усиления безопасности, которые выполняются только один раз.
- После перезапуска службы усиления безопасности для вступления новых настроек в силу предыдущие настройки нельзя удалить путем удаления соответствующих параметров усиления безопасности из файла **usr-security.conf** и перезапуска службы.
- Операции усиления безопасности вносятся в файл **/var/log/openEuler-security.log**.

### Формат конфигурации

Каждая строка в файле **usr-security.conf** означает конфигурационный элемент. Формат конфигурации зависит от содержания конфигурации. Ниже описывается формат каждого конфигурационного элемента.

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:
> 
> - Все конфигурационные элементы начинаются с идентификатора выполнения. Идентификатор выполнения вводится в виде целого положительного числа.
> - Составные части конфигурационного элемента разделяются знаком @.
> - Если какая-либо составная часть уже содержит знак @, используйте два знака (@@) — для составной части и для разделителя. Например, составную часть **xxx@yyy** следует ввести в виде **xxx@@yyy**. В настоящее время знак @ нельзя помещать в начало или конец конфигурации.

  

- **d**: комментарий
  
  Формат. _Идентификатор выполнения_**@d@**_Объектный файл_**@**_Элемент соответствия_
  
  Функции. Комментирует строки, начинающиеся с элемента соответствия (строка может начинаться с пробела) в объектном файле, добавив знак номера (#) в начале строки.
  
  Пример. Если идентификатор выполнения — **401**, закомментируйте строки, начинающиеся с **%wheel** в файле **/etc/sudoers**.
  
  ```
  401@d@/etc/sudoers@%wheel
  ```

- **m**: замена
  
  Формат. _Идентификатор выполнения_**@m@**_Объектный файл_**@**_Элемент соответствия**@**Целевое значение_
  
  Функции. Заменяет строки, начинающиеся с элемента соответствия (строка может начинаться с пробела) в объектном файле, *элементом соответствия* и *целевым значением*. Если строка соответствия начинается с пробелов, пробелы удаляются после замены.
  
  Пример. Если идентификатор выполнения — **101**, замените строки, начинающиеся с **Protocol** в файле **/etc/ssh/sshd\_config**, содержимым **Protocol 2**. Пробелы **Protocol** сопоставляются и заменяются.
  
  ```
  101@m@/etc/ssh/sshd_config@Protocol @2
  ```

- **sm**: точное изменение
  
  Формат. _Идентификатор выполнения_**@sm@**_Объектный файл_**@**_Элемент соответствия**@**Целевое значение_
  
  Функции. Заменяет строки, начинающиеся с элемента соответствия (строка может начинаться с пробела) в объектном файле, *элементом соответствия* и *целевым значением*. Если строка соответствия начинается с пробелов, пробелы сохраняются после замены. В этом заключается разница между **sm** и **m**.
  
  Пример. Если идентификатор выполнения — **201**, замените строки, начинающиеся с **size** в файле **/etc/audit/hzqtest**, значением **size 2048**.
  
  ```
  201@sm@/etc/audit/hzqtest@size@ 2048
  ```

- **M**: изменение подэлемента
  
  Формат. _Идентификатор выполнения_**@M@**_Объектный файл_**@**_Элемент соответствия_**@**_Подэлемент соответствия_\_*\[@Значение подэлемента соответствия]*
  
  Функции. Сопоставляет строки, начинающиеся с элемента соответствия (строка может начинаться с пробела) в объектном файле и заменяет содержимое, начинающееся с подэлемента соответствия в этих строках, *подэлементом соответствия* и *значением подэлемента соответствия*. Значение подэлемента соответствия необязательно.
  
  Пример. Если идентификатор выполнения — **101,** найдите строки, начинающиеся с **key** в данном файле, и замените содержимое, начинающееся с **key2** в этих строках, на **key2value2**.
  
  ```
  101@M@file@key@key2@value2
  ```

- **systemctl**: управление службой
  
  Формат. _Идентификатор выполнения_**@systemctl@**_Объектная служба_**@**_Операция_
  
  Функции. **systemctl** используется для управления объектными службами. Значением **Операция** может быть **Start, Stop, Restart** или **Disable**.
  
  Пример. Если идентификатор выполнения — 218, остановите службу **cups.service**. Данная операция выполняет такую же функцию, что и при выполнении команды **systemctl stop cups.service**.
  
  ```
  218@systemctl@cups.service@stop
  ```
  
    

- Другие команды
  
  Формат. _Идентификатор выполнения_**@**_Команда_**@**_Объектный файл_
  
  Функции. Выполняет соответствующую команду с объектным файлом.
  
  Пример 1. Если идентификатор выполнения — **402**, выполните команду **rm -f**, чтобы удалить файл **/etc/pki/ca-trust/extracted/pem/email-ca-bundle.pem**.
  
  ```
  402@rm -f @/etc/pki/ca-trust/extracted/pem/email-ca-bundle.pem
  ```
  
  Пример 2. Если идентификатор выполнения — **215**, выполните команду **touch**, чтобы создать файл **/etc/cron.allow**.
  
  ```
  215@touch @/etc/cron.allow
  ```
  
  Пример 3. Если идентификатор выполнения — **214**, выполните команду **chown**, чтобы изменить владельца файла **/etc/at.allow** на **root:root**.
  
  ```
  214@chown root:root @/etc/at.allow
  ```
  
  Пример 4. Если идентификатор выполнения — **214**, выполните команду **chmod**, чтобы удалить разрешение **rwx** группы, которой принадлежит владелец файла **/etc/at.allow** и другие пользователи, не являющиеся владельцами.
  
  ```
  214@chmod og-rwx @/etc/at.allow
  ```

## Вступление в силу параметров усиления безопасности

Изменив файл **usr-security.conf**, выполните следующую команду, чтобы новые элементы конфигурации вступили в силу:

```
systemctl restart openEuler-security.service
```