# Описание API-интерфейса

Единая платформа программирования secGear для конфиденциальных вычислений состоит из TEE и REE. В этом разделе приведено описание API-интерфейсов, необходимых для разработки приложений. В дополнение к этим API, TEE наследует API-интерфейсы POSIC с открытым исходным кодом ARM TrustZone и Intel SGX.

## cc\_enclave\_create

Создание API-интерфейса enclave

**Функции:**

API инициализации. Функция вызывает различные функции создания TEE в зависимости от типа для инициализации контекста enclave в различных решениях TEE. Этот API-интерфейс вызван REE.

**Объявление функций:**

cc\_enclave\_result\_t cc\_enclave\_create(const char\* path, enclave\_type\_t type, uint32\_t version,uint32\_t flags,const enclave\_features\_t\* features,uint32\_t features\_count, cc\_enclave\_t  \*\* enclave);

**Параметры:**

- Path: входной параметр, указывающий загружаемый путь к enclave.
- Type: входной параметр, определяющий решение TEE, например, SGX\_ENCLAVE\_TYPE, GP\_ENCLAVE\_TYPE и AUTO\_ENCLAVE\_TYPE.
- version: входной параметр, определяющий версию enclave engine. В настоящее время существует только одна версия, и значение — 0.
- Flags: входной параметр, определяющий состояние работы enclave. Например, SECGEAR\_DEBUG\_FLAG указывает состояние отладки, а SECGEAR\_SIMULATE\_FLAG — состояние симуляции (в данный момент не поддерживается).
- features: входной параметр, определяющий некоторые функции, поддерживаемые enclave, например, PCL и отсутствие переключения (switchless) SGX. Этот параметр в настоящее время не поддерживается. Установите для него значение NULL.
- features\_count: входной параметр, задающий количество функций. Этот параметр в настоящее время не поддерживается. Установите для него значение 0.
- enclave: выходной параметр, указывающий созданный контекст enclave.

**Возвращаемые значения:**

- CE\_SUCCESS: проверка информации об аутентификации выполнена.
- CE\_ERROR\_INVALID\_PARAMETER: неверный входной параметр.
- CE\_ERROR\_OUT\_OF\_MEMORY: нет доступной памяти.
- CC\_FAIL: общие ошибки.
- CC\_ERROR\_UNEXPECTED: неожиданная ошибка.
- CC\_ERROR\_ENCLAVE\_MAXIMUM: количество enclave, созданных одним приложением, достигает верхнего предела.
- CC\_ERROR\_INVALID\_PATH: защищенный двоичный путь недействителен.
- CC\_ERROR\_NO\_FIND\_REGFUNC: сбой поиска enclave.

## cc\_enclave\_destroy

Уничтожение API-интерфейса enclave

**Функции:**

Вызов выходных функций (exit function) различных TEE для освобождения созданных объектов enclave. Эта функция вызвана REE.

**Объявление функций:**

cc\_enclave\_result\_t cc\_enclave\_destroy (cc\_enclave\_t \*\* enclave);

**Параметр:**

- enclave: входной параметр, указывающий созданный контекст enclave.

**Возвращаемые значения:**

- CE\_SUCCESS: проверка информации об аутентификации выполнена.
- CE\_ERROR\_INVALID\_PARAMETER: неверный входной параметр.
- CE\_ERROR\_OUT\_OF\_MEMORY: нет доступной памяти.
- CC\_ERROR\_NO\_FIND\_UNREGFUNC: сбой поиска enclave.
- CC\_FAIL: общие ошибки.
- CC\_ERROR\_UNEXPECTED: неожиданная ошибка.

## cc\_enclave\_generate\_random

Генерирование случайных чисел

**Функции:**

Данный параметр используется для генерации безопасного случайного числа пароля на стороне безопасности.

**Объявление функций:**

cc\_enclave\_result\_t cc\_enclave\_generate\_random(void \*buffer, size\_t size)

**Параметры:**

- \*buffer: входной параметр, задающий буфер для генерации случайных чисел.
- size: входной параметр, задающий длину буфера.

**Возвращаемые значения:**

- CE\_OK: проверка информации об аутентификации выполнена.
- CE\_ERROR\_INVALID\_PARAMETER: неверный входной параметр.
- CE\_ERROR\_OUT\_OF\_MEMORY: нет доступной памяти.

## cc\_enclave\_seal\_data

Обеспечение постоянного хранения данных

**Функции:**

Данный параметр используется для шифрования внутренних данных enclave, чтобы эти данные могли постоянно храниться во внешней среде. Эта функция вызвана TEE.

**Объявление функций:**

cc\_enclave\_result\_t cc\_enclave\_seal\_data(uint8\_t \*seal\_data, uint32\_t seal\_data\_len,

​    cc\_enclave\_sealed\_data\_t \*sealed\_data, uint32\_t sealed\_data\_len,

​    uint8\_t \*additional\_text, uint32\_t additional\_text\_len)

**Параметры:**

- seal\_data: входной параметр, указывающий данные, которые необходимо зашифровать.
- seal\_data\_len: входной параметр, задающий длину данных, которые необходимо зашифровать.
- sealed\_data: выходной параметр, указывающий дескриптор обработки зашифрованных данных.
- sealed\_data\_len: выходной параметр, задающий длину зашифрованного текста.
- additional\_text: входной параметр, определяющий дополнительное сообщение, необходимое для шифрования.
- additional\_text\_len: входной параметр, определяющий длину дополнительного сообщения.

**Возвращаемые значения:**

- CE\_SUCCESS: шифрование данных выполнено.
- CE\_ERROR\_INVALID\_PARAMETER: неверный входной параметр.
- CE\_ERROR\_OUT\_OF\_MEMORY: нет доступной памяти.
- CC\_ERROR\_SHORT\_BUFFER: входной буфер слишком мал.
- CC\_ERROR\_GENERIC: общая ошибка аппаратного обеспечения нижнего уровня.

## cc\_enclave\_unseal\_data

Расшифровка данных

**Функции:**

Данный параметр используется для расшифровки данных, запечатанных enclave, и импорта данных, хранящихся во внешней среде, обратно в enclave. Эта функция вызвана TEE.

**Объявление функций:**

cc\_enclave\_result\_t cc\_enclave\_unseal\_data(cc\_enclave\_sealed\_data\_t \*sealed\_data,

    uint8_t *decrypted_data, uint32_t *decrypted_data_len,
    
    uint8_t *additional_text, uint32_t *additional_text_len)

**Параметры:**

- sealed\_data: входной параметр, указывающий дескриптор зашифрованных данных.
- decrypted\_data: выходной параметр, указывающий буфер данных расшифрованного текста.
- decrypted\_data\_len: выходной параметр, определяющий длину расшифрованного текста.
- additional\_text: выходной параметр, определяющий дополнительное сообщение после расшифровки.
- additional\_text\_len: выходной параметр, определяющий длину дополнительного сообщения после расшифровки.

**Возвращаемые значения:**

- CE\_SUCCESS: расшифровка данных выполнена.
- CE\_ERROR\_INVALID\_PARAMETER: неверный входной параметр.
- CE\_ERROR\_OUT\_OF\_MEMORY: нет доступной памяти.
- CC\_ERROR\_SHORT\_BUFFER: входной буфер слишком мал.
- CC\_ERROR\_GENERIC: общая ошибка аппаратного обеспечения нижнего уровня.

## cc\_enclave\_get\_sealed\_data\_size

Получение размера зашифрованных данных

**Функции:**

Размер данных sealed\_data. Эта функция используется для выделения пространства расшифрованных данных и может быть вызвана TEE и REE.

**Объявление функций:**

uint32\_t cc\_enclave\_get\_sealed\_data\_size(const uint32\_t add\_len, const uint32\_t seal\_data\_len);

**Параметры:**

- add\_len: входной параметр, определяющий длину дополнительного сообщения.
- sealed\_data\_len: входной параметр, определяющий длину зашифрованной информации.

**Возвращаемые значения:**

- UINT32\_MAX: ошибка параметра или ошибка выполнения функции.
- others: функция успешно выполнена, и возвращаемым значением является размер структуры sealed\_data.

## cc\_enclave\_get\_encrypted\_text\_size

Получение длины зашифрованного сообщения

**Функции:**

Данный параметр используется для получения длины зашифрованного сообщения в зашифрованных данных. Эта функция вызвана TEE.

**Объявление функций:**

uint32\_t cc\_enclave\_get\_encrypted\_text\_size(const cc\_enclave\_sealed\_data\_t \*sealed\_data);

**Параметр:**

- sealed\_data: входной параметр, указывающий дескриптор зашифрованных данных.

**Возвращаемые значения:**

- UINT32\_MAX: ошибка параметра или ошибка выполнения функции.
- others: функция успешно выполнена, и возвращаемым значением является длина зашифрованного сообщения в sealed\_data.

## cc\_enclave\_get\_add\_text\_size

Получение длины дополнительного сообщения

**Функции:**

Данный параметр используется для получения длины дополнительного сообщения в зашифрованных данных. Эта функция вызвана TEE.

**Объявление функций:**

uint32\_t cc\_enclave\_get\_add\_text\_size(const cc\_enclave\_sealed\_data\_t \*sealed\_data);

**Параметр:**

- sealed\_data: входной параметр, указывающий дескриптор зашифрованных данных.

**Возвращаемые значения:**

- UINT32\_MAX: ошибка параметра или ошибка выполнения функции.
- others: функция успешно выполнена, и возвращаемым значением является длина дополнительного сообщения в sealed\_data.

## cc\_enclave\_memory\_in\_enclave

Проверка защищенной памяти

**Функции:**

С помощью этого параметра можно проверить, принадлежат ли адреса памяти указанной длины к TEE. Эта функция вызвана TEE.

**Объявление функций:**

bool cc\_enclave\_memory\_in\_enclave(const void \*addr, size\_t size)

**Параметры:**

- \*addr: входной параметр, указывающий адрес памяти, который необходимо проверить.
- size: входной параметр, указывающий длину, которую необходимо проверить, начиная с адреса памяти.

**Возвращаемые значения:**

- true: память в указанной зоне находится в безопасном диапазоне.
- false: часть или вся память в указанной зоне не находится в безопасном диапазоне.

## cc\_enclave\_memory\_out\_enclave

Проверка защищенной памяти

**Функции:**

С помощью этого параметра можно проверить, принадлежат ли адреса памяти указанной длины к REE. Эта функция вызвана TEE.

**Объявление функций:**

bool cc\_enclave\_memory\_out\_enclave(const void \*addr, size\_t size)

**Параметры:**

- \*addr: входной параметр, указывающий адрес памяти, который необходимо проверить.
- size: входной параметр, указывающий длину, которую необходимо проверить, начиная с адреса памяти.

**Возвращаемые значения:**

- true: память в указанной зоне находится в незащищенной области.
- false: часть или вся память в указанной зоне находится в безопасной области.

## PrintInfo

Печать сообщений

**Функции:**

Данный параметр используется для печати журналов TEE. Через этот API-интерфейс выводится информация, которую пользователь TEE хочет распечатать. Входные журналы хранятся в /var/log/secgear/secgear.log REE.

**Объявление функций:**

void PrintInfo(int level, const char \*fmt, ...);

**Параметры:**

- level: уровень печати журнала, являющийся входным параметром. Значение может быть PRINT\_ERROR, PRINT\_WARNING, PRINT\_STRACE, and PRINT\_DEBUG.
- fmt: входной параметр и символ для вывода.

**Возвращаемое значение:**

- Нет