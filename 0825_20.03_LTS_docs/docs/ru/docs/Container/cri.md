# CRI

- CRI
  - [Описание](#description)
  - [API](#apis)
    - [Служба среды выполнения](#runtime-service)
      - [RunPodSandbox](#runpodsandbox)
      - [StopPodSandbox](#stoppodsandbox)
      - [RemovePodSandbox](#removepodsandbox)
      - [PodSandboxStatus](#podsandboxstatus)
      - [ListPodSandbox](#listpodsandbox)
      - [CreateContainer](#createcontainer)
      - [StartContainer](#startcontainer)
      - [StopContainer](#stopcontainer)
      - [RemoveContainer](#removecontainer)
      - [ListContainers](#listcontainers)
      - [ContainerStatus](#containerstatus)
      - [UpdateContainerResources](#updatecontainerresources)
      - [ExecSync](#execsync)
      - [Exec](#exec)
      - [Attach](#attach)
      - [ContainerStats](#containerstats)
      - [ListContainerStats](#listcontainerstats)
      - [UpdateRuntimeConfig](#updateruntimeconfig)
      - [Status](#status)
    - [Служба образов](#image-service)
      - [ListImages](#listimages)
      - [ImageStatus](#imagestatus)
      - [PullImage](#pullimage)
      - [RemoveImage](#removeimage)
      - [ImageFsInfo](#imagefsinfo)
  - [Ограничения](#constraints-2)

## Описание

Интерфейс Container Runtime Interface (CRI) от Kubernetes определяет API для служб контейнеров и образов. iSulad использует CRI для взаимодействия с Kubernetes.

Поскольку среда выполнения контейнера изолирована от жизненного цикла образа, необходимо определить две службы. Данный API определяется с помощью [Буфера протокола](https://developers.google.com/protocol-buffers/) на основе [gRPC](https://grpc.io/).

Текущая версия CRI — v1alpha1. Официальное описание API доступно по следующей ссылке:

[https://github.com/kubernetes/kubernetes/blob/release-1.14/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto](https://github.com/kubernetes/kubernetes/blob/release-1.14/pkg/kubelet/apis/cri/runtime/v1alpha2/api.proto)

iSulad работает с файлом описания API версии 1.14, используемым Pass, который несколько отличается от официального файла описания API. В этом документе представлено данное описание API.

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
IP-адресом для прослушивания службы потоковой передачи WebSocket CRI является **127.0.0.1**, а номером порта — **10350**. Номер порта можно настроить в команде **--websocket-server-listening-port** или в конфигурационном файле **daemon.json.**

## API

В следующей таблице приведены параметры, которые можно использовать в каждом API. Некоторые параметры не вступают в силу немедленно, что упомянуто в соответствующем описании.

### Параметры API

- **DNSConfig**
  
  API для настройки серверов DNS и поисковых доменов песочницы.
  
  | Параметр                 | Описание                                                     |
  | ------------------------ | ------------------------------------------------------------ |
  | repeated string servers  | Список серверов DNS кластера.                                |
  | repeated string searches | Список поисковых доменов DNS кластера.                       |
  | repeated string options  | Список опций DNS. Подробнее см. https://linux.die.net/man/5/resolv.conf. |
  
- **Protocol**
  
  API для указания значений перечислимого типа протоколов.
  
  | **Параметр** | **Описание**                                                 |
  | ------------ | ------------------------------------------------------------ |
  | TCP = 0      | Протокол управления передачей (Transmission Control Protocol; TCP). |
  | UDP = 1      | Протокол пользовательских датаграмм (User Datagram Protocol; UDP). |
  
- **PortMapping**
  
  API для настройки портов, соответствующих песочнице.
  
  | **Параметр**                                                 | **Описание**                                     |
  | ------------------------------------------------------------ | ------------------------------------------------ |
  | [Protocol](#en-us_topic_0182207110_li19181174018421) protocol | Протокол, используемый для сопоставления портов. |
  | int32 container_port                                         | Номер порта в контейнере.                        |
  | int32 host_port                                              | Номер порта на хосте.                            |
  | string host_ip                                               | IP-адрес хоста.                                  |
  
- **MountPropagation**
  
  API для указания перечислимых типов атрибутов распространения монтирования.
  
  | **Параметр**                      | **Описание**                                                 |
  | --------------------------------- | ------------------------------------------------------------ |
  | PROPAGATION_PRIVATE = 0           | Нет атрибутов распространения монтирования, т.е. это частное монтирование в Linux. |
  | PROPAGATION_HOST_TO_CONTAINER = 1 | Атрибут монтирования, распространяемый от хоста в контейнер, то есть rslave в Linux. |
  | PROPAGATION_BIDIRECTIONAL = 2     | Атрибут монтирования, распространяемый между хостом и контейнером, то есть rshared в Linux. |
  
- **Mount**
  
  API для монтирования тома, расположенного на хосте, в контейнер. (Поддерживаются только файлы и папки.)
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string container_path                                        | Путь в контейнере.                                           |
  | string host_path                                             | Путь на хосте.                                               |
  | bool readonly                                                | Параметр определяет поддержку конфигурации «только для чтения» в контейнере. Значение по умолчанию: **false** |
  | bool selinux_relabel                                         | Настройка метки SELinux. Данный параметр в настоящее время не действует. |
  | [MountPropagation](#en-us_topic_0182207110_li201899371871) propagation | Атрибут распространения монтирования. Значения **0**, **1**, **2** соответствуют атрибутам распространения private, rslave и rshared соответственно. Значение по умолчанию: **0** |
  
  
  
- **NamespaceOption**
  
  | **Параметр**      | Описание                                                     |
  | ----------------- | ------------------------------------------------------------ |
  | bool host_network | Параметр определяет использование сетевых пространств имен хоста. |
  | bool host_pid     | Параметр определяет использование пространств имен PID хоста. |
  | bool host_ipc     | Параметр определяет использование пространств имен IPC хоста. |
  
- **Capability**
  
  API для указания добавляемых и удаляемых функций.
  
  | **Параметр**                      | **Описание**         |
  | --------------------------------- | -------------------- |
  | repeated string add_capabilities  | Добавляемые функции. |
  | repeated string drop_capabilities | Удаляемые функции.   |
  
- **Int64Value**
  
  API для инкапсуляции данных подписанного 64-разрядного целого числа.
  
  | **Параметр** | **Описание**                                                 |
  | ------------ | ------------------------------------------------------------ |
  | int64 value  | Фактическое значение подписанного 64-разрядного целого числа. |
  
- **UInt64Value**
  
  API для инкапсуляции данных неподписанного 64-разрядного целого числа.
  
  | **Параметр** | **Описание**                                                 |
  | ------------ | ------------------------------------------------------------ |
  | uint64 value | Фактическое значение неподписанного 64-разрядного целого числа. |
  
- **LinuxSandboxSecurityContext**
  
  API для настройки параметров безопасности Linux песочницы.
  
  Следует учесть, что эти параметры безопасности не применяются к контейнерам в песочнице и не могут применяться к самой песочнице без имеющегося в наличии запущенного процесса.
  
  | **Параметр**                                                 | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | [NamespaceOption](#en-us_topic_0182207110_li1182444614213) namespace_options | Параметры пространства имен песочницы.                       |
  | [SELinuxOption](#en-us_topic_0182207110_li816815620237) selinux_options | Параметры SELinux. Данный параметр в настоящее время не действует. |
  | [Int64Value](#en-us_topic_0182207110_li1439643415372) run_as_user | UID процесса в песочнице.                                    |
  | bool readonly_rootfs                                         | Параметр определяет режим «только для чтения» для корневой файловой системы песочницы. |
  | repeated int64 supplemental_groups                           | Информация о группе пользователей процесса init в песочнице (кроме первичного GID) |
  | bool privileged                                              | Параметр определяет песочницу как привилегированный контейнер. |
  | string seccomp_profile_path                                  | Путь к конфигурационному файлу seccomp. Действительные значения следующие:  <br />**// unconfined**: seccomp не сконфигурирован.  <br />**// localhost/** *Full path of the configuration file*: установленный в системе путь к конфигурационному файлу. <br /> **//** *Full path of the configuration file*: полный путь к конфигурационному файлу.  <br />**// unconfined**: значение по умолчанию. |
  
- **LinuxPodSandboxConfig**
  
  API для настройки информации, относящейся к контейнерам и хосту Linux.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string cgroup_parent                                         | Родительский путь к контрольной группе cgroup песочницы. В среде выполнения в зависимости от требований объекта может использоваться синтаксис cgroupfs или systemd. Данный параметр в настоящее время не действует. |
  | [LinuxSandboxSecurityContext](#en-us_topic_0182207110_li20215550104713) security_context | Атрибут безопасности песочницы.                              |
  | map<string, string> sysctls                                  | Конфигурация sysctls Linux песочницы.                        |
  
- **PodSandboxMetadata**
  
  Метаданные песочницы содержат всю информацию, формирующую имя песочницы. Пользователям удобнее работать, когда метаданные отображаются на пользовательском интерфейсе во время работы контейнера. Например, на основе метаданных во время работы контейнера можно сгенерировать уникальное имя песочницы.
  
  | **Параметр**     | **Описание**                                                 |
  | ---------------- | ------------------------------------------------------------ |
  | string name      | Имя песочницы.                                               |
  | string uid       | UID-идентификатор песочницы.                                 |
  | string namespace | Пространство имен песочницы.                                 |
  | uint32 attempt   | Количество попыток создать песочницу. Значение по умолчанию: **0** |
  
- **PodSandboxConfig**
  
  API для указания всех обязательных и необязательных параметров для создания песочницы.
  
  | **Параметр**                                                 | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | [PodSandboxMetadata](#en-us_topic_0182207110_li2359918134912) metadata | Метаданные песочницы, которые уникально ее идентифицируют. Использование данной информации в среде выполнения обеспечит корректное выполнение операций и улучшит пользовательский опыт, например, с ее помощью создается читабельное имя песочницы. |
  | string hostname                                              | Имя хоста песочницы.                                         |
  | string log_directory                                         | Папка для хранения файлов журнала контейнера в песочнице.    |
  | [DNSConfig](#en-us_topic_0182207110_li1197211439388) dns_config | Конфигурация DNS песочницы.                                  |
  | repeated [PortMapping](#en-us_topic_0182207110_li01684174215) port_mappings | Соответствие портов песочницы.                               |
  | map<string, string> labels                                   | Пара ключ-значение, которую можно использовать для идентификации песочницы или серии песочниц. |
  | map<string, string> annotations                              | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить и можно запрашивать с помощью API [PodSandboxStatus](#en-us_topic_0182207110_li146986172010). |
  | [LinuxPodSandboxConfig](#en-us_topic_0182207110_li14801654104710) linux | Параметры, связанные с хостом Linux.                         |
  
- **PodSandboxNetworkStatus**
  
  API для описания состояния сети песочницы.
  
  | Параметр       | **Описание**                         |
  | -------------- | ------------------------------------ |
  | string ip      | IP-адрес песочницы.                  |
  | string name    | Имя сетевого интерфейса в песочнице. |
  | string network | Имя дополнительной сети.             |
  
- **Namespace**
  
  API для установки параметров пространства имен.
  
  | **Параметр**                                                 | **Описание**                       |
  | ------------------------------------------------------------ | ---------------------------------- |
  | [NamespaceOption](#en-us_topic_0182207110_li1182444614213) options | Параметры пространства имен Linux. |
  
- **LinuxPodSandboxStatus**
  
  API для описания состояния песочницы Linux.
  
  | **Параметр**                                                 | **Описание**                 |
  | ------------------------------------------------------------ | ---------------------------- |
  | [Namespace](#en-us_topic_0182207110_li523062951815) **namespaces** | Пространство имен песочницы. |
  
- **PodSandboxState**
  
  API для указания перечислимого типа значений состояния песочницы.
  
  | **Параметр**         | **Описание**         |
  | -------------------- | -------------------- |
  | SANDBOX_READY = 0    | Песочница готова.    |
  | SANDBOX_NOTREADY = 1 | Песочница не готова. |
  
- **PodSandboxStatus**
  
  API для описания состояния Pod-песочницы.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор песочницы.                                     |
  | [PodSandboxMetadata](#en-us_topic_0182207110_li2359918134912) metadata | Метаданные песочницы.                                        |
  | [PodSandboxState](#en-us_topic_0182207110_li1818214574195) state | Значение состояния песочницы.                                |
  | int64 created_at                                             | Отметка времени создания песочницы (единица измерения: нс).  |
  | repeated [PodSandboxNetworkStatus](#en-us_topic_0182207110_li255017717184) networks | Состояние многоплоскостной сети песочницы.                   |
  | [LinuxPodSandboxStatus](#en-us_topic_0182207110_li313112151212) linux | Состояние песочницы, соответствующее спецификациям Linux.    |
  | map<string, string> labels                                   | Пара ключ-значение, которую можно использовать для идентификации песочницы или серии песочниц. |
  | map<string, string> annotations                              | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить в среде выполнения. |
  
- **PodSandboxStateValue**
  
  API для инкапсуляции данных [PodSandboxState](#en-us_topic_0182207110_li1818214574195).
  
  | **Параметр**                                                 | **Описание**                  |
  | ------------------------------------------------------------ | ----------------------------- |
  | [PodSandboxState](#en-us_topic_0182207110_li1818214574195) state | Значение состояния песочницы. |
  
- **PodSandboxFilter**
  
  API используется для добавления критериев фильтрации для списка песочниц. Отображаются совпадения по нескольким критериям фильтрации.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор песочницы.                                     |
  | [PodSandboxStateValue](#en-us_topic_0182207110_li64922552019) state | Состояние песочницы.                                         |
  | map<string, string> label_selector                           | Метка песочницы, которая не поддерживает регулярные выражения  и должна полностью совпадать. |
  
- **PodSandbox**
  
  API для минимального описания песочницы.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор песочницы.                                     |
  | [PodSandboxMetadata](#en-us_topic_0182207110_li2359918134912) metadata | Метаданные песочницы.                                        |
  | [PodSandboxState](#en-us_topic_0182207110_li1818214574195) state | Значение состояния песочницы.                                |
  | int64 created_at                                             | Отметка времени создания песочницы (единица измерения: нс).  |
  | map<string, string> labels                                   | Пара ключ-значение, которую можно использовать для идентификации песочницы или серии песочниц. |
  | map<string, string> annotations                              | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить в среде выполнения. |
  
- **KeyValue**
  
  API для инкапсуляции пар ключ-значение.
  
  | **Параметр** | **Описание** |
  | ------------ | ------------ |
  | string key   | Ключ         |
  | string value | Значение     |
  
- **SELinuxOption**
  
  API для указания метки SELinux контейнера.
  
  | **Параметр** | **Описание** |
  | ------------ | ------------ |
  | string user  | Пользователь |
  | string role  | Роль         |
  | string type  | Тип          |
  | string level | Уровень      |
  
- **ContainerMetadata**
  
  Метаданные контейнера содержат всю информацию, формирующую имя контейнера. Пользователям удобнее работать, когда метаданные отображаются на пользовательском интерфейсе во время работы контейнера. Например, на основе метаданных во время работы контейнера можно сгенерировать уникальное имя контейнера.
  
  | **Параметр**   | **Описание**                                                 |
  | -------------- | ------------------------------------------------------------ |
  | string name    | Имя контейнера.                                              |
  | uint32 attempt | Количество попыток создания контейнера. Значение по умолчанию: **0** |
  
- **ContainerState**
  
  API для указания перечислимого типа значений состояния контейнера.
  
  | **Параметр**          | **Описание**                      |
  | --------------------- | --------------------------------- |
  | CONTAINER_CREATED = 0 | Контейнер создан.                 |
  | CONTAINER_RUNNING = 1 | Контейнер запущен и работает.     |
  | CONTAINER_EXITED = 2  | Контейнер завершил работу.        |
  | CONTAINER_UNKNOWN = 3 | Неизвестное состояние контейнера. |
  
- **ContainerStateValue**
  
  API для инкапсуляции структуры данных [ContainerState](#en-us_topic_0182207110_li65182518309).
  
  | **Параметр**                                                 | **Описание**                   |
  | ------------------------------------------------------------ | ------------------------------ |
  | [ContainerState](#en-us_topic_0182207110_li65182518309) **state** | Значение состояния контейнера. |
  
- **ContainerFilter**
  
  API для добавления критериев фильтрации для списка контейнеров. Отображаются совпадения по нескольким критериям фильтрации.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор контейнера                                     |
  | [PodSandboxStateValue](#en-us_topic_0182207110_li64922552019) state | Состояние контейнера.                                        |
  | string pod_sandbox_id                                        | Идентификатор песочницы.                                     |
  | map<string, string> label_selector                           | Метка контейнера, которая не поддерживает регулярные выражения и должна полностью совпадать. |
  
- **LinuxContainerSecurityContext**
  
  API для указания настроек безопасности контейнера.
  
  | **Параметр**                                                 | **Описание**                                                 |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | [Capability](#en-us_topic_0182207110_li115631277434) capabilities | Добавленные или удаленные функции.                           |
  | bool privileged                                              | Определяет, находится или нет контейнер в привилегированном режиме. Значение по умолчанию: **false** |
  | [NamespaceOption](#en-us_topic_0182207110_li1182444614213) namespace_options | Параметры пространства имен контейнера.                      |
  | [SELinuxOption](#en-us_topic_0182207110_li816815620237) selinux_options | Контекст SELinux, который является необязательным. Данный параметр в настоящее время не действует. |
  | [Int64Value](#en-us_topic_0182207110_li1439643415372) run_as_user | UID для выполнения контейнерных процессов. В один момент времени можно указать только **run_as_user** или **run_as_username**. Значение **run_as_username** вступает в силу приоритетно. |
  | string run_as_username                                       | Имя пользователя для выполнения контейнерных процессов. Если данный параметр указан, пользователь должен существовать в /etc/passwd** образа контейнера и должен быть проанализирован средой выполнения. В противном случае во время работы произойдет ошибка. |
  | bool readonly_rootfs                                         | Параметр определяет режим «только для чтения» для корневой файловой системы контейнера. Значение по умолчанию конфигурируется в файле **config.json**. |
  | repeated int64 supplemental_groups                           | Информация о группе пользователей процесса init, запущенного в контейнере (кроме первичного GID). |
  | string apparmor_profile                                      | Конфигурационный файл AppArmor клиента. Данный параметр в настоящее время не действует. |
  | string seccomp_profile_path                                  | Путь к конфигурационному файлу seccomp контейнера.           |
  | bool no_new_privs                                            | Параметр устанавливает флаг no_new_privs в контейнере.       |
  
- **LinuxContainerResources**
  
  API для указания настроек ресурсов контейнеров Linux.
  
  | **Параметр**                | **Описание**                                                 |
  | --------------------------- | ------------------------------------------------------------ |
  | int64 cpu_period            | Период CFS процессора. Значение по умолчанию: **0**          |
  | int64 cpu_quota             | Квота CFS процессора. Значение по умолчанию: **0**           |
  | int64 cpu_shares            | Процент времени занятия ресурсов процессора (относительный вес). Значение по умолчанию: **0** |
  | int64 memory_limit_in_bytes | Ограничение памяти (единица измерения: байт). Значение по умолчанию: **0** |
  | int64 oom_score_adj         | OOMScoreAdj, который используется для настройки функции OOM killer, завершающей работу. Значение по умолчанию: **0** |
  | string cpuset_cpus          | Ядро процессора, используемое контейнером. Значение по умолчанию: null |
  | string cpuset_mems          | Узлы памяти, используемые контейнером. Значение по умолчанию: null |
  
- **Image**
  
  API для описания базовой информации об образе.
  
  | **Параметр**                                              | **Описание**                          |
  | --------------------------------------------------------- | ------------------------------------- |
  | string id                                                 | Идентификатор образа.                 |
  | repeated string repo_tags                                 | Имя тега образа **repo_tags**.        |
  | repeated string repo_digests                              | Информация о дайджесте образа.        |
  | uint64 size                                               | Размер образа.                        |
  | [Int64Value](#en-us_topic_0182207110_li1439643415372) uid | UID образа по умолчанию.              |
  | string username                                           | Имя пользователя образа по умолчанию. |
  
- **ImageSpec**
  
  API для представления внутренней структуры данных образа. В настоящее время ImageSpec инкапсулирует только имя образа контейнера.
  
  | **Параметр** | **Описание**           |
  | ------------ | ---------------------- |
  | string image | Имя образа контейнера. |
  
- **StorageIdentifier**
  
  API для указания уникального идентификатора, который определяет хранилище.
  
  | **Параметр** | **Описание**     |
  | ------------ | ---------------- |
  | string uuid  | UUID устройства. |
  
- **FilesystemUsage**
  
  | **Параметр**                                                 | **Описание**                                                 |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | int64 timestamp                                              | Отметка времени сбора информации о файловой системе.         |
  | [StorageIdentifier](#en-us_topic_0182207110_li3285401546) storage_id | UUID файловой системы, в которой хранятся образы.            |
  | [UInt64Value](#en-us_topic_0182207110_li1886455713453) used_bytes | Размер метаданных для хранения образов.                      |
  | [UInt64Value](#en-us_topic_0182207110_li1886455713453) inodes_used | Количество индексных дескрипторов (inode) метаданных для хранения образов. |
  
- **AuthConfig**
  
  | **Параметр**          | **Описание**                                                 |
  | --------------------- | ------------------------------------------------------------ |
  | string username       | Имя пользователя, используемое для загрузки образов.         |
  | string password       | Пароль, используемый для загрузки образов.                   |
  | string auth           | Информация аутентификации, используемая для загрузки образов. Значение кодируется с помощью Base64. |
  | string server_address | IP-адрес сервера, с которого загружаются образы. Данный параметр в настоящее время не действует. |
  | string identity_token | Информация о маркере, используемом для аутентификации реестра. Данный параметр в настоящее время не действует. |
  | string registry_token | Информация о маркере, используемом для взаимодействия с реестром. Данный параметр в настоящее время не действует. |
  
- **Container**
  
  API для описания такой информации контейнера, как идентификатор и статус.
  
  | Параметр                                                     | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор контейнера                                     |
  | string pod_sandbox_id                                        | Идентификатор песочницы, которой принадлежит контейнер.      |
  | [ContainerMetadata](#en-us_topic_0182207110_li17135914132319) metadata | Метаданные контейнера.                                       |
  | [ImageSpec](#en-us_topic_0182207110_li597891416252) image    | Спецификации образа.                                         |
  | string image_ref                                             | Образ, используемый контейнером. Этот параметр является идентификатором образа в большинстве сред выполнения. |
  | [ContainerState](#en-us_topic_0182207110_li65182518309) state | Состояние контейнера.                                        |
  | int64 created_at                                             | Отметка времени создания контейнера (единица измерения: нс). |
  | map<string, string> labels                                   | Пара ключ-значение, которую можно использовать для идентификации контейнера или серии контейнеров. |
  | map<string, string> annotations                              | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить в среде выполнения. |
  
- **ContainerStatus**
  
  API для описания статуса контейнера.
  
  | Параметр                                                     | **Описание**                                                 |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор контейнера                                     |
  | [ContainerMetadata](#en-us_topic_0182207110_li17135914132319) metadata | Метаданные контейнера.                                       |
  | [ContainerState](#en-us_topic_0182207110_li65182518309) state | Состояние контейнера.                                        |
  | int64 created_at                                             | Отметка времени создания контейнера (единица измерения: нс). |
  | int64 started_at                                             | Отметка времени запуска контейнера (единица измерения: нс).  |
  | int64 finished_at                                            | Отметка времени завершения работы контейнера (единица измерения: нс). |
  | int32 exit_code                                              | Код выхода контейнера.                                       |
  | [ImageSpec](#en-us_topic_0182207110_li597891416252) image    | Спецификации образа.                                         |
  | string image_ref                                             | Образ, используемый контейнером. Этот параметр является идентификатором образа в большинстве сред выполнения. |
  | string reason                                                | Краткое описание причины нахождения контейнера в текущем состоянии. |
  | string message                                               | Легко читаемая информация, указывающая на причину нахождения контейнера в текущем состоянии. |
  | map<string, string> labels                                   | Пара ключ-значение, которую можно использовать для идентификации контейнера или серии контейнеров. |
  | map<string, string> annotations                              | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить в среде выполнения. |
  | repeated [Mount](#en-us_topic_0182207110_li6779341144216) mounts | Информация о точке монтирования контейнера.                  |
  | string log_path                                              | Путь к файлу журнала контейнера, который находится в папке **log_directory**, сконфигурированной в [PodSandboxConfig](#en-us_topic_0182207110_li253629701). |
  
- **ContainerStatsFilter**
  
  API для добавления критериев фильтрации для списка статистических данных контейнеров. Отображаются совпадения по нескольким критериям фильтрации.
  
  | Параметр                           | Описание                                                     |
  | ---------------------------------- | ------------------------------------------------------------ |
  | string id                          | Идентификатор контейнера                                     |
  | string pod_sandbox_id              | Идентификатор песочницы.                                     |
  | map<string, string> label_selector | Метка контейнера, которая не поддерживает регулярные выражения  и должна полностью совпадать. |
  
- **ContainerStats**
  
  API для добавления критериев фильтрации для списка статистических данных контейнеров. Отображаются совпадения по нескольким критериям фильтрации.
  
  | **Параметр**                                                 | **Описание**                                    |
  | ------------------------------------------------------------ | ----------------------------------------------- |
  | [ContainerAttributes](#en-us_topic_0182207110_li6207185712312) attributes | Информация о контейнере.                        |
  | [CpuUsage](#en-us_topic_0182207110_li1367131122711) cpu      | Информация о загрузке процессора.               |
  | [MemoryUsage](#en-us_topic_0182207110_li81221520111718) memory | Информация о загрузке памяти.                   |
  | [FilesystemUsage](#en-us_topic_0182207110_li1606183118189) writable_layer | Информация о загрузке ресурсов слоя для записи. |
  
- **ContainerAttributes**
  
  API для вывода базовой информации о контейнере.
  
  | Параметр**                                                   | Описание                                                     |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | string id                                                    | Идентификатор контейнера                                     |
  | [ContainerMetadata](#en-us_topic_0182207110_li17135914132319) metadata | Метаданные контейнера.                                       |
  | map<string,string> labels                                    | Пара ключ-значение, которую можно использовать для идентификации контейнера или серии контейнеров. |
  | map<string,string> annotations                               | Пара ключ-значение, хранящая любую информацию, значения которой нельзя изменить в среде выполнения. |
  
- **CpuUsage**
  
  API для вывода информации о загрузке процессора контейнером.
  
  | **Параметр**                        | Описание                                              |
  | ----------------------------------- | ----------------------------------------------------- |
  | int64 timestamp                     | Отметка времени.                                      |
  | UInt64Value usage_core_nano_seconds | Загрузка ресурсов процессора (единица измерения: нс). |
  
- **MemoryUsage**
  
  API для вывода информации о загрузке памяти контейнером.
  
  | **Параметр**                  | **Описание**              |
  | ----------------------------- | ------------------------- |
  | int64 timestamp               | Отметка времени.          |
  | UInt64Value working_set_bytes | Загрузка ресурсов памяти. |
  
- **FilesystemUsage**
  
  API для вывода информации об уровне чтения/записи контейнера.
  
  | Параметр                     | **Описание**                                                 |
  | ---------------------------- | ------------------------------------------------------------ |
  | int64 timestamp              | Отметка времени.                                             |
  | StorageIdentifier storage_id | Каталог для слоя записи.                                     |
  | UInt64Value used_bytes       | Количество байт, занятых образами в слое записи.             |
  | UInt64Value inodes_used      | Количество индексных дескрипторов inode, занятых образами в  слое записи. |
  
- **Device**
  
  API для указания тома хоста, который необходимо смонтировать на контейнере.
  
  | **Параметр**          | **Описание**                                                 |
  | --------------------- | ------------------------------------------------------------ |
  | string container_path | Путь монтирования контейнера.                                |
  | string host_path      | Путь монтирования на хосте.                                  |
  | string permissions    | Разрешение контрольной группы сgroup устройства. (**rr** означает, что контейнеры можно считывать из указанного устройства. **w** означает, что контейнеры можно записывать на указанное устройство. **m** означает, что контейнеры могут создавать файлы нового устройства.) |
  
- **LinuxContainerConfig**
  
  API для указания конфигурации Linux.
  
  | **Параметр**                                                 | **Описание**                                |
  | ------------------------------------------------------------ | ------------------------------------------- |
  | [LinuxContainerResources](#en-us_topic_0182207110_li2050214613477) resources | Спецификации ресурсов контейнера.           |
  | [LinuxContainerSecurityContext](#en-us_topic_0182207110_li11771452124416) security_context | Конфигурация безопасности контейнера Linux. |
  
- **ContainerConfig**
  
  API для указания всех обязательных и необязательных полей для создания песочницы.
  
  | **Параметр**                                                 | **Описание**                                                 |
  | ------------------------------------------------------------ | ------------------------------------------------------------ |
  | [ContainerMetadata](#en-us_topic_0182207110_li17135914132319) metadata | Метаданные контейнера. Информация, которая уникально идентифицирует контейнер и должна использоваться в среде выполнения для обеспечения корректной работы. Данная информация также может использоваться в среде выполнения для оптимизации пользовательского опыта, например для создания читаемого имени. Параметр обязательный. |
  | [ImageSpec](#en-us_topic_0182207110_li597891416252) image    | Образ, используемый контейнером. Параметр обязательный.      |
  | repeated string command                                      | Команда, которую требуется выполнить. Значение по умолчанию: **/bin/sh** |
  | repeated string args                                         | Параметры выполняемой команды.                               |
  | string working_dir                                           | Текущий рабочий путь команды.                                |
  | repeated [KeyValue](#en-us_topic_0182207110_li11598132815225) envs | Переменные среды, сконфигурированные в контейнере.           |
  | repeated [Mount](#en-us_topic_0182207110_li6779341144216) mounts | Информация о точке монтирования в контейнере.                |
  | repeated [Device](#en-us_topic_0182207110_li19916726173311) devices | Информация об устройстве, с которым требуется установить соответствие в контейнере. |
  | map<string, string> labels                                   | Пара ключ-значение, которая может использоваться для индексации и выбора ресурса. |
  | map<string, string> annotations                              | Неструктурированные данные пары ключ-значение, которые могут использоваться для хранения и извлечения любых метаданных. |
  | string log_path                                              | Относительный путь к **PodSandboxConfig.LogDirectory**, который используется для хранения журналов (STDOUT и STDERR) на хосте контейнера. |
  | bool stdin                                                   | Параметр определяет, открывать или не открывать **stdin** контейнера. |
  | bool stdin_once                                              | Параметр устанавливает немедленное отключение остальных потоков данных, подключенных к **stdin**, в случае отключения от **stdin** одного из потоков. Данный параметр в настоящее время не действует. |
  | bool tty                                                     | Параметр определяет использование псевдотерминала для подключения к **stdio** контейнера. |
  | [LinuxContainerConfig](#en-us_topic_0182207110_li13021147134718) linux | Информация о конфигурации контейнера в системе Linux.        |
  
- **NetworkConfig**
  
  API для указания сетевых настроек среды выполнения.
  
  | **Параметр**    | **Описание**                        |
  | --------------- | ----------------------------------- |
  | string pod_cidr | CIDR, используемый IP-адресами pod. |
  
- **RuntimeConfig**
  
  API для указания сетевых настроек среды выполнения.
  
  | **Параметр**                                                 | **Описание**                          |
  | ------------------------------------------------------------ | ------------------------------------- |
  | [NetworkConfig](#en-us_topic_0182207110_li12222146464) network_config | Конфигурация сети в среде выполнения. |
  
- **RuntimeCondition**
  
  API для описания информации о состоянии среды выполнения.
  
  | **Параметр**   | **Описание**                                                 |
  | -------------- | ------------------------------------------------------------ |
  | string type    | Тип состояния среды выполнения.                              |
  | bool status    | Состояние среды выполнения.                                  |
  | string reason  | Краткое описание причины изменения состояния среды выполнения. |
  | string message | Читабельное сообщение, в котором указывается причина изменения состояния среды выполнения. |
  
- **RuntimeStatus**
  
  API для описания статуса среды выполнения.
  
  | **Параметр**                         | **Описание**                        |
  | ------------------------------------ | ----------------------------------- |
  | repeated RuntimeCondition conditions | Текущее состояние среды выполнения. |


### Служба среды выполнения

Служба среды выполнения предоставляет API для работы pod-групп и контейнеров, а также API для запроса информации о конфигурации и статусе службы среды выполнения.

#### RunPodSandbox

#### Прототип

```
rpc RunPodSandbox(RunPodSandboxRequest) returns (RunPodSandboxResponse) {}
```

#### Описание

Данный API используется для создания и запуска PodSandbox. При успешном запуске PodSandbox песочница переходит в состояние готовности.

#### Меры предосторожности

1. Образом по умолчанию для запуска песочницы является **rnd-dockerhub.huawei.com/library/pause-${**_machine_**}:3.0**, где **${**_machine_**}** означает архитектуру. Для архитектуры x86\_64 значением _machine_ будет **amd64**. Для архитектуры ARM64 значением _machine_ будет **aarch64**. В настоящее время из реестра rnd-dockerhub можно загрузить только образ **amd64** или **aarch64**. Если образ не существует на хосте, убедитесь, что хост может загрузить образ из реестра rnd-dockerhub. Если необходимо использовать другой образ, см. описание **pod-sandbox-image** в главе _Конфигурация настроек при развертывании iSulad_.
2. Имя контейнера берется из поля в [PodSandboxMetadata](#apis.md#en-us_topic_0182207110_li2359918134912), отделяясь знаком подчеркивания (\_). Поэтому метаданные не могут содержать знак подчеркивания (\_). В противном случае, API [ListPodSandbox](#listpodsandbox.md#EN-US_TOPIC_0184808098) нельзя будет использовать для запроса, даже если песочница нормально работает.

#### Параметры

| Параметр                                                     | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [PodSandboxConfig](#apis.md#en-us_topic_0182207110_li253629) config | Конфигурация песочницы.                                      |
| string runtime_handler                                       | Среда выполнения для созданной песочницы. В настоящее время поддерживаются среды lcr и kata-runtime. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                                                 |
| ------------------------- | ------------------------------------------------------------ |
| string pod_sandbox_id     | Если операция прошла успешно, возвращается соответствующий ответ. |

#### StopPodSandbox

#### Прототип

```
rpc StopPodSandbox(StopPodSandboxRequest) returns (StopPodSandboxResponse) {}
```

#### Описание

Данный API используется для остановки контейнеров PodSandboxes и песочницы, а также перераспределения сетевых ресурсов (например, IP-адресов), выделенных песочницам. Если в песочнице есть работающий контейнер, он принудительно останавливается.

#### Параметры

| **Параметр**          | **Описание**             |
| --------------------- | ------------------------ |
| string pod_sandbox_id | Идентификатор песочницы. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание** |
| ------------------------- | ------------ |
| --                        | --           |

#### RemovePodSandbox

#### Прототип

```
rpc RemovePodSandbox(RemovePodSandboxRequest) returns (RemovePodSandboxResponse) {}
```

#### Описание

Данный API используется для удаления песочницы. Если в песочнице есть работающий контейнер, он принудительно останавливается и удаляется. Если песочница удаляется, ошибка не возвращается.

#### Меры предосторожности

1. При удалении песочницы ее сетевые ресурсы не удаляются. Прежде чем удалить pod-группу, необходимо инициировать вызов StopPodSandbox, чтобы освободить сетевые ресурсы. Перед удалением песочницы убедитесь, что инициирован как минимум один вызов StopPodSandbox.

#### Параметры

| **Параметр**          | **Описание**             |
| --------------------- | ------------------------ |
| string pod_sandbox_id | Идентификатор песочницы. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание** |
| ------------------------- | ------------ |
| --                        | --           |

#### PodSandboxStatus

#### Прототип

```
rpc PodSandboxStatus(PodSandboxStatusRequest) returns (PodSandboxStatusResponse) {}
```

#### Описание

Это API для запроса состояния песочницы. Если песочница не существует, возвращается ошибка.

#### Параметры

| **Параметр**          | **Описание**                                                 |
| --------------------- | ------------------------------------------------------------ |
| string pod_sandbox_id | Идентификатор песочницы.                                     |
| bool verbose          | Параметр устанавливает, будет или не будет отображаться дополнительная информация о песочнице. Данный параметр в настоящее время не действует. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [PodSandboxStatus](#apis.md#en-us_topic_0182207110_li146986) status | Состояние песочницы.                                         |
| map<string, string> info                                     | Дополнительная информация о песочнице. Ключом может быть любая строка, а значением является строка символов JSON. Информация может содержать любые данные об отладке. Если параметр **verbose** имеет значение **true**, параметр **info** не должен быть пустым. Данный параметр в настоящее время не действует. |

#### ListPodSandbox

#### Прототип

```
rpc ListPodSandbox(ListPodSandboxRequest) returns (ListPodSandboxResponse) {}
```

#### Описание

Это API для возврата информации о песочнице. Поддерживается фильтрация на основе критериев.

#### Параметры

| **Параметр**                                                 | **Описание**         |
| ------------------------------------------------------------ | -------------------- |
| [PodSandboxFilter](#apis.md#en-us_topic_0182207110_li179131) filter | Критерии фильтрации. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**             |
| ------------------------------------------------------------ | ------------------------ |
| repeated [PodSandbox](#apis.md#en-us_topic_0182207110_li105421) items | Список данных песочницы. |

#### CreateContainer

```
grpc::Status CreateContainer(grpc::ServerContext *context, const runtime::CreateContainerRequest *request, runtime::CreateContainerResponse *reply) {}
```

#### Описание

Данный API используется для создания контейнера в PodSandbox.

#### Меры предосторожности

- **sandbox\_config** в **CreateContainerRequest** совпадает с настройками, переданными в **RunPodSandboxRequest** для создания PodSandbox. Эта настройка передается заново, но только для справочной информации. PodSandboxConfig должен оставаться неизменным на протяжении всего жизненного цикла pod-группы.
- Имя контейнера берется из поля в [ContainerMetadata](#apis.md#en-us_topic_0182207110_li17135914132319), отделяясь знаком подчеркивания (\_). Поэтому метаданные не могут содержать знак подчеркивания (\_). В противном случае, API [ListContainers](#listcontainers.md#EN-US_TOPIC_0184808103) нельзя будет использовать для запроса, даже если песочница нормально работает.
- **CreateContainerRequest** не содержит поля **runtime\_handler**. Тип среды выполнения контейнера совпадает с типом среды выполнения соответствующей песочницы.

#### Параметры

| **Параметр**                                                 | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| string pod_sandbox_id                                        | Идентификатор PodSandbox, в которой должен быть создан контейнер. |
| [ContainerConfig](#apis.md#en-us_topic_0182207110_li951716) config | Информация о конфигурации контейнера.                        |
| [PodSandboxConfig](#apis.md#en-us_topic_0182207110_li253629) sandbox_config | Информация о конфигурации PodSandbox.                        |

#### Дополнительные параметры

Неструктурированные данные пары ключ-значение, которые могут использоваться для хранения и извлечения любых метаданных. Это поле может использоваться для передачи значений параметров для тех полей, для которых CRI не предоставляет отдельных параметров.

- Настройка поля:
  
  | **Настраиваемая пара ключ:значение** | **Описание**                                                 |
  | ------------------------------------ | ------------------------------------------------------------ |
  | cgroup.pids.max:int64_t              | Используется для ограничения количества процессов или потоков в контейнере. (Значение **-1** означает отсутствие ограничений.) |


#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                         |
| ------------------------- | ------------------------------------ |
| string container_id       | Идентификатор созданного контейнера. |

#### StartContainer

#### Прототип

```
rpc StartContainer(StartContainerRequest) returns (StartContainerResponse) {}
```

#### Описание

Данный API используется для запуска контейнера.

#### Параметры

| **Параметр**        | **Описание**             |
| ------------------- | ------------------------ |
| string container_id | Идентификатор контейнера |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание** |
| ------------------------- | ------------ |
| --                        | --           |

#### StopContainer

#### Прототип

```
rpc StopContainer(StopContainerRequest) returns (StopContainerResponse) {}
```

#### Описание

Данный API используется для остановки работающего контейнера. Устанавливается время ожидания «мягкой» остановки. Если контейнер останавливается за этот период, ошибка не возвращается.

#### Параметры

| **Параметр**        | **Описание**                                                 |
| ------------------- | ------------------------------------------------------------ |
| string container_id | Идентификатор контейнера                                     |
| int64 timeout       | Время ожидания, прежде чем контейнер будет принудительно остановлен. Значение по умолчанию **0** задает принудительную остановку без ожидания. |

#### Возвращаемые значения

\--

#### RemoveContainer

#### Прототип

```
rpc RemoveContainer(RemoveContainerRequest) returns (RemoveContainerResponse) {}
```

#### Описание

Это API для удаления контейнера. Если контейнер работает, его необходимо остановить принудительной операцией. Если контейнер удаляется, ошибка не возвращается.

#### Параметры

| **Параметр**        | **Описание**             |
| ------------------- | ------------------------ |
| string container_id | Идентификатор контейнера |

#### Возвращаемые значения

\--

#### ListContainers

#### Прототип

```
rpc ListContainers(ListContainersRequest) returns (ListContainersResponse) {}
```

#### Описание

Это API для возврата информации о контейнере. Поддерживается фильтрация на основе критериев.

#### Параметры

| **Параметр**                                                 | **Описание**         |
| ------------------------------------------------------------ | -------------------- |
| [ContainerFilter](#apis.md#en-us_topic_0182207110_li780212) filter | Критерии фильтрации. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**              |
| ------------------------------------------------------------ | ------------------------- |
| repeated [Container](#apis.md#en-us_topic_0182207110_li206367) containers | Список данных контейнера. |

#### ContainerStatus

#### Прототип

```
rpc ContainerStatus(ContainerStatusRequest) returns (ContainerStatusResponse) {}
```

#### Описание

Это API для возврата информации о статусе контейнера. Если контейнер не существует, возвращается ошибка.

#### Параметры

| **Параметр**        | **Описание**                                                 |
| ------------------- | ------------------------------------------------------------ |
| string container_id | Идентификатор контейнера                                     |
| bool verbose        | Параметр устанавливает, будет или не будет отображаться дополнительная информация о песочнице. Данный параметр в настоящее время не действует. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ContainerStatus](#apis.md#en-us_topic_0182207110_li123406) status | Информация о состоянии контейнера.                           |
| map<string, string> info                                     | Дополнительная информация о песочнице. Ключом может быть любая строка, а значением является строка символов JSON. Информация может содержать любые данные об отладке. Если параметр **verbose** имеет значение **true**, параметр **info** не должен быть пустым. Данный параметр в настоящее время не действует. |

#### UpdateContainerResources

#### Прототип

```
rpc UpdateContainerResources(UpdateContainerResourcesRequest) returns (UpdateContainerResourcesResponse) {}
```

#### Описание

Это API для обновления конфигурации ресурсов контейнера.

#### Меры предосторожности

- Данный API не используется для обновления конфигурации pod-ресурсов.
- Значение **oom\_score\_adj** любого контейнера обновить нельзя.

#### Параметры

| **Параметр**                                                 | **Описание**                              |
| ------------------------------------------------------------ | ----------------------------------------- |
| string container_id                                          | Идентификатор контейнера.                 |
| [LinuxContainerResources](#apis.md#en-us_topic_0182207110_li205021) linux | Информация о конфигурации ресурсов Linux. |

#### Возвращаемые значения

\--

#### ExecSync

#### Прототип

```
rpc ExecSync(ExecSyncRequest) returns (ExecSyncResponse) {}
```

#### Описание

Это API для выполнения команды в контейнерах в режиме синхронизации с помощью метода удаленного вызова процедур gRPC.

#### Меры предосторожности

При выполнении команды необходимо отключить режим взаимодействия между терминалом и контейнерами.

#### Параметры

| **Параметр**        | **Описание**                                                 |
| ------------------- | ------------------------------------------------------------ |
| string container_id | Идентификатор контейнера.                                    |
| repeated string cmd | Команда, которую требуется выполнить.                        |
| int64 timeout       | Время ожидания для команды остановки (единица измерения: секунда). Значение по умолчанию равно **0**, что указывает на отсутствие времени ожидания. Данный параметр в настоящее время не действует. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                                                 |
| ------------------------- | ------------------------------------------------------------ |
| bytes stdout              | Стандартный поток вывода для команды сбора данных.           |
| bytes stderr              | Стандартный поток ошибки для команды сбора данных.           |
| int32 exit_code           | Код выхода, который сообщает о завершении выполнения команды. Значение по умолчанию **0** означает, что команда успешно выполнена. |

#### Exec

#### Прототип

```
rpc Exec(ExecRequest) returns (ExecResponse) {}
```

#### Описание

Данный API используется для запуска команд в контейнере методом удаленного вызова процедур gRPC, то есть путем получения URL-адресов от сервера CRI с последующим использованием полученного URL-адреса для установления длинного соединения с сервером WebSocket и реализации, таким образом, взаимодействия с контейнером.

#### Меры предосторожности

При выполнении команды необходимо включить режим взаимодействия между терминалом и контейнерами. Один из параметров — **stdin**, **stdout** или **stderr** — должен иметь значение **true**. Если параметр **tty** имеет значение **true**, значением параметра **stderr** должно быть **false**. Мультиплексирование не поддерживается. В этом случае выводы **stdout** и **stderr** объединяются в поток.

#### Параметры

| **Параметр**        | **Описание**                                                 |
| ------------------- | ------------------------------------------------------------ |
| string container_id | Идентификатор контейнера.                                    |
| repeated string cmd | Команда, которую требуется выполнить.                        |
| bool tty            | Параметр устанавливает запуск команды в TTY.                 |
| bool stdin          | Параметр устанавливает генерацию стандартного потока ввода.  |
| bool stdout         | Параметр устанавливает генерацию стандартного потока вывода. |
| bool stderr         | Параметр устанавливает генерацию стандартного потока ошибки. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                                              |
| ------------------------- | --------------------------------------------------------- |
| string url                | Полностью определенный URL-адрес потокового сервера exec. |

#### Attach

#### Прототип

```
rpc Attach(AttachRequest) returns (AttachResponse) {}
```

#### Описание

Данный API используется для входа в процесс init контейнера методом удаленного вызова процедур gRPC, то есть путем получения URL-адресов от сервера CRI с последующим использованием полученного URL-адреса для установления длинного соединения с сервером WebSocket и реализации, таким образом, взаимодействия с контейнером. Поддерживаются только контейнеры, время выполнения которых имеет тип LCR.

#### Параметры

| **Параметр**        | **Описание**                                                 |
| ------------------- | ------------------------------------------------------------ |
| string container_id | Идентификатор контейнера.                                    |
| bool tty            | Параметр устанавливает запуск команды в TTY.                 |
| bool stdin          | Параметр устанавливает генерацию стандартного потока ввода.  |
| bool stdout         | Параметр устанавливает генерацию стандартного потока вывода. |
| bool stderr         | Параметр устанавливает генерацию стандартного потока ошибки. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                                                |
| ------------------------- | ----------------------------------------------------------- |
| string url                | Полностью определенный URL-адрес потокового сервера attach. |

#### ContainerStats

#### Прототип

```
rpc ContainerStats(ContainerStatsRequest) returns (ContainerStatsResponse) {}
```

#### Описание

Данный API используется для возврата информации о ресурсах, занятых контейнером. Поддерживаются только контейнеры, время выполнения которых имеет тип LCR.

#### Параметры

| **Параметр**        | **Описание**             |
| ------------------- | ------------------------ |
| string container_id | Идентификатор контейнера |

#### Возвращаемые значения

| Возвращаемое значение                                        | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ContainerStats](#apis.md#en-us_topic_0182207110_li556895) stats | Информация о контейнере. Примечание: диски и индексные дескрипторы inode поддерживают только запрос контейнеров, запущенных образами OCI. |

#### ListContainerStats

#### Прототип

```
rpc ListContainerStats(ListContainerStatsRequest) returns (ListContainerStatsResponse) {}
```

#### Описание

Данный API используется для возврата информации о ресурсах, занятых несколькими контейнерами. Поддерживается фильтрация на основе критериев.

#### Параметры

| **Параметр**                                                 | **Описание**         |
| ------------------------------------------------------------ | -------------------- |
| [ContainerStatsFilter](#apis.md#en-us_topic_0182207110_li285981) filter | Критерии фильтрации. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| repeated [ContainerStats](#apis.md#en-us_topic_0182207110_li556895) stats | Список данных контейнера. Примечание: диски и индексные дескрипторы inode поддерживают только запрос контейнеров, запущенных образами OCI. |

#### UpdateRuntimeConfig

#### Прототип

```
rpc UpdateRuntimeConfig(UpdateRuntimeConfigRequest) returns (UpdateRuntimeConfigResponse);
```

#### Описание

Данный API используется в качестве стандартного CRI для обновления pod CIDR сетевого подключаемого модуля. В настоящее время сетевому подключаемому модулю CNI не требуются обновления pod CIDR. Поэтому этот API ведет записи только журналов доступа.

#### Меры предосторожности

Операции API не изменяют управляющую информацию системы, а только записи журнала.

#### Параметры

| **Параметр**                                                 | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [RuntimeConfig](#apis.md#en-us_topic_0182207110_li544075) runtime_config | Информация, которую необходимо сконфигурировать в среде выполнения. |

#### Возвращаемые значения

\--

#### Status

#### Прототип

```
rpc Status(StatusRequest) returns (StatusResponse) {};
```

#### Описание

Это API для получения сетевого статуса среды выполнения и pod. При получении сетевого статуса обновляется конфигурация сети. Поддерживаются только контейнеры, время выполнения которых имеет тип LCR.

#### Меры предосторожности

Ошибка при обновлении конфигурации сети не влияет на исходную конфигурацию. Исходная конфигурация перезаписывается только в случае успешного обновления.

#### Параметры

| **Параметр** | **Описание**                                                 |
| ------------ | ------------------------------------------------------------ |
| bool verbose | Параметр определяет, будет или не будет отображаться дополнительная информация о среде выполнения. Данный параметр в настоящее время не действует. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [RuntimeStatus](#apis.md#en-us_topic_0182207110_li152576) status | Состояние среды выполнения.                                  |
| map<string, string> info                                     | Дополнительная информация о среде выполнения. Ключ **info** может иметь любое значение. Значение должно быть в формате JSON и может содержать любую информацию отладки. Если параметр **verbose** имеет значение **true**, параметр **info** не должен быть пустым. |

### Служба образов

Данная служба предоставляет gRPC API для получения образов из реестра, их просмотра и удаления.

#### ListImages

#### Прототип

```
rpc ListImages(ListImagesRequest) returns (ListImagesResponse) {}
```

#### Описание

Это API для вывода базовой информации об образе.

#### Меры предосторожности

Это унифицированный API. Запрос образов встраиваемых операционных систем осуществляется командой **cri images**. Однако такие образы не являются стандартными образами OCI. Поэтому результаты запроса имеют некоторые ограничения:

- Образ встраиваемой системы не имеет идентификатора. Поэтому значение **image ID** является дайджестом конфигурации образа.
- Образ встраиваемой системы имеет только дайджест конфигурации, и он не соответствует спецификациям образов OCI. Поэтому значение **digest** не отображается.

#### Параметры

| **Параметр**                                                 | **Описание**             |
| ------------------------------------------------------------ | ------------------------ |
| [ImageSpec](#apis.md#en-us_topic_0182207110_li597891) filter | Имя фильтруемого образа. |

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**          |
| ------------------------------------------------------------ | --------------------- |
| repeated [Image](#apis.md#en-us_topic_0182207110_li597891) images | Список данных образа. |

#### ImageStatus

#### Прототип

```
rpc ImageStatus(ImageStatusRequest) returns (ImageStatusResponse) {}
```

#### Описание

Это API для запроса информации о заданном образе.

#### Меры предосторожности

1. Если запрашиваемый образ не существует, возвращается значение **ImageStatusResponse**, а параметр **Image** в возвращаемых данных имеет значение **nil**.
2. Это унифицированный API. Поскольку образы встроенных операционных систем не отвечают спецификациям образов OCI и не содержат требуемых полей, такие образы нельзя запросить с помощью данного интерфейса API.

#### Параметры

| **Параметр**                                                | **Описание**                                                 |
| ----------------------------------------------------------- | ------------------------------------------------------------ |
| [ImageSpec](#apis.md#en-us_topic_0182207110_li597891) image | Имя образа.                                                  |
| bool verbose                                                | Параметр определяет, будет или не будет сделан запрос дополнительной информации. Данный параметр в настоящее время не действует. Дополнительная информация не возвращается. |

#### Возвращаемые значения

| **Возвращаемое значение**                               | **Описание**                                                 |
| ------------------------------------------------------- | ------------------------------------------------------------ |
| [Image](#apis.md#en-us_topic_0182207110_li597891) image | Информация об образе.                                        |
| map<string, string> info                                | Дополнительная информация об образе. Данный параметр в настоящее время не действует. Дополнительная информация не возвращается. |

#### PullImage

#### Прототип

```
 rpc PullImage(PullImageRequest) returns (PullImageResponse) {}
```

#### Описание

Это API для загрузки образов.

#### Меры предосторожности

В настоящее время можно загрузить публичные образы, а также частные образы при условии ввода имени пользователя, пароля и аутентификационных данных. Поля **server\_address**, **identity\_token**,**registry\_token** в **authconfig** не настраиваются.

#### Параметры

| **Параметр**                                                 | **Описание**                                                 |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [ImageSpec](#apis.md#en-us_topic_0182207110_li597891) image  | Имя загружаемого образа.                                     |
| [AuthConfig](#apis.md#en-us_topic_0182207110_li101739) auth  | Проверочная информации для загрузки частного образа.         |
| [PodSandboxConfig](#apis.md#en-us_topic_0182207110_li253629) sandbox_config | Параметр определяет, загружать или не загружать образ в контексте pod. Данный параметр в настоящее время не действует. |

#### Возвращаемые значения

| **Возвращаемое значение** | **Описание**                     |
| ------------------------- | -------------------------------- |
| string image_ref          | Информация о загруженном образе. |

#### RemoveImage

#### Прототип

```
rpc RemoveImage(RemoveImageRequest) returns (RemoveImageResponse) {}
```

#### Описание

Это API для удаления заданных образов.

#### Меры предосторожности

Это унифицированный API. Поскольку образы встроенных операционных систем не отвечают спецификациям образов OCI и не содержат требуемых полей, такие образы нельзя удалить, используя данный интерфейс API и идентификатор образа.

#### Параметры

| **Параметр**                                                | **Описание**                             |
| ----------------------------------------------------------- | ---------------------------------------- |
| [ImageSpec](#apis.md#en-us_topic_0182207110_li597891) image | Имя или идентификатор удаляемого образа. |

#### Возвращаемые значения

\--

#### ImageFsInfo

#### Прототип

```
rpc ImageFsInfo(ImageFsInfoRequest) returns (ImageFsInfoResponse) {}
```

#### Описание

Это API для запроса информации о файловой системе, в которой хранятся образы.

#### Меры предосторожности

Запрашиваемые результаты представляют собой информацию файловой системы, включенную в метаданные образа.

#### Параметры

\--

#### Возвращаемые значения

| **Возвращаемое значение**                                    | **Описание**                                              |
| ------------------------------------------------------------ | --------------------------------------------------------- |
| repeated [FilesystemUsage](#apis.md#en-us_topic_0182207110_li160618) image_filesystems | Информация о файловой системе, в которой хранятся образы. |

### Ограничения

1. Если при создании песочницы указан параметр **log\_directory** в конфигурации **PodSandboxConfig**, то при создании всех контейнеров, принадлежащих созданной песочнице, необходимо указать **log\_path** в конфигурации **ContainerConfig**. В противном случае контейнеры нельзя будет запустить или удалить с помощью CRI.
   
   Фактическое значение **LOGPATH** контейнеров представляет собой значение **log\_directory/log\_path**. Если **log\_path** не указан, параметру **LOGPATH** присваивается значение **log\_directory**.
   
   - Если путь не существует, iSulad создает символическую ссылку, указывающую на фактический путь к журналам контейнера при запуске контейнера. Далее **log\_directory** становится символической ссылкой. Два варианта настройки:
     
     1. В первом варианте: если **log\_path** не указан для остальных контейнеров в песочнице, **log\_directory** удаляется и указывается **log\_path** вновь запущенного контейнера. В результате в журналах первого запущенного контейнера указываются журналы последнего запущенного контейнера.
     2. Во втором варианте: если **log\_path** не указан для остальных контейнеров в песочнице, значением **LOGPATH** контейнера является **log\_directory/log\_path**. Поскольку **log\_directory** представляет собой символическую ссылку, при создании возникнет ошибка, если **log\_directory/log\_path** будет использоваться в качестве символической ссылки для указания фактического пути к журналам контейнеров.
   
   - Если путь существует, iSulad попытается удалить этот путь (нерекурсивный) при запуске контейнера. Если путь является путем к папке, в которой есть содержимое, операция удаления завершится с ошибкой. В результате символическая ссылка не будет создана, контейнер не запустится, и та же ошибка произойдет при удалении контейнера.

2. Если при создании песочницы будет указан параметр **log\_directory** в **PodSandboxConfig**, а параметр **log\_path** будет указан в **ContainerConfig** при создании контейнера, окончательным значением **LOGPATH** будет **log\_directory/log\_path**. iSulad не создает рекурсивным методом **LOGPATH**, поэтому необходимо обязательно убедиться в существовании **dirname(LOGPATH)**, то есть пути к окончательному файлу журнала в папке верхнего уровня.

3. Если при создании песочницы будет указан параметр **log\_directory** в **PodSandboxConfig**, и такое же значение **log\_path** будет указано в **ContainerConfig** при создании нескольких контейнеров, или если контейнеры в разных песочницах указывают на один и тот же путь **LOGPATH**, последний заданный путь к журналам контейнеров перезаписывает предыдущий путь после успешного запуска контейнеров.

4. Если изменяется содержимое образа в удаленном реестре, а исходный образ хранится на локальном хосте, то при вызове API образа CRI Pull для повторной загрузки образа имя и тег исходного образа меняют свое значение на **none**.
   
   Пример:
   
   Локально хранящиеся образы:
   
   ```
   IMAGE                                        TAG                 IMAGE ID            SIZE
   rnd-dockerhub.huawei.com/pproxyisulad/test   latest              99e59f495ffaa       753kB
   ```
   
   После обновления и повторной загрузки обновляется образ **rnd-dockerhub.huawei.com/pproxyisulad/test:latest** в удаленном реестре:
   
   ```
   IMAGE                                        TAG                 IMAGE ID            SIZE
   <none>                                       <none>              99e59f495ffaa       753kB
   rnd-dockerhub.huawei.com/pproxyisulad/test   latest              d8233ab899d41       1.42MB
   ```
   
   Выполните команду **isula images**. Значением **REF** будет **-**.
   
   ```
   REF                                               IMAGE ID               CREATED              SIZE       
   rnd-dockerhub.huawei.com/pproxyisulad/test:latest d8233ab899d41          2019-02-14 19:19:37  1.42MB     
   -                                                 99e59f495ffaa          2016-05-04 02:26:41  753kB
   ```