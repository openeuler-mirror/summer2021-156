# Привилегированный контейнер

- [Привилегированный контейнер](#privileged-container.)
  - [Сценарии](#scenarios)
  - [Ограничения по использованию](#usage-restrictions-1)
  - [Руководство по использованию](#usage-guide)

## Сценарии

По умолчанию iSulad запускает обычные контейнеры, которые подходят для запуска обычных процессов. Однако обычные контейнеры имеют только разрешения, задаваемые по умолчанию в каталоге **/etc/default/isulad/config.json**. Для выполнения привилегированных операций (например, использование устройств в каталоге **/sys**) требуется привилегированный контейнер. Используя эту функцию, пользователь **root** в контейнере получает права **root** на операции на хосте. Без данной функции пользователь **root** в контейнере имеет только права обычного пользователя хоста.

## Ограничения по использованию

Привилегированные контейнеры предоставляют все функции и снимают все ограничения, установленные контроллером группы cgroup устройства. Привилегированный контейнер имеет следующие характеристики:

- secomp не блокирует системные вызовы.

- Каталоги **/sys** и **/proc** имеют разрешение на запись.

- В контейнере можно получить доступ ко всем устройствам хоста.

- Включаются все функциональные возможности системы.

Функциональные возможности обычного контейнера по умолчанию:

| **Функциональная  возможность** | Описание                                                     |
| ------------------------------- | ------------------------------------------------------------ |
| SETPCAP                         | Изменение возможностей процесса.                             |
| MKNOD                           | Возможность использования системного вызова mknod() для создания специальных файлов. |
| AUDIT_WRITE                     | Внесение записей в журналы аудита ядра.                      |
| CHOWN                           | Изменение UID и GID файлов. Подробнее см. chown(2).          |
| NET_RAW                         | Использование сокетов RAW и PACKET и привязка любого IP-адреса к прозрачному прокси (transparent proxy). |
| DAC_OVERRIDE                    | Игноририрование ограничений на файлы, установленных по принципу избирательного управления доступом (Discretionary Access Control (DAC)). |
| FOWNER                          | Игноририрование ограничений, связанных с необходимостью совпадения идентификатора владельца файла с идентификатором пользователя процесса. |
| FSETID                          | Возможность установки битов setuid файлов.                   |
| KILL                            | Возможность посылки сигналов процессам, которые не принадлежат сами себе. |
| SETGID                          | Разрешение на изменение идентификатора группы процессов.     |
| SETUID                          | Разрешение на изменение идентификатора пользователя процесса. |
| NET_BIND_SERVICE                | Привязка к порту, номер которого меньше 1024.                |
| SYS_CHROOT                      | Возможность использования системного вызова chroot().        |
| SETFCAP                         | Возможность передачи возможностей другим процессам и удаления их. |

При включении привилегированного контейнера добавляются следующие функциональные возможности:

| Функциональная возможность | Описание                                                     |
| -------------------------- | ------------------------------------------------------------ |
| SYS_MODULE                 | Загрузка и выгрузка модулей ядра.                            |
| SYS_RAWIO                  | Прямой доступ к **/devport**, **/dev/mem**, **/dev/kmem** и исходным устройствам блочного хранения. |
| SYS_PACCT                  | Возможность проведения аудита процесса BSD.                  |
| SYS_ADMIN                  | Выполнение таких задач управления системой, как загрузка или выгрузка файловых систем и установление квот на ресурсы диска. |
| SYS_NICE                   | Повышение приоритета и установка приоритетов для других процессов. |
| SYS_RESOURCE               | Игнорирование ограничений на ресурсы.                        |
| SYS_TIME                   | Изменение режима синхронизации системы.                      |
| SYS_TTY_CONFIG             | Настройка устройств TTY.                                     |
| AUDIT_CONTROL              | Включение и отключение функций аудита ядра, изменение правил фильтрации в аудите и получение статуса аудита и правил фильтрации. |
| MAC_ADMIN                  | Переопределение механизма обязательного контроля доступа (MAC), который реализуется для модуля Smack Linux Security Module (LSM). |
| MAC_OVERRIDE               | Возможность изменения статуса или конфигурации, которые реализуются для Smack LSM. |
| NET_ADMIN                  | Выполнение задач управления сетью.                           |
| SYSLOG                     | Выполнение привилегированной операции syslog(2).             |
| DAC_READ_SEARCH            | Игнорирование ограничений на доступ DAC во время чтения файлов и поиска каталогов. |
| LINUX_IMMUTABLE            | Возможность изменения атрибутов IMMUTABLE и APPEND файла.    |
| NET_BROADCAST              | Сетевые режимы широковещания и многоадресной передачи.       |
| IPC_LOCK                   | Блокировка общих сегментов памяти.                           |
| IPC_OWNER                  | Игнорирование проверки владельца IPC.                        |
| SYS_PTRACE                 | Возможность отслеживать любой процесс.                       |
| SYS_BOOT                   | Перезагрузка ОС.                                             |
| LEASE                      | Изменение флага FL_LEASE блокировки файлов.                  |
| WAKE_ALARM                 | Инициация функции активации системы, например установкой таймеров CLOCK_REALTIME_ALARM и CLOCK_BOOTTIME_ALARM. |
| BLOCK_SUSPEND              | Блокировка процесса приостановки системы.                    |

## Инструкция по использованию

Привилегированный режим для контейнеров включается выполнением в iSulad команды 
**--privileged**. Не добавляйте привилегии контейнерам без необходимости. Для снижения рисков безопасности соблюдайте принцип минимальных привилегий.

```
isula run --rm -it --privileged busybox
```