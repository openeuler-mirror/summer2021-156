# Настраиваемый путь к Cgroup

- [Настраиваемый путь к Cgroup](#configurable-cgroup-path)

## Описание функционала

Системные контейнеры предоставляют функции изоляции и резервирования контейнерных ресурсов на хостах. Параметром **--cgroup-parent** можно изменить каталог cgroup, используемый контейнером, с целью гибкого распределения ресурсов хоста. Например, если для контейнеров A, B и C установлен родительский путь к каталогу cgroup **/lxc/cgroup1**, а для контейнеров D, E и F — **/lxc/cgroup2**, контейнеры делятся на две группы по каталогам cgroup и, таким образом, ресурсы изолируются на уровне cgroup.

## Описание параметров

| **Команда**      | **Параметр**    | **Описание значений**                                        |
| ---------------- | --------------- | ------------------------------------------------------------ |
| isula create/run | --cgroup-parent | ·     Переменная строкового типа.  <br />·     Задает родительский путь к группе cgroup контейнера. |

Помимо командной настройки родительского пути к каталогу cgroup для одного системного контейнера можно также указать пути к cgroup для всех контейнеров, изменив конфигурационные файлы запуска контейнерного движка iSulad.

| **Путь к конфигурационному файлу** | **Параметр**    | **Описание**                                                 |
| ---------------------------------- | --------------- | ------------------------------------------------------------ |
| /etc/isulad/daemon.json            | --cgroup-parent | ·      Переменная строкового типа. <br /> ·     Задает родительский путь по умолчанию к группе cgroup контейнера. <br /> ·      Пример. **"cgroup-parent": "/lxc/mycgroup"** |



## Ограничения

- Если параметр **cgroup parent** установлен как на демоне, так и на клиенте, действительным будет значение, указанное на клиенте.
- Если контейнер A запускается перед контейнером B, в качестве родительского пути к cgroup контейнера B устанавливается путь к cgroup контейнера A. При удалении контейнера необходимо удалить контейнер B, а затем контейнер A. В противном случае могут остаться некоторые ресурсы cgroup.

## Пример

Запустите системный контейнер и укажите параметр **--cgroup-parent**.

```
[root@localhost ~]# isula run -tid --cgroup-parent /lxc/cgroup123 --system-container --external-rootfs /root/myrootfs none init
115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
```

Проверьте информацию о cgroup процесса init в контейнере.

```
[root@localhost ~]# isula inspect -f "{{json .State.Pid}}" 11
22167
[root@localhost ~]# cat /proc/22167/cgroup
13:blkio:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
12:perf_event:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
11:cpuset:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
10:pids:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
9:rdma:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
8:devices:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
7:hugetlb:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
6:memory:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
5:net_cls,net_prio:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
4:cpu,cpuacct:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
3:files:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
2:freezer:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
1:name=systemd:/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e/init.scope
0::/lxc/cgroup123/115878a4dfc7c5b8c62ef8a4b44f216485422be9a28f447a4b9ecac4609f332e
```

В данном примере настроен родительский путь к cgroup контейнера **/sys/fs/cgroup/**_\<контроллер>_**/lxc/cgroup123**.

Кроме того, можно установить родительские пути к cgroup для всех контейнеров настройкой файла демона контейнера. Пример:

```
{
         "cgroup-parent": "/lxc/cgroup123",
}
```

Перезапустите движок контейнера, чтобы настройки вступили в силу.