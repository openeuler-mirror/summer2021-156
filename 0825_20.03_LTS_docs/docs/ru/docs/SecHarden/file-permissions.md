## Разрешения на работу с файлами

- [Разрешения на работу с файлами](#file-permissions)
  - [Настройка владельцев файлов и разрешений на доступ к файлам](#setting-the-permissions-on-and-ownership-of-files)
  - [Удаление файлов, не имеющих владельцев](#deleting-unowned-files)
  - [Удаление символической ссылки на /dev/null](#removing-a-symbolic-link-to-dev-null)
  - [Установка значения umask для демона](#setting-the-umask-value-for-a-daemon)
  - [Добавление дополнительного атрибута sticky bit в каталоги с глобальным разрешением на запись](#adding-a-sticky-bit-attribute-to-globally-writable-directories)
  - [Отключение глобального разрешения на запись для неавторизованных файлов](#disabling-the-globally-writable-permission-on-unauthorized-files)
  - [Ограничение прав на команду **at**](#restricting-permissions-on-the-at-command)
  - [Ограничение прав на команду **cron**](#restricting-permissions-on-the-cron-command)
  - [Ограничение прав на команду](#restricting-permissions-on-the-cron-command)[ **sudo**](#restricting-permissions-on-the-sudo-command)

## Настройка владельцев файлов и разрешений на доступ к файлам

### Описание

В операционной системе Linux все объекты обрабатываются как файлы. Даже любой каталог представляется в виде большого файла, содержащего множество других файлов. Поэтому самым важным вопросом в ОС Linux является безопасность файлов и каталогов. Безопасность достигается путем установки разрешений и владельцев.

В операционной системе openEuler по умолчанию установлены владельцы и разрешения на доступ к обычным каталогам, исполняемым файлам и конфигурационным файлам.

### Реализация

Далее описывается порядок изменения владельца файла и разрешения на доступ к нему на примере каталога **/bin**:

- Изменение разрешения на доступ к файлу. Например, установите разрешению на работу с каталогом **/bin** значение **755**.
  
  ```
  chmod 755 /bin
  ```

- Изменение владельца файла. Например, установите для владельца и группы каталога **/bin** значение **root:root**.
  
  ```
  chown root:root /bin
  ```

## Удаление файлов, не имеющих владельцев

### Описание

При удалении пользователя или группы системный администратор может забыть удалить файлы данного пользователя или данной группы. Если имя нового пользователя или группы совпадает с именем удаленного пользователя или группы, новый пользователь или группа будет владеть файлами, на которые у него нет разрешений. Поэтому рекомендуется удалить эти файлы.

### Реализация

Удалите файл, идентификатор пользователя которого не существует.

1. Найдите файл, идентификатор пользователя которого не существует.
   
   ```
   find / -nouser
   ```

2. Удалите найденный файл. В приведенной выше команде *filename* означает имя файла, идентификатор пользователя которого не существует.
   
   ```
   rm -f filename
   ```

Удалите файл, идентификатор группы которого не существует.

1. Найдите файл, идентификатор пользователя которого не существует.
   
   ```
   find / -nogroup
   ```

2. Удалите найденный файл. В приведенной выше команде *filename* означает имя файла, идентификатор пользователя которого не существует.
   
   ```
   rm -f filename
   ```

## Удаление символической ссылки на /dev/null

### Описание

Символической ссылкой на **/dev/null** могут воспользоваться злоумышленные пользователи. Это отражается на безопасности системы. Для повышения безопасности рекомендуется удалить эти символические ссылки.

### Особый сценарий

После установки ОС openEuler могут остаться символические ссылки на **/dev/null**. Эти ссылки могут выполнять соответствующие функции. (Некоторые ссылки конфигурируются заранее и могут зависеть от других компонентов.) Устраните эту проблему в соответствии с условиями площадки. Подробнее см. раздел [Реализация](#en-us_topic_0152100319_s1b24647cdd834a8eaca3032611baf072).

Например, openEuler поддерживает режим установки UEFI и традиционный режим BIOS. Пакеты GRUB, поддерживаемые обоими режимами загрузки, устанавливаются по умолчанию. При выборе традиционного режима установки BIOS генерируется символическая ссылка **/etc/grub2-efi.cfg**. При выборе режима установки UEFI генерируется символическое ссылка **/etc/grub2.cfg**. С данными ссылками необходимо работать в соответствии с условиями площадки.

### Реализация

1. Выполните следующую команду поиска символических ссылок на **/dev/null**:
   
   ```
   find dirname -type l -follow 2>/dev/null
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
*dir\_\_name* означает каталог, который требуется найти. Обычно поиска требуют такие ключевые системные каталоги, как **/bin**, **/boot**, **/usr**, **/lib64**, **/lib** и **/var**.

2. Если эти символические ссылки бесполезны, удалите их, выполнив следующую команду:
   
   ```
   rm -f filename
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
*filename* означает имя файла, полученное на [шаге 1](#en-us_topic_0152100319_l4dc74664c4fb400aaf91fb314c4f9da6).

## Установка значения umask для демона

### Описание

Значение **umask** используется для установки разрешений по умолчанию на работу с файлами и каталогами. Если значение **umask** не указано, файл имеет глобальное разрешение на запись. Это несет в себе риск. Демон представляет собой службу для получения запросов пользователей или запросов клиентов в сети. Чтобы повысить безопасность файлов и каталогов, созданных демоном, рекомендуется установить параметру **umask** значение **0027**. Данное значение служит дополнением к значению разрешения. Подробнее о том, как преобразовать значение **umask** в значение разрешения см. в разделе [Значения umask](#umask-values.md).

> ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
По умолчанию в ОС openEuler параметр **umask** демона имеет значение **0022**.

### Реализация

В конфигурационном файле **/etc/sysconfig/init** добавьте **umask 0027** в виде новой строки.

## Добавление дополнительного атрибута sticky bit в каталоги с глобальным разрешением на запись

### Описание

Любой пользователь может удалить или изменить файл или каталог в каталоге с глобальным разрешением на запись, в том числе, не имея на это разрешения. Поэтому для таких каталогов требуется дополнительный атрибут защиты, называемый sticky bit.

### Реализация

1. Найдите каталоги с глобальным разрешением на запись.
   
   ```
   find / -type d -perm -0002 ! -perm -1000 -ls | grep -v proc
   ```

2. Добавьте к ним атрибут sticky bit.  *dirname* — это имя найденного каталога.
   
   ```
   chmod +t dirname
   ```

## Отключение глобального разрешения на запись для неавторизованных файлов

### Описание

Любой пользователь может изменять файлы, имеющие глобальное разрешение на запись, что отражается на сохранности данных системы.

### Реализация

1. Найдите файлы с глобальным разрешением на запись.
   
   ```
   find / -type d \( -perm -o+w \) | grep -v procfind / -type f \( -perm -o+w \) | grep -v proc
   ```

2. Проверьте настройки файлов (за исключением файлов и каталогов с атрибутом sticky bit), перечисленные на шаге 1, и удалите эти файлы или отключите глобальное разрешение на запись. Выполните следующую команду, чтобы отменить данное разрешение. В команде *filename* означает имя файла.
   
     
   
   ```
   chmod o-w  filename
   ```
   
   > ![](./public_sys-resources/icon-note.gif) ПРИМЕЧАНИЕ:  
Чтобы проверить, установлен или нет атрибут sticky bit для файла или каталога, выполните следующую команду. Если командный вывод содержит флаг **T**, файл или каталог имеет данный атрибут. В приведенной команде *filename* означает имя запрашиваемого файла или каталога.
   > 
   > ```
   > ls -l filename  
   > ```

## Ограничение прав на команду **at**

### Описание

Команда **at** используется для создания запланированной задачи. Для защиты системы от атак злоумышленников пользователи, которые могут выполнять команду **at**, должны быть прописаны.

### Реализация

1. Удалите файл **/etc/at.deny**.
   
   ```
   rm -f /etc/at.deny
   ```

2. Выполните следующую команду, чтобы изменить владельца файла **/etc/at.allow** на **root:root**.
   
   ```
   chown root:root /etc/at.allow
   ```

3. Пропишите, что только пользователь **root** может выполнять операции с файлом **/etc/at.allow**.
   
   ```
   chmod og-rwx /etc/at.allow
   ```

## Ограничение прав на команду **cron**

### Описание

Команда **cron** используется для создания повседневной задачи. Для защиты системы от атак злоумышленников пользователи, которые могут выполнять команду **cron**, должны быть прописаны.

### Реализация

1. Удалите файл **/etc/cron.deny**.
   
   ```
   rm -f /etc/at.deny
   ```

2. Выполните следующую команду, чтобы изменить владельца файла **/etc/cron.allow** на **root:root**:
   
   ```
   chown root:root /etc/cron.allow
   ```

3. Пропишите, что только пользователь **root** может выполнять операции с файлом **/etc/cron.allow**.
   
   ```
   chmod og-rwx /etc/cron.allow
   ```

## Ограничение прав на команду **sudo**

### Описание

Обычный пользователь может использовать команду **sudo** для выполнения команд как пользователь с правами **root**. Чтобы повысить безопасность системы, необходимо ограничить разрешения на использование команды **sudo**. В этом случае команда **sudo** настраивается на использование только пользователем с правами **root**. По умолчанию в ОС openEuler не установлено ограничение на выполнение команды **sudo** другими пользователями, не имеющими прав **root**.

### Реализация

Измените файл **/etc/sudoers**, чтобы ограничить разрешения на команду **sudo**. Прокомментируйте следующую строку конфигурации:

```
#%wheel ALL=(ALL)       ALL
```