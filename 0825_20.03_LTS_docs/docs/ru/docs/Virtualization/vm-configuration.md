# Конфигурирование виртуальной машины

- [Конфигурирование виртуальной машины](#vm-configuration)
  - [Введение](#introduction)
  - [Описание виртуальной машины](#vm-description)
  - [Виртуальный процессор и виртуальная память](#vcpu-and-virtual-memory)
  - [Настройка виртуального устройства](#virtual-device-configuration)
    - [Устройства хранения](#storage-devices)
    - [Сетевое устройство](#network-device)
    - [Настройка шины](#bus-configuration)
    - [Другие стандартные устройства](#other-common-devices)
  - [Настройки, связанные с архитектурой системы](#configurations-related-to-the-system-architecture)
  - [Другие стандартные элементы конфигурации](#other-common-configuration-items)
  - [Пример конфигурационного файла XML](#xml-configuration-file-example)

## Введение

### Обзор

Характеристики виртуальной машины, в том числе ее имя, процессор, память, диск, карта NIC, мышь и клавиатура, вносятся в XML-файлы с помощью инструмента Libvirt. Управлять виртуальной машиной можно путем изменения конфигурационного файла. В этом разделе описываются элементы конфигурационного файла XML. Данное описание поможет пользователям настраивать виртуальные машины.

### Формат

В конфигурационном файле XML виртуальной машины в качестве корневого элемента используется домен, который содержит ряд других элементов. Некоторые элементы в таком файле могут содержать соответствующие атрибуты и их значения, которые несут в себе подробное описание виртуальной машины. Разные атрибуты одного и того же элемента разделяются пробелами.

Основной формат конфигурационного файла XML: **label** означает имя метки, **attribute** означает атрибут, а **value** — это значение атрибута. Измените их в соответствии с требованиями площадки.

```
<domain type='kvm'>
    <name>VMName</name>
    <memory attribute='value'>8</memory>
    <vcpu>4</vcpu>
    <os>
       <label attribute='value' attribute='value'>
         ...
       </label>
    </os>
    <label attribute='value' attribute='value'>
      ...
    </label>  
</domain>
```

### Процедура

1. Создайте конфигурационный файл XML с корневым элементом домена.

2. Используя тег имени, укажите уникальное имя виртуальной машины на основе правила присвоения имен.

3. Настройте такие системные ресурсы, как виртуальный процессор (vCPU) и виртуальная память.

4. Настройте виртуальные устройства.
   
   1. Настройте устройства хранения.
   2. Настройте сетевые устройства.
   3. Настройте структуру внешней шины.
   4. Настройте внешние устройства, например мышь.

5. Сохраните конфигурационный XML-файл.

## Описание виртуальной машины

### Обзор

В этом разделе описывается процедура настройки корневого элемента **domain** и имени виртуальной машины.

### Элементы

- **domain**: корневой элемент конфигурационного файла XML виртуальной машины, который используется для настройки типа гипервизора, запускающего данную ВМ.
  
  **type**: тип домена в системе виртуализации. В системе виртуализации openEuler значение данного атрибута — **kvm**.

- **name**: имя виртуальной машины
  
  Имя виртуальной машины является строкой уникальных символов на одном хосте. Имя виртуальной машины может содержать только цифры, буквы, знаки подчеркивания (\_), дефисы (-) и двоеточия (:) и не может состоять только из цифр. Имя виртуальной машины может включать максимум 64 символа.

### Пример настройки

Например, если имя ВМ — **openEuler**, выполните следующие настройки:

```
<domain type='kvm'>
    <name>openEuler</name>
    ...
</domain>
```

## Виртуальный процессор и виртуальная память

### Обзор

В этом разделе описывается процедура настройки виртуального процессора (vCPU) и виртуальной памяти.

### Элементы

- **vcpu**: количество виртуальных процессоров.

- **memory**: размер виртуальной памяти.
  
  **unit**: единица измерения размера памяти. Значением может быть КиБ (2<sup>10</sup> байт), МиБ (2<sup>20</sup> байт), ГиБ (2<sup>30</sup> байт) или ТиБ (2<sup>40</sup> байт).

- **cpu**: режим виртуального процессора.
  
  **mode**: режим виртуального процессора.
  
  - **host-passthrough**: параметр указывает на то, что архитектура и характеристики виртуального процессора такие же, что и у хоста.
  
  Подэлемент **topology**: это подэлемент элемента **cpu**, который используется для описания топологической структуры режима vCPU.
  
  - Атрибуты **socket**, **cores**, **threads** топологии подэлемента описывают соответственно количество сокетов процессора в виртуальной машине, количество ядер процессора, включенных в каждый сокет процессора, и количество потоков, входящих в каждое ядро процессора. Значением атрибута является положительное целое число, а произведение трех значений равно количеству vCPU.


### Пример настройки

Например, если количество vCPU равно 4, используется режим обработки host-passthrough, виртуальная память — 8 ГиБ, четыре процессора занимают два сокета CPU, и функция гиперпоточности не поддерживается, конфигурация будет следующей:

```
<domain type='kvm'>
    ...
    <vcpu>4</vcpu>
    <memory unit='GiB'>8</memory>
    <cpu mode='host-passthrough'>
        <topology sockets='2' cores='2' threads='1'/>
    </cpu>
    ...
</domain>
```

## Настройка виртуального устройства

Для настройки виртуальных устройств, в том числе устройств хранения, сетевых устройств, шин и мыши, в конфигурационном файле XML виртуальной машины используются элементы **devices**. В этом разделе описывается процедура настройки стандартных виртуальных устройств.

### Устройства хранения

#### Обзор

В этом разделе описывается процедура настройки таких виртуальных устройств хранения, как накопители на гибких дисках, диски и CD-ROM, а также приведены типы устройств хранения.

#### Элементы

Для настройки устройств хранения в конфигурационном файле XML используется элемент **disk**. В [Табл. 1](#table14200183410353) приведены общие атрибуты элемента **disk**. В [Табл. 2](#table4866134925114) приведены общие подэлементы и их атрибуты.

**Табл. 1** Общие атрибуты элемента **disk**

| **Элемент** | **Атрибут** | **Описание**                                                 | **Значение и описание атрибута**                             |
| ----------- | ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| **disk**    | **type**    | Тип внутреннего устройства хранения.                         | **block**: блочное устройство хранения **file**: файловое устройство хранения **dir**: путь к каталогу |
|             | **device**  | Устройство хранения, которое должно быть предоставлено виртуальной машине. | **disk**: диск (по умолчанию)  <br />**floppy**: накопитель на магнитных дисках  <br />**cdrom**: CD-ROM |

**Табл. 2** Общие подэлементы и атрибуты элемента disk

| **Подэлемент** | **Описание подэлемента**                                     | **Описание атрибута**                                        |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| source         | Внутреннее устройство хранения, которое соответствует атрибуту **type** элемента **disk**. | **file**: файловое устройство хранения. Значение представляет собой полностью определенный путь к соответствующему файлу. <br />**dev**: блочное устройство хранения. Значение представляет собой полностью определенный путь к соответствующему устройству хоста. <br />**dir**: тип каталога. Значение представляет собой полностью определенный путь к дисковому каталогу. |
| driver         | Подробная информация об указанном внутреннем драйвере.       | **type**: тип формата диска. Значение — **raw** или **qcow2** — должно совпадать с исходным типом. <br />**io**: режим ввода-вывода диска. Значения: **native** и **threads**. <br />**cache**: режим кэширования диска. Значения: **none**, **writethrough**, **writeback**, **directsync**. <br />**iothread**: поток ввода-вывода, выделенный диску. |
| target         | Шина и устройство, которые диск предоставляет виртуальной машине. | **dev**: имя логического устройства диска, например, **sd[a-p]** для дисков SCSI, SATA и шин USB; **hd[a-d]** для диска IDE. <br />**bus**: тип диска. Стандартные типы дисков: scsi, usb, sata, virtio. |
| boot           | Диск может использоваться в качестве загрузочного диска.     | **order**: задает последовательность запуска диска.          |
| readonly       | Диск — только для чтения, и его не может изменить виртуальная машина. Как правило, он используется вместе с диском CD-ROM. | -                                                            |

#### Пример настройки

Подготовив образ виртуальной машины в соответствии с инструкциями раздела [Подготовка образа виртуальной машины](#preparing-a-vm-image), настройте виртуальный диск данной ВМ, используя следующий конфигурационный файл XML.

В этом примере для виртуальной машины сконфигурированы два потока ввода-вывода, один диск блочного хранения и один CD-диск, а первый поток ввода-вывода выделен диску блочного хранения. Внутренний носитель дискового устройства имеет формат qcow2 и используется в качестве приоритетного загрузочного диска.

```
<domain type='kvm'>
    ...
    <iothreads>2</iothreads>
    <devices>
        <disk type='file' device='disk'>
	    <driver name='qemu' type='qcow2' cache='none' io='native' iothread="1"/>
	    <source file='/mnt/openEuler-image.qcow2'/>
	    <target dev='vda' bus='virtio'/>
	    <boot order='1'/>
	</disk>
	<disk type='file' device='cdrom'>
	    <driver name='qemu' type='raw' cache='none' io='native'/>
	    <source file='/mnt/openEuler-20.03-LTS-aarch64-dvd.iso'/>
	    <target dev='sdb' bus='scsi'/>
	    <readonly/>
	    <boot order='2'/>
	</disk>
         ...
    </devices>
</domain>
```

### Сетевое устройство

#### Обзор

С помощью конфигурационного файла XML можно настраивать также виртуальные сетевые устройства, в том числе режим Ethernet, режим моста и режим vhostuser. В данном разделе описан метод настройки виртуальных карт vNIC.

#### Элементы

В конфигурационном файле конфигурации XML используется элемент **interface**, атрибут **type** которого задает режим vNIC. Доступны режимы **ethernet**, **bridge**, **vhostuser**. Ниже приводится описание подэлементов и атрибутов vNIC на примере использования режим моста (bridge).

**Табл. 1** Общие подэлементы vNIC в режиме моста

| **Подэлемент** | **Описание подэлемента**                             | **Описание атрибута**                                        |
| -------------- | ---------------------------------------------------- | ------------------------------------------------------------ |
| mac            | МАС-адрес виртуальной карты vNIC.                    | **address**: МАС-адрес. Если этот параметр не установлен, система автоматически генерирует МАС-адрес. |
| target         | Имя внутренней карты vNIC.                           | **dev**: имя создаваемого внутреннего устройства TAP.        |
| source         | Внутренняя карта vNIC.                               | **bridge**: используется вместе с режимом моста. Значение — **bridge name**. |
| boot           | Карту NIC можно использовать для удаленного запуска. | **order**: задает последовательность запуска карт NIC.       |
| model          | Тип карты vNIC.                                      | **type**: для карты NIC в режиме моста обычно используется **virtio**. |
| virtualport    | Тип порта                                            | **type**: Если используется мост OVS, установите этому параметру значение **openvswitch**. |
| driver         | Тип внутреннего драйвера                             | **name**: имя драйвера. Значение — **vhost**. <br />**queues**: количество очередей NIC. |

#### Пример настройки

- Создав мост Linux br0 в соответствии с инструкциями раздела [Подготовка сети виртуальной машины,](#preparing-the-vm-network) настройте устройство vNIC с типом VirtIO, подключенное с помощью моста br0. Конфигурация XML-файла будет следующей:
  
  ```
  <domain type='kvm'>
      ...
      <devices>
          <interface type='bridge'>
  	    <source bridge='br0'/>
              <model type='virtio'/>
  	</interface>
          ...
      </devices>
  </domain>
  ```

- Если создается сетевой мост OVS в соответствии с инструкциями раздела [Подготовка сети виртуальной машины](#preparing-the-vm-network), настройте устройство vNIC с типом VirtIO, которое использует драйвер vhost и имеет четыре очереди.
  
  ```
  <domain type='kvm'>
      ...
      <devices>
          <interface type='bridge'>
  	    <source bridge='br0'/>
              <virtualport type='openvswitch'/> 
              <model type='virtio'/>
              <driver name='vhost' queues='4'/> 
  	</interface>
          ...
      </devices>
  </domain>
  ```

### Настройка шины

#### Обзор

Шина представляет собой канал информационной связи между компонентами компьютера. Любое внешнее устройство необходимо подключить к соответствующей шине, и каждому устройству присваивается уникальный адрес (определенный подэлементом **address**). Обмен информацией с другим устройством или центральным процессором (CPU) выполняется через сеть шины. Стандартные шины устройств: ISA, PCI, USB, SCSI и PCIe.

Шина PCIe обладает стандартной древовидной структурой и хорошей масштабируемостью. Шины связаны друг с другом с помощью контроллера. Далее приводится метод настройки топологии шины для виртуальной машины на примере шины PCIe.

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
Настройка шины процесс сложный. Если топология устройства не требует высокоточного контроля, можно использовать конфигурацию шины по умолчанию, которую автоматически генерирует инструмент libvirt.

#### Элементы

В конфигурации XML инструмента libvirt каждый элемент контроллера (**controller**) представляет одну шину, и, в зависимости от архитектуры виртуальной машины, к одному контроллеру можно подключить (смонтировать) один и более контроллеров или устройств. В данном разделе описываются стандартные атрибуты и подэлементы.

**controller**: элемент контроллера, который задает шину.

- Атрибут **type**: тип шины. Данный атрибут является обязательным для контроллера. Стандартные типы шин: **pci**, **usb**, **scsi**, **virtio-serial**, **fdc**, **ccid**.

- Атрибут **index**: номер шины контроллера (начиная с 0). Данный атрибут является обязательным для контроллера. Этот атрибут можно использовать в элементе **address**.

- Атрибут **model**: конкретная модель контроллера. Данный атрибут является обязательным для контроллера. Доступные значения зависят от значения атрибута **type**. Подробная информация о соответствии между значениями атрибутов приведена в [Табл. 4](#table191911761111).

- Подэлемент **address**: место подключения устройства или контроллера в сети шины.
  
  - Атрибут **type**: тип адреса устройства. Стандартные типы: **pci**, **usb**, **drive**. Данный атрибут зависит от атрибута **type** подэлемента **address**. Подробная информация о соответствии между значениями атрибутов **type** и **address** приведена в [Табл. ](#table191911761111)[2](#table1200165711314).

- Подэлемент **model**: имя модели контроллера.
  
  - Атрибут **name**: имя модели контроллера, которое соответствует атрибуту **model** в контроллере родительского элемента.

**Табл. 1** Соответствие между стандартными значениями атрибутов **type** и **model** контроллера

| **Значение  типа** | Значение модели    | Описание                                                     |
| ------------------ | ------------------ | ------------------------------------------------------------ |
| pci                | pcie-root          | Корневой узел PCIe, который может использоваться для монтирования устройств PCIe или контроллеров. |
|                    | pcie-root-port     | Только один слот может использоваться для монтирования устройства PCIe или контроллера. |
|                    | pcie-to-pci-bridge | Контроллер моста PCIe-PCI, который может использоваться для монтирования устройств PCI. |
| usb                | ehci               | Контроллер USB 2.0, который может использоваться для монтирования устройств USB 2.0. |
|                    | nec-xhci           | Контроллер USB 3.0, который может использоваться для монтирования устройств USB 3.0. |
| scsi               | virtio-scsi        | Контроллер VirtIO SCSI, который может использоваться для монтирования блочных устройств хранения, таких как диски и CD-ROM. |
| virtio-serial      | virtio-serial      | Контроллер последовательного порта VirtIO, который может использоваться для монтирования устройств последовательного порта, например pty. |

**Табл. 2** Атрибуты элемента **address** в различных устройствах

| **Значение типа** | Описание                                                     | **Адрес**                                                    |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| pci               | Типом **address** является PCI-адрес, указывающий место подключения устройства в сети шины PCI. | **domain:** идентификатор домена устройства PCI. <br />**bus:** номер шины устройства PCI. <br />**slot:** номер устройства PCI. <br />**function:** номер функции устройства PCI. **multifunction**: (необязательный параметр) включение опции многофункциональности. |
| usb               | Типом **address** является USB-адрес, указывающий место устройства на шине USB. | **bus:** номер шины устройства USB. <br />**port:** номер порта устройства USB. |
| drive             | Типом **address** является адрес устройства хранения, указывающий на владеющий диском контроллер и его позицию на шине. | **controller**: номер владеющего контроллера. <br />**bus:** номер канала для вывода устройства. <br />**target:** номер целевого объекта устройства хранения. <br />**unit:** номер LUN устройства хранения. |

#### Пример настройки

В данном примере показана настройка топологии шины PCIe. Три контроллера PCIe-Root-Port монтируются на корневом узле PCIe (BUS 0). Для первого контроллера PCIe-Root-Port (BUS 1) включена многофункциональная характеристика. Контроллер PCIe-to-PCI-bridge монтируется на первом контроллере PCIe-Root-Port для формирования шины PCI (BUS 3). На шине PCI монтируется устройство virtio-serial и контроллер USB 2.0. Контроллер SCSI монтируется на втором контроллере PCIe-Root-Port (BUS 2). Для третьего контроллера PCIe-Root-Port (BUS 0) ни одного устройства не смонтировано. Подробная конфигурация:

```
<domain type='kvm'>
    ...
    <devices>
        <controller type='pci' index='0' model='pcie-root'/>
	<controller type='pci' index='1' model='pcie-root-port'>
	    <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x0' multifunction='on'/>
	</controller>
	<controller type='pci' index='2' model='pcie-root-port'>
	    <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x1'/>
	</controller>
	<controller type='pci' index='3' model='pcie-to-pci-bridge'>
	    <model name='pcie-pci-bridge'/>
	    <address type='pci' domain='0x0000' bus='0x01' slot='0x00' function='0x0'/>
	</controller>
	<controller type='pci' index='4' model='pcie-root-port'>
	    <address type='pci' domain='0x0000' bus='0x00' slot='0x01' function='0x2'/>
	</controller>
	<controller type='scsi' index='0' model='virtio-scsi'>
	    <address type='pci' domain='0x0000' bus='0x02' slot='0x00' function='0x0'/>
	</controller>
	<controller type='virtio-serial' index='0'>
	    <address type='pci' domain='0x0000' bus='0x03' slot='0x02' function='0x0'/>
	</controller>
	<controller type='usb' index='0' model='ehci'>
	    <address type='pci' domain='0x0000' bus='0x03' slot='0x01' function='0x0'/>
	</controller>
	...
	</devices>
</domain>
```

### Другие стандартные устройства

#### Обзор

Помимо устройств хранения данных и сетевых устройств в конфигурационном файле XML необходимо указать ряд внешних устройств. В данном разделе описан метод настройки данных элементов.

#### Элементы

- **serial**: устройство последовательного порта.
  
  Атрибут **type**: тип последовательного порта. Стандартные значения атрибута: **pty**, **tcp**, **pipe**, **file**.

- **video**: медиаустройство.
  
  Атрибут **type**: тип медиаустройства. Стандартное значение атрибута для архитектуры AArch — **virtio**, для архитектуры x86\_64 — **vga** или **cirrus**.
  
  Подэлемент **model**: это подэлемент элемента **video**, который используется для задания типа медиаустройства.
  
  Если значением атрибута **type** является **vga**, то в подэлементе **model** конфигурируется видеокарта Video Graphics Array (VGA). **vram** указывает размер RAM видеокарты, по умолчанию в КБ.
  
  Например, если для виртуальной машины x86\_64 сконфигурирована видеокарта VGA емкостью 16 МБ, конфигурация в файле XML будет следующей. В данном примере значение **vram** представляет собой размер RAM видеокарты, по умолчанию в КБ.
  
  ```
  <video>
      <model type='vga' vram='16384' heads='1' primary='yes'/>
  </video>
  ```

- **input**: выходное устройство.
  
  Атрибут **type**: тип выходного устройства. Стандартные значения атрибута **tabe** — планшет и **keyboard** — клавиатура.
  
  **bus**: шина, которую необходимо смонтировать. Стандартное значение атрибута — **USB**.

- **emulator**: путь применения эмулятора.

- **graphics**: графическое устройство.
  
  Атрибут **type**: тип графического устройства. Стандартное значение атрибута — **vnc**.
  
  Атрибут **listen**: задает IP-адрес, который должен прослушиваться.

#### Пример настройки

В следующем примере сконфигурированы путь эмулятора виртуальной машины, последовательный порт pty, медиаустройство VirtIO, планшет с USB, клавиатура с USB и графическое устройство VNC.

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
Если атрибуту **type** элемента **graphics** задано значение VNC, рекомендуется установить атрибут **passwd**, то есть пароль для входа в виртуальную машину с помощью VNC.

```
<domain type='kvm'>
    ...
    <devices>
        <emulator>/usr/libexec/qemu-kvm</emulator>
        <console type='pty'/>
        <video>
            <model type='virtio'/>
        </video>
        <input type='tablet' bus='usb'/>
        <input type='keyboard' bus='usb'/>
        <graphics type='vnc' listen='0.0.0.0' passwd='n8VfjbFK'/>
	...
	</devices>
</domain>
```

## Настройки, связанные с архитектурой системы

### Обзор

В конфигурационный файл XML включаются настройки, связанные с архитектурой системы, в том числе конфигурация материнской платы, процессора и некоторые функции, связанные с архитектурой. В этом разделе описываются данные конфигурации.

### Элементы

- **os**: определяет параметры запуска виртуальной машины.
  
  Подэлемент **type**: тип виртуальной машины. Атрибут **arch** указывает тип архитектуры, например AArch64. Атрибут **machine** задает тип набора микросхем виртуальной машины. Запрос поддерживаемого типа набора микросхем выполняется с помощью команды **qemu-kvm -machine ?**. Например, архитектура AArch64 поддерживает тип **virt**.
  
  Подэлемент **loader**: указывает встроенное программное обеспечение, которое необходимо загрузить, например файл UEFI, предоставляемый EDK. Атрибут **readonly** задает разрешение на доступ к файлу — только для чтения. Значением может быть **yes** или **no**. Атрибут **type** задает тип подэлемента **loader**. стандартные значения **rom** и **pflash**.
  
  Подэлемент **nvram**: указывает путь к файлу **nvram**, который используется для хранения конфигурации запуска UEFI.

- **features**: гипервизор контролирует такие функции процессора/компьютера виртуальной машины, как расширенная конфигурация, интерфейс питания (ACPI) и контроллер прерываний GICv3, указанный процессором ARM.

### Пример для архитектуры AArch64

Виртуальная машина с типом архитектуры **aarch64** использует набор микросхем **virt**. Настройка виртуальной машины началась с UEFI:

```
<domain type='kvm'>
    ...
    <os>
        <type arch='aarch64' machine='virt'>hvm</type>
        <loader readonly='yes' type='pflash'>/usr/share/edk2/aarch64/QEMU_EFI-pflash.raw</loader>
        <nvram>/var/lib/libvirt/qemu/nvram/openEulerVM.fd</nvram>
    </os>
    ...
</domain>
```

Настройка функций ACPI и контроллера прерываний GIC V3 для виртуальной машины.

```
<features>
    <acpi/>
    <gic version='3'/>
</features>
```

### Пример для архитектуры x86\_64

Архитектура x86\_64 поддерживает режимы загрузки BIOS и UEFI. Если подэлемент **loader** не сконфигурирован, используется режим загрузки BIOS по умолчанию. Ниже приведен пример конфигурации, в которой используются режим загрузки UEFI и наборы микросхем Q35.

```
<domain type='kvm'>
    ...
    <os>
        <type arch='x86_64' machine='q35'>hvm</type>
        <loader type='rom'>/usr/share/edk2/ovmf/OVMF.fd</loader>
    </os>
    ...
</domain>
```

## Другие стандартные элементы конфигурации

### Обзор

Помимо системных ресурсов и виртуальных устройств в конфигурационном файле XML необходимо указать и другие элементы. В данном разделе описан метод настройки данных элементов.

### Элементы

- **iothreads**: количество потоков ввода-вывода, которые можно использовать для ускорения работы устройства хранения.

- **on\_poweroff:** действие, предпринимаемое при отключении виртуальной машины.

- **on\_reboot:** действие, предпринимаемое при повторной загрузке виртуальной машины.

- **on\_crash:** действие, предпринимаемое при сбое работы виртуальной машины.

- **clock**: тип синхронизации.
  
  Атрибут **offset**: тип синхронизации часов виртуальной машины. Значения следующие: **localtime**, **utc**, **timezone**, **variable**.

### Пример настройки

Настройте два потока (**iothread**) для виртуальной машины, чтобы ускорить производительность устройства хранения.

```
<iothreads>2</iothreads>
```

Удалите виртуальную машину в условии ее отключения.

```
<on_poweroff>destroy</on_poweroff>
```

Перезапустите виртуальную машину.

```
<on_reboot>restart</on_reboot>
```

Удалите виртуальную машину в условии ее сбоя.

```
<on_crash>restart</on_crash>
```

Для синхронизации часов используется режим **utc**.

```
<clock offset='utc'/>
```

## Пример конфигурационного файла XML

### Обзор

В этом разделе приведены два примера конфигурационных файлов XML для базовой виртуальной машины с архитектурами AArch64 и x86\_64.

### Пример 1.

Конфигурационный файл XML для виртуальной машины с архитектурой AArch64, содержащий базовые элементы. Пример конфигурации:

```
<domain type='kvm'>
    <name>openEulerVM</name>
    <memory unit='GiB'>8</memory>
    <vcpu>4</vcpu>
    <os>
	<type arch='aarch64' machine='virt'>hvm</type>
	<loader readonly='yes' type='pflash'>/usr/share/edk2/aarch64/QEMU_EFI-pflash.raw</loader>
	<nvram>/var/lib/libvirt/qemu/nvram/openEulerVM.fd</nvram>
    </os>
    <features>
	<acpi/>
	<gic version='3'/>
    </features>
    <cpu mode='host-passthrough'>
        <topology sockets='2' cores='2' threads='1'/>
    </cpu>
    <iothreads>1</iothreads>
    <clock offset='utc'/>
    <on_poweroff>destroy</on_poweroff>
    <on_reboot>restart</on_reboot>
    <on_crash>restart</on_crash>
    <devices>
	<emulator>/usr/libexec/qemu-kvm</emulator>
	<disk type='file' device='disk'>
	    <driver name='qemu' type='qcow2' iothread="1"/>
	    <source file='/mnt/openEuler-image.qcow2'/>
	    <target dev='vda' bus='virtio'/>
	    <boot order='1'/>
	</disk>
	<disk type='file' device='cdrom'>
	    <driver name='qemu' type='raw'/>
	    <source file='/mnt/openEuler-20.03-LTS-aarch64-dvd.iso'/>
	    <readonly/>
	    <target dev='sdb' bus='scsi'/>
	    <boot order='2'/>
	</disk>
	<interface type='bridge'>
	    <source bridge='br0'/>
	    <model type='virtio'/>
	</interface>
	<console type='pty'/>
        <video>
           <model type='virtio'/>
        </video>
        <controller type='scsi' index='0' model='virtio-scsi'/>
	<controller type='usb' model='ehci'/>
	<input type='tablet' bus='usb'/>
	<input type='keyboard' bus='usb'/>
	<graphics type='vnc' listen='0.0.0.0' passwd='n8VfjbFK'/>
    </devices>
    <seclabel type='dynamic' model='dac' relabel='yes'/>
</domain>
```

### Пример 2.

Конфигурационный файл XML для виртуальной машины с архитектурой x86\_64, содержащий базовые элементы и элементы шины. Пример конфигурации:

```
<domain type='kvm'>
  <name>openEulerVM</name>
  <memory unit='KiB'>8388608</memory>
  <currentMemory unit='KiB'>8388608</currentMemory>
  <vcpu placement='static'>4</vcpu>
  <iothreads>1</iothreads>
  <os>
    <type arch='x86_64' machine='pc-i440fx-4.0'>hvm</type>
  </os>
  <features>
    <acpi/>
  </features>
  <cpu mode='host-passthrough' check='none'>
    <topology sockets='2' cores='2' threads='1'/>
  </cpu>
  <clock offset='utc'/>
  <on_poweroff>destroy</on_poweroff>
  <on_reboot>restart</on_reboot>
  <on_crash>restart</on_crash>
  <devices>
    <emulator>/usr/libexec/qemu-kvm</emulator>
    <disk type='file' device='disk'>
      <driver name='qemu' type='qcow2' iothread='1'/>
      <source file='/mnt/openEuler-image.qcow2'/>
      <target dev='vda' bus='virtio'/>
      <boot order='1'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x08' function='0x0'/>
    </disk>
    <controller type='scsi' index='0' model='virtio-scsi'>
    </controller>
    <controller type='virtio-serial' index='0'>
    </controller>
    <controller type='usb' index='0' model='ehci'>
    </controller>
    <controller type='sata' index='0'>
    </controller>
    <controller type='pci' index='0' model='pci-root'/>
    <interface type='bridge'>
      <mac address='52:54:00:c1:c4:23'/>
      <source bridge='virbr0'/>
      <model type='virtio'/>
    </interface>
    <serial type='pty'>
      <target type='isa-serial' port='0'>
        <model name='isa-serial'/>
      </target>
    </serial>
    <console type='pty'>
      <target type='serial' port='0'/>
    </console>
    <input type='tablet' bus='usb'>
      <address type='usb' bus='0' port='1'/>
    </input>
    <input type='keyboard' bus='usb'>
      <address type='usb' bus='0' port='2'/>
    </input>
    <input type='mouse' bus='ps2'/>
    <input type='keyboard' bus='ps2'/>
    <graphics type='vnc' port='-1' autoport='yes' listen='0.0.0.0'>
      <listen type='address' address='0.0.0.0'/>
    </graphics>
    <video>
      <model type='vga' vram='16384' heads='1' primary='yes'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x02' function='0x0'/>
    </video>
    <memballoon model='virtio'>
    </memballoon>
  </devices>
</domain>
```