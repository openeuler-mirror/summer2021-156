# Вопросы и ответы

<!-- TOC -->
- Вопросы и ответы
  - [Почему объем памяти, используемой службой libvirtd, отличается при запросе командами systemctl и top?](#why-is-the-memory-usage-of-the-libvirtd-service-queried-by-running-the-systemctl-and-top-commands-different)
  - [Ошибка при установке размера полосы данных (stripsize) в значение 4 во время конфигурирования тома RAID 0](#an-error-occurs-when-stripsize-is-set-to-4-during-raid-0-volume-configuration)
  - [Сбой компиляции СУБД MariaDB с помощью утилиты rpmbuild](#failed-to-compile-mariadb-using-rpmbuild)
  - [Сбой запуска службы SNTP с использованием конфигурации по умолчанию](#failed-to-start-the-sntp-service-using-the-default-configuration)
  - [Ошибка установки, вызванная конфликтом пакетов программного обеспечения, конфликтом файлов или отсутствием пакета программного обеспечения](#installation-failure-caused-by-software-package-conflict-file-conflict-or-missing-software-package)

<!-- /TOC -->
## Почему объем памяти, занимаемой службой libvirtd, отличается при запросе командами systemctl и top?

### Признак

В выходных данных команд **systemctl** и **systemd-cgtop** содержится информация, что служба libvirtd занимает более 1,5 ГБ памяти, а в выходных данных команды **top** это значение равно 70 МБ.

### Анализ причин

Объем памяти, занимаемой службами (в том числе при запросе командами **systemctl** и **systemd-cgtop**), которые управляются подсистемой systemd, можно получить из файла **memory.usage\_in\_bytes** в группе управления Cgroup. Команда **top** служит для запроса информации о занимаемой памяти в каталоге **/proc**. Результаты запроса будут отличаться в зависимости от применяемого статистического метода.

Типы памяти, занимаемой служебными процессами:

- anon\_rss: хранит страницы анонимных запросов в адресных пространствах пользовательского режима, например память, выделяемая при вызове функции malloc или mmap с заданным параметром **MAP\_ANONYMOUS**. В случае нехватки системной памяти ядро может поменять тип памяти.
- file\_rss: отображенные страницы памяти в адресных пространствах пользовательского режима, включая файл отображения (например, mmap определенного файла) и map tmpfs (например, общий ресурс IPC). В случае нехватки системной памяти ядро высвобождает страницы памяти. Перед высвобождением страниц памяти может потребоваться синхронизация данных между ядром и файлом отображения.
- file\_cache: файловая кэш-память (кэш подкачки страниц для файлов, размещаемых на дисках), который генерируется во время чтения или записи файла. В случае нехватки системной памяти ядро высвобождает страницы памяти. Перед высвобождением страниц памяти может потребоваться синхронизация данных между ядром и файлом отображения.
- страницы буфера: страничный кэш, например, кэш, создаваемый во время чтения файлов блочных устройств.

anon\_rss и file\_rss относятся к страницам памяти, выделенных процессу операционной системой и в настоящее время находящихся в ОЗУ, а file\_cache и страницы буфера относятся к страничному кэшу.

RSS в выходных данных команды **top** \= anon\_rss + file\_rss; Общая память (SHR) = file\_rss **memory.usage\_in\_bytes** в Cgroup = cache + RSS + swap

В заключение следует отметить, что расчет занимаемой памяти, полученный командой **systemd**, отличается от расчета, полученного командой **top**. Поэтому результаты запроса отличаются.

## Ошибка при установке размера полосы данных (stripsize) в значение 4 во время конфигурирования тома RAID 0

### Признак

При установке параметра размера полосы данных **stripsize** в значение **4** во время конфигурирования тома RAID 0 возникает ошибка.

### Анализ причин

Таблицу страниц размером 64 КБ можно включить только в случае, если значение параметра **stripsize** равно **64**.

### Решение

Изменять конфигурационный файл не требуется. При выполнении команды **lvcreate** в openEuler установите параметр **stripsize** в значение **64**, так как минимальный поддерживаемый размер полосы данных составляет 64 КБ.

## Сбой компиляции СУБД MariaDB с помощью утилиты rpmbuild

### Признак

После входа в систему с правами пользователя **root** и выполнения команды **rpmbuild** с целью скомпилировать исходный код СУБД MariaDB происходит ошибка компиляции и отображается следующая информация:

```
+ echo 'mysql can'\''t run test as root'
mysql can't run test as root
+ exit 1
```

### Анализ причин

СУБД MariaDB не дает пользователю **root** полномочия на исполнение тестовых сценариев. Однако тестовые сценарии автоматически исполняются во время компиляции. В результате процесс компиляции блокируется.

### Решение

С помощью текстового редактора, например vi, измените значение параметра **runtest** в файле **mariadb.spec**.

Перед изменением:

```
%global runtest 1
```

После изменения:

```
%global runtest 0
```

Данное изменение отключает функцию исполнения тестовых сценариев во время компиляции, что не влияет на компиляцию и содержимое RPM-пакета после компиляции.

## Сбой запуска службы SNTP с использованием конфигурации по умолчанию

### Признак

Не удается запустить службу SNTP с конфигурацией, заданной по умолчанию.

### Анализ причин

Имя домена NTP-сервера не добавляется в конфигурацию по умолчанию.

### Решение

Измените файл **/etc/sysconfig/sntp** и добавьте имя домена NTP-сервера в Китае:  **0.generic.pool.ntp.org**.

## Ошибка установки, вызванная конфликтом пакетов программного обеспечения, конфликтом файлов или отсутствием пакета программного обеспечения

### Признак

Во время установки пакета программного обеспечения могут возникать конфликты пакетов ПО, конфликты файлов или пакеты ПО могут отсутствовать. В результате обновление прерывается, происходит сбой установки. Отображается следующая информация об ошибках, связанных с конфликтами пакетов ПО, конфликтами файлов и отсутствующими пакетами ПО:

Здесь приведен пример вывода информации об ошибках, связанных с конфликтом пакетов программного обеспечения (взят конфликт между **libev-libevent-devel-4.24-11.oe1.aarch64** и **libevent-devel-2.1.11-2.oe1.aarch64**):

```
package libev-libevent-devel-4.24-11.oe1.aarch64 conflicts with libevent-devel provided by libevent-devel-2.1.11-2.oe1.aarch64  
 - cannot install the best candidate for the job  
 - conflicting requests
```

Это пример вывода информации об ошибках, связанных с конфликтом файлов (взят конфликт файла **/usr/bin/containerd**):

```
Error: Transaction test error:  
 file /usr/bin/containerd from install of containerd-1.2.0-101.oe1.aarch64 conflicts with file from package docker-engine-18.09.0-100.aarch64  
 file /usr/bin/containerd-shim from install of containerd-1.2.0-101.oe1.aarch64 conflicts with file from package docker-engine-18.09.0-100.aarch64
```

Это пример вывода информации об ошибках, связанных с отсутствием пакета ПО **blivet-data**:

```
Error:  
  Problem: cannot install both blivet-data-1:3.1.1-6.oe1.noarch and blivet-data-1:3.1.1-5.noarch  
   - package python2-blivet-1:3.1.1-5.noarch requires blivet-data = 1:3.1.1-5, but none of the providers can be installed  
   - cannot install the best update candidate for package blivet-data-1:3.1.1-5.noarch  
   - problem with installed package python2-blivet-1:3.1.1-5.noarch(try to add '--allowerasing' to command line to replace conflicting packages or '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
```

### Анализ причин

- Некоторые пакеты программного обеспечения, предоставляемые сообществом openEuler, отличаются именами, но имеют одинаковые функции. В результате такие пакеты нельзя установить одновременно.
- Некоторые пакеты программного обеспечения, предоставляемые сообществом openEuler, отличаются именами, но имеют одинаковые функции. В результате файлы после установки одинаковы, что приводит к конфликту.
- Некоторые пакеты программного обеспечения зависят от других пакетов, имеющихся до обновления. После обновления последних возможен сбой установки зависящих от них пакетов ПО по причине нехватки определенных пакетов.

### Решение

При возникновении конфликта пакетов ПО выполните следующие действия (конкретный конфликт пакетов ПО в разделе «Признак» приведен в качестве примера).

1. Согласно появляющемуся во время установки сообщению об ошибке, с устанавливаемым пакетом программного обеспечения **libev-libevent-devel-4.24-11.oe1.aarch64** конфликтует пакет **libevent-devel-2.1.11-2.oe1.aarch64**.

2. Выполните команду **dnf remove**, чтобы удалить пакет ПО, который конфликтует с устанавливаемым пакетом.
   
   ```
   # dnf remove libevent-devel-2.1.11-2.oe1.aarch64
   ```

3. Выполните установку еще раз.

При возникновении конфликта пакетов файлов выполните следующие действия (конкретный конфликт файлов в разделе «Признак» приведен в качестве примера).

1. В соответствии с появляющимся во время установки сообщением об ошибке, конфликт файлов вызывают пакеты ПО с именами **containerd-1.2.0-101.oe1.aarch64** и **docker-engine-18.09.0-100.aarch64**.

2. Запишите имена пакетов ПО, которые не требуется устанавливать. Имя **docker-engine-18.09.0-100.aarch64** здесь приведено в качестве примера.

3. Выполните команду **dnf remove**, чтобы удалить пакет ПО, который не требуется устанавливать.
   
   ```
   # dnf remove docker-engine-18.09.0-100.aarch64
   ```

4. Выполните установку еще раз.

При отсутствии пакета ПО выполните следующие действия (отсутствующий пакет ПО в разделе «Признак» приведен в качестве примера).

1. Определите имя обновляемого пакета программного обеспечения (**blivet-data-1:3.1.1-5.noarch**) и имя зависящего от него пакета программного обеспечения (**python2-blivet-1:3.1.1-5.noarch**) на основе информации об ошибках, отображаемой во время обновления.

2. Командой **dnf remove** удалите пакет программного обеспечения, который зависит от обновляемого пакета, или добавьте параметр --**allowerasing** во время обновления этого пакета.
   
   - Выполните команду **dnf remove**, чтобы удалить пакет программного обеспечения, который зависит от пакета **blivet-data-1:3.1.1-5.noarch**.
     
     ```
     # dnf remove python2-blivet-1:3.1.1-5.noarch
     ```
   
   - Во время обновления программного пакета добавьте параметр --**allowerasing**.
     
     ```
     # yum update blivet-data-1:3.1.1-5.noarch -y --allowerasing
     ```

3. Выполните обновление еще раз.