# Настройка веб-сервера

\[\[toc]]

## Сервер Apache

### Обзор

World Wide Web (Web) является одним из наиболее часто используемых протоколов Интернета. В настоящее время веб-сервер в Unix-системах реализуется в основном через программное обеспечение сервера Apache. Для работы динамических веб-сайтов разработан комплекс программного обеспечения LAMP (Linux + Apache + MySQL + PHP). Веб-сервисы сочетаются с мультимедийным контентом — текстом, графикой, изображениями и аудио — и поддерживают передачу информации по гиперссылкам.

В системе openEuler используется версия веб-сервера Apache HTTP 2.4, то есть httpd, который представляет собой веб-сервер с открытым исходным кодом, разработанным организацией Apache Software Foundation.

### Управление службой httpd

#### Обзор

Управлять службой httpd можно с помощью инструмента systemctl. Доступны операции запуска, остановки, перезапуска службы, а также запрос ее статуса. В данном разделе описываются методы управления службой Apache HTTP.

#### Необходимые условия

- Чтобы использовать службу Apache HTTP, убедитесь, что в вашей системе установлен пакет rpm службы httpd. Установка пакета rpm осуществляется выполнением следующей команды от имени пользователя **root**:
  
  ```
  # dnf install httpd
  ```
  
  Дополнительную информацию об управлении службами см. в разделе [Управление службами](./service-management.html).

- Чтобы запустить, остановить и перезапустить службу httpd, пользователю необходимо иметь разрешение **root**.

#### Запуск службы

- Запустите службу httpd следующей командой:
  
  ```
  # systemctl start httpd
  ```

- Если необходимо, чтобы служба httpd автоматически запускалась при запуске системы, команда и ее результат выполнения будут следующими:
  
  ```
  # systemctl enable httpd
  Created symlink /etc/systemd/system/multi-user.target.wants/httpd.service → /usr/lib/systemd/system/httpd.service.
  ```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
> Если запущенный сервер Apache HTTP функционирует как защищенный сервер, после запуска системы требуется ввести пароль. Пароль представляет собой зашифрованный частный 
> SSL-ключ.

#### Остановка службы

- Остановите службу httpd следующей командой:
  
  ```
  # systemctl stop httpd
  ```

- Если нет необходимости в автоматическом запуске службы httpd во время запуска системы, команда и ее результат выполнения будут следующими:
  
  ```
  # systemctl disable httpd
  Removed /etc/systemd/system/multi-user.target.wants/httpd.service.
  ```

#### Перезапуск службы

Перезапустить службу можно одним из следующих способов:

- Перезапуск службы командой **restart**.
  
  ```
  # systemctl restart httpd
  ```
  
  Эта команда останавливает текущую службу httpd и немедленно перезапускает ее. Команда обычно используется после установки службы или при удалении динамически загружаемого модуля (например, PHP).

- Перезагрузка конфигурации.
  
  ```
  # systemctl reload httpd
  ```
  
  Эта команда инструктирует текущую службу httpd перезагрузить свой конфигурационный файл. Любые обрабатываемые в данный момент запросы будут прерваны, в результате браузер клиента отобразит сообщение об ошибке или заново преобразует ряд отображаемых страниц.

- Перезагрузка конфигурации, не затрагивая запросы на активацию.
  
  ```
  # apachectl graceful
  ```
  
  Эта команда инструктирует текущую службу httpd перезагрузить свой конфигурационный файл. Любые обрабатываемые в данный момент запросы продолжат использовать старый конфигурационный файл.

#### Проверка статуса службы

Убедитесь, что служба httpd запущена.

```
$ systemctl is-active httpd
```

Если в командном выводе отображается статус active, значит служба запущена и активна.

### Описание конфигурационного файла

После запуска служба httpd по умолчанию считывает конфигурационный файл, приведенный в 
[Табл. 1](#table24341012096).

**Табл. 1** Описание конфигурационных файлов

| Файл| Описание|
|:----------|:----------|
| /etc/httpd/conf/httpd.conf| Основной конфигурационный файл.|
| /etc/httpd/conf.d | Вторичный каталог конфигурационных файлов, которые также содержатся в главном конфигурационном файле. |
Хотя конфигурацию по умолчанию можно использовать в большинстве случаев, необходимо знать ряд важных элементов конфигурации. После изменения проверьте конфигурационный файл на синтаксические ошибки, выполнив следующую команду от имени пользователя **root**:

```
# apachectl configtest
```

Если отображается следующая информация, то синтаксис конфигурационного файла корректный:

```
Syntax OK
```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:
> 
> - Перед изменением конфигурационного файла сделайте резервную копию исходного файла, чтобы данные можно было быстро восстановить в случае сбоя.
> - Измененный конфигурационный файл вступает в силу только после перезапуска веб-службы.

### Модуль управления и SSL

#### Обзор

Служба httpd представляет собой модульное приложение, которое распространяется с рядом динамических общих объектов (Dynamic Shared Objects; DSO). При необходимости DSO можно динамически загружать или выгружать, не останавливая работу. Эти модули размещены в каталоге /usr/lib64/httpd/modules/ серверной операционной системы. В этом разделе описывается способ загрузки и записи модуля.

#### Загрузка модуля

Для загрузки специального модуля DSO можно использовать индикацию загрузочного модуля в конфигурационном файле. Модули, предоставляемые независимым пакетом программного обеспечения, имеют свои собственные конфигурационные файлы в каталоге /etc/httpd/conf.modules.d.

Например, чтобы загрузить модуль asis DSO, необходимо выполнить следующие шаги:

1. В файле /etc/httpd/conf.modules.d/00-optional.conf удалите комментарий следующей конфигурационной строки от имени пользователя **root**:
   
   ```
   LoadModule asis_module modules/mod_asis.so
   ```

2. После завершения загрузки перезагрузите конфигурационный файл, перезапустив службу httpd как пользователь **root**.
   
   ```
   # systemctl restart httpd
   ```

3. После завершения загрузки выполните команду httpd -M как пользователь **root**, чтобы убедиться, что модуль asis DSO загружен.
   
   ```
   # httpd -M | grep asis
   ```
   
   Если отображается следующая информация, модуль asis DSO успешно загружен:
   
   ```
   asis_module (shared)
   ```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
**Общие команды httpd**
> 
> - httpd -v: просмотр номера версии httpd.
> - httpd -l: просмотр статических модулей, скомпилированных в программу httpd.
> - httpd -M: просмотр статических модулей и загруженных динамических модулей, скомпилированных в программу httpd.

#### Краткий обзор SSL

Secure Sockets Layer (SSL) — это криптографический протокол, обеспечивающий безопасный обмен информацией между сервером и клиентом. Transport Layer Security (TLS) — протокол защиты транспортного уровня (TLS), который обеспечивает безопасность и целостность данных, передаваемых по сети. openEuler поддерживает набор библиотек Network Security Services (NSS), используемых веб-браузером Mozilla для шифрования данных по протоколу TLS. Для загрузки пакета SSL выполните следующие действия:

1. Как пользователь с правами **root** установите RPM-пакет **mod\_ssl**.
   
   ```
   # dnf install mod_ssl
   ```

2. После завершения загрузки перезагрузите конфигурационный файл, перезапустив службу httpd как пользователь **root**.
   
   ```
   # systemctl restart httpd
   ```

3. После завершения загрузки выполните команду **httpd -M** как пользователь **root**, чтобы убедиться, что пакет SSL загружен.
   
   ```
   # httpd -M | grep ssl
   ```
   
   Если отображается следующая информация, значит, SSL успешно загружен.
   
   ```
   ssl_module (shared)
   ```

### Проверка установки веб-службы

После установки веб-сервера выполните следующие операции, чтобы убедиться в успешности установки веб-сервера:

1. Чтобы проверить IP-адрес сервера, выполните следующую команду как пользователь **root**:
   
   ```
   # ifconfig
   ```
   
   Если отображается следующая информация, значит, IP-адрес сервера — 192.168.1.60.
   
   ```
   enp3s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
   inet 192.168.1.60  netmask 255.255.255.0  broadcast 192.168.1.255
   inet6 fe80::5054:ff:fe95:499f  prefixlen 64  scopeid 0x20<link>
   ether 52:54:00:95:49:9f  txqueuelen 1000  (Ethernet)
   RX packets 150713207  bytes 49333673733 (45.9 GiB)
   RX errors 0  dropped 43  overruns 0  frame 0
   TX packets 2246438  bytes 203186675 (193.7 MiB)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   
   enp4s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
   ether 52:54:00:7d:80:9e  txqueuelen 1000  (Ethernet)
   RX packets 149937274  bytes 44652889185 (41.5 GiB)
   RX errors 0  dropped 1102561  overruns 0  frame 0
   TX packets 0  bytes 0 (0.0 B)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   
   lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
   inet 127.0.0.1  netmask 255.0.0.0
   inet6 ::1  prefixlen 128  scopeid 0x10<host>
   loop  txqueuelen 1000  (Local Loopback)
   RX packets 37096  bytes 3447369 (3.2 MiB)
   RX errors 0  dropped 0  overruns 0  frame 0
   TX packets 37096  bytes 3447369 (3.2 MiB)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   ```

2. Как пользователь с правами **root** настройте межсетевой экран.
   
   ```
   # firewall-cmd --add-service=http --permanent
   success
   # firewall-cmd --reload
   success
   ```

3. Убедитесь, что веб-сервер успешно установлен. Для проверки можно выбрать операционную систему Linux или Windows.
   
   - Использование ОС Linux
     
     Убедитесь, что веб-страница доступна, выполнив следующую команду. Если служба успешно установлена, веб-страница будет доступна.
     
     ```
     $ curl http://192.168.1.60
     ```
     
     Проверьте информацию в командном выводе, выполнив следующую команду. Если командный вывод содержит 0, сервер httpd успешно установлен.
     
     ```
     $ echo $?
     ```
   
   - Использование ОС Windows
     
     Откройте браузер и введите в адресном поле следующий адрес. Если веб-страница доступна, сервер httpd успешно установлен.
     
     http://192.168.1.60
     
     Если номер порта изменен, введите адрес в следующем формате:
     
     http://192.168.1.60: номер порта

## Сервер Nginx

### Обзор

Nginx — это облегченная версия веб-сервера, который также выполняет роль обратного прокси-сервера и прокси-сервера электронной почты (IMAP/POP3). Он занимает мало памяти и отличается мощной способностью параллельной обработки. Nginx поддерживает FastCGI, SSL, виртуальные хосты, переопределение URL-адресов, Gzip и расширение многих сторонних модулей.

### Установка Nginx

1. Сконфигурируйте локальный источник Yum. Для получения подробной информации обратитесь к разделу [Конфигурирование сервера-репозитория](./configuring-the-repo-server.html).

2. Очистите кэш.
   
   ```
   $ dnf clean all
   ```

3. Создайте кэш.
   
   ```
   $ dnf makecache
   ```

4. Как пользователь с правами **root** установите сервер Nginx.
   
   ```
   # dnf install nginx
   ```

5. Проверьте установленный пакет RPM.
   
   ```
   $ dnf list all | grep nginx
   ```

### Управление Nginx

#### Обзор

Управлять службой Nginx можно с помощью инструмента systemctl. Доступны операции запуска, остановки, перезапуска службы, а также запрос ее статуса. В данном разделе описываются методы управления службой Nginx.

#### Необходимые условия

- Убедитесь, что служба Nginx установлена. Если нет, установите ее, следуя инструкциям раздела [Установка Nginx](#installing-nginx).
  
  Дополнительную информацию об управлении службами см. в разделе [Управление службами](./service-management.html).

- Чтобы запустить, остановить и перезапустить службу Nginx, пользователю необходимо иметь разрешение **root**.

#### Запуск службы

- Запустите службу Nginx в работу следующей командой:
  
  ```
  # systemctl start nginx
  ```

- Если необходимо, чтобы служба Nginx автоматически запускалась при запуске системы, команда и ее результат выполнения будут следующими:
  
  ```
  # systemctl enable nginx
  Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /usr/lib/systemd/system/nginx.service.
  ```

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:  
Если запущенный сервер Nginx функционирует как защищенный сервер, после запуска системы требуется ввести пароль. Пароль представляет собой зашифрованный частный SSL-ключ.

#### Остановка службы

- Остановите службу Nginx следующей командой:
  
  ```
  # systemctl stop nginx
  ```

- Если нет необходимости в автоматическом запуске службы httpd во время запуска системы, команда и ее результат выполнения будут следующими:
  
  ```
  # systemctl disable nginx
  Removed /etc/systemd/system/multi-user.target.wants/nginx.service.
  ```

#### Перезапуск службы

Перезапустить службу можно одним из следующих способов:

- Перезапуск службы.
  
  ```
  # systemctl restart nginx
  ```
  
  Эта команда останавливает текущую службу Nginx и немедленно перезапускает ее. Команда обычно используется после установки службы или при удалении динамически загружаемого модуля (например, PHP).

- Перезагрузка конфигурации.
  
  ```
  # systemctl reload nginx
  ```
  
  Эта команда инструктирует текущую службу Nginx перезагрузить свой конфигурационный файл. Любые обрабатываемые в данный момент запросы будут прерваны, в результате браузер клиента отобразит сообщение об ошибке или заново преобразует ряд отображаемых страниц.

- Мягкий перезапуск Nginx.
  
  ```
  # kill -HUP PID
  ```
  
  Эта команда инструктирует текущую службу Nginx перезагрузить свой конфигурационный файл. Любые обрабатываемые в данный момент запросы продолжат использовать старый конфигурационный файл.

#### Проверка статуса службы

Убедитесь, что служба Nginx запущена.

```
$ systemctl is-active nginx
```

Если в командном выводе отображается **статус active**, значит, служба запущена и активна.

### Описание конфигурационного файла

После запуска служба Nginx по умолчанию считывает конфигурационный файл, приведенный в [Табл. 2](#table24341012096).

**Табл. 2** Описание конфигурационных файлов

| Файл                  | Описание                                                     |
| --------------------- | ------------------------------------------------------------ |
| /etc/nginx/nginx.conf | Основной конфигурационный файл.                              |
| /etc/nginx/conf.d     | Вторичный каталог конфигурационных файлов, которые также содержатся в главном конфигурационном файле. |
Хотя конфигурацию по умолчанию можно использовать в большинстве случаев, необходимо знать ряд важных элементов конфигурации. После изменения проверьте конфигурационный файл на синтаксические ошибки, выполнив следующую команду от имени пользователя **root**:

```
# nginx -t
```

Если командный вывод содержит информацию **syntax is ok**, то синтаксис конфигурационного файла корректный.

> ![](./public_sys-resources/icon-note.gif) **ПРИМЕЧАНИЕ**:
> 
> - Перед изменением конфигурационного файла сделайте резервную копию исходного файла, чтобы данные можно было быстро восстановить в случае сбоя.
> - Измененный конфигурационный файл вступает в силу только после перезапуска веб-службы.

### Модули управления

#### Обзор

Служба Nginx представляет собой модульное приложение, которое распространяется с рядом динамических общих объектов (Dynamic Shared Objects; DSO). При необходимости DSO можно динамически загружать или выгружать, не останавливая работу. Эти модули размещены в каталоге **/usr/lib64/nginx/modules/** серверной операционной системы. В этом разделе описывается способ загрузки и записи модуля.

#### Загрузка модуля

Для загрузки специального модуля DSO можно использовать индикацию загрузочного модуля в конфигурационном файле. Модули, предоставляемые независимым пакетом программного обеспечения, имеют свои собственные конфигурационные файлы в каталоге **/usr/share/nginx/modules**.

DSO автоматически загружается, когда для установки Nginx в операционную систему openEuler используется команда **dnf install nginx**.

### Проверка установки веб-службы

После установки веб-сервера выполните следующие операции, чтобы убедиться в успешности установки веб-сервера:

1. Чтобы проверить IP-адрес сервера, выполните следующую команду как пользователь **root**:
   
   ```
   # ifconfig
   ```
   
   Если отображается следующая информация, значит, IP-адрес сервера — **192.168.1.60**.
   
   ```
   enp3s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
   inet 192.168.1.60  netmask 255.255.255.0  broadcast 192.168.1.255
   inet6 fe80::5054:ff:fe95:499f  prefixlen 64  scopeid 0x20<link>
   ether 52:54:00:95:49:9f  txqueuelen 1000  (Ethernet)
   RX packets 150713207  bytes 49333673733 (45.9 GiB)
   RX errors 0  dropped 43  overruns 0  frame 0
   TX packets 2246438  bytes 203186675 (193.7 MiB)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   
   enp4s0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
   ether 52:54:00:7d:80:9e  txqueuelen 1000  (Ethernet)
   RX packets 149937274  bytes 44652889185 (41.5 GiB)
   RX errors 0  dropped 1102561  overruns 0  frame 0
   TX packets 0  bytes 0 (0.0 B)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   
   lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
   inet 127.0.0.1  netmask 255.0.0.0
   inet6 ::1  prefixlen 128  scopeid 0x10<host>
   loop  txqueuelen 1000  (Local Loopback)
   RX packets 37096  bytes 3447369 (3.2 MiB)
   RX errors 0  dropped 0  overruns 0  frame 0
   TX packets 37096  bytes 3447369 (3.2 MiB)
   TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
   ```

2. Как пользователь с правами **root** настройте межсетевой экран.
   
   ```
   # firewall-cmd --add-service=http --permanent
   success
   # firewall-cmd --reload
   success
   ```

3. Убедитесь, что веб-сервер успешно установлен. Для проверки можно выбрать операционную систему Linux или Windows.
   
   - Использование ОС Linux
     
     Убедитесь, что веб-страница доступна, выполнив следующую команду. Если служба успешно установлена, веб-страница будет доступна.
     
     ```
     $ curl http://192.168.1.60
     ```
     
     Проверьте информацию в командном выводе, выполнив следующую команду. Если командный вывод содержит **0**, сервер Nginx успешно установлен.
     
     ```
     $ echo $?
     ```
   
   - Использование ОС Windows
     
     Откройте браузер и введите в адресном поле следующий адрес. Если веб-страница доступна, сервер Nginx успешно установлен.
     
     http://192.168.1.60
     
     Если номер порта изменен, введите адрес в следующем формате:
     
     http://192.168.1.60: номер порта